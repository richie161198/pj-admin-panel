import{a1 as G,b as _,r as o,R as q,j as e,L as Q,c as t,B as i,I as n,F as v,Q as d}from"./index.ce738da1.js";import{b as Y,c as W,u as J}from"./authApiSlice.503d73ff.js";const X=()=>{var D,E,M,j,I,B;const{id:m}=G(),p=_(),{data:g,isLoading:L,error:w,refetch:f}=Y(m),[C,{isLoading:y}]=W(),[F,{isLoading:P}]=J(),a=(g==null?void 0:g.details)||g,[T,u]=o.exports.useState(!1),[U,b]=o.exports.useState(!1),[c,h]=o.exports.useState({name:"",email:"",phone:""}),[N,x]=o.exports.useState({message:""}),[S,A]=o.exports.useState(!1);q.useEffect(()=>{a&&h({name:a.name||"",email:a.email||"",phone:a.phone||""})},[a]);const $=async()=>{var s;if(window.confirm("Are you sure you want to delete this customer? This action cannot be undone."))try{await F(m).unwrap(),d.success("Customer deleted successfully"),p("/customers")}catch(r){const l=((s=r==null?void 0:r.data)==null?void 0:s.message)||(r==null?void 0:r.message)||"Failed to delete customer";d.error(l),console.error("Delete customer error:",r)}},R=async()=>{var s;try{await C({id:m,active:!a.active}).unwrap(),d.success(`Customer ${a.active?"deactivated":"activated"} successfully`),f()}catch(r){const l=((s=r==null?void 0:r.data)==null?void 0:s.message)||(r==null?void 0:r.message)||"Failed to update customer status";d.error(l),console.error("Update customer status error:",r)}},O=async s=>{var r;s.preventDefault();try{await C({id:m,...c}).unwrap(),d.success("Customer updated successfully"),u(!1),f()}catch(l){const V=((r=l==null?void 0:l.data)==null?void 0:r.message)||(l==null?void 0:l.message)||"Failed to update customer";d.error(V),console.error("Update customer error:",l)}},z=async s=>{if(s.preventDefault(),!N.message.trim()){d.error("Please enter a message");return}if(!a.phone){d.error("Customer phone number is not available");return}A(!0);try{const r={VITE_SERVER_URL:"https://www.preciousgoldsmith.net",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0}.VITE_API_URL||"http://localhost:5000",l=localStorage.getItem("adminToken")||localStorage.getItem("token"),k=await(await fetch(`${r}/api/v0/users/admin/sendWhatsAppMessage`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({phoneNumber:a.phone,message:N.message})})).json();k.status||k.success?(d.success("Message sent successfully"),b(!1),x({message:""})):d.error(k.message||"Failed to send message")}catch(r){console.error("Send message error:",r),d.error("Failed to send message. Please try again.")}finally{A(!1)}};return L?e("div",{className:"flex justify-center items-center h-64",children:e(Q,{})}):w?t("div",{className:"text-center py-8",children:[t("p",{className:"text-red-500",children:["Error loading customer: ",w.message]}),e(i,{onClick:()=>f(),className:"mt-4",children:"Retry"})]}):a?t("div",{className:"space-y-6",children:[t("div",{className:"flex justify-between items-center",children:[t("div",{className:"flex items-center space-x-4",children:[t(i,{onClick:()=>p("/customers"),className:"btn btn-outline",children:[e(n,{icon:"ph:arrow-left",className:"mr-2"}),"Back"]}),t("div",{children:[e("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Customer Details"}),e("p",{className:"text-gray-600 dark:text-gray-400",children:"View and manage customer information"})]})]}),t("div",{className:"flex space-x-3",children:[t(i,{onClick:()=>u(!0),className:"btn btn-outline-secondary",children:[e(n,{icon:"ph:pencil",className:"mr-2"}),"Edit"]}),t(i,{onClick:R,disabled:y,className:`btn ${a.active?"btn-outline-warning":"btn-outline-success"}`,children:[e(n,{icon:a.active?"ph:pause":"ph:play",className:"mr-2"}),a.active?"Deactivate":"Activate"]}),t(i,{onClick:$,disabled:P,className:"btn btn-outline-danger",children:[e(n,{icon:"ph:trash",className:"mr-2"}),"Delete"]})]})]}),t("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t("div",{className:"lg:col-span-2",children:[e("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:t("div",{className:"flex items-start space-x-4",children:[e("div",{className:"flex-shrink-0",children:a.profilePhoto?e("img",{src:a.profilePhoto,alt:a.name,className:"h-20 w-20 rounded-full object-cover"}):e("div",{className:"h-20 w-20 rounded-full bg-blue-500 flex items-center justify-center text-white text-2xl font-bold",children:((E=(D=a.name)==null?void 0:D.charAt(0))==null?void 0:E.toUpperCase())||"C"})}),t("div",{className:"flex-1",children:[e("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:a.name||"N/A"}),t("p",{className:"text-gray-600 dark:text-gray-400",children:["Customer ID: ",a.appId||"N/A"]}),t("div",{className:"mt-2 flex flex-wrap gap-2",children:[e("span",{className:`inline-flex px-3 py-1 text-sm font-semibold rounded-full ${a.active?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,children:a.active?"Active":"Inactive"}),a.isBlocked&&e("span",{className:"inline-flex px-3 py-1 text-sm font-semibold rounded-full bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",children:"Blocked"}),a.mobileVerified&&e("span",{className:"inline-flex px-3 py-1 text-sm font-semibold rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",children:"Mobile Verified"}),"  ",a.panVerified&&e("span",{className:"inline-flex px-3 py-1 text-sm font-semibold rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",children:"PAN Verified"})]})]})]})}),t("div",{className:"mt-6 bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:[e("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Contact Information"}),t("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-500 dark:text-gray-400",children:"Email"}),e("p",{className:"mt-1 text-sm text-gray-900 dark:text-white",children:a.email||"N/A"})]}),t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-500 dark:text-gray-400",children:"Phone"}),e("p",{className:"mt-1 text-sm text-gray-900 dark:text-white",children:a.phone||"N/A"})]}),t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-500 dark:text-gray-400",children:"Address"}),e("p",{className:"mt-1 text-sm text-gray-900 dark:text-white",children:a.address&&a.address.length>0&&(((M=a.address.find(s=>s.isDefault))==null?void 0:M.street)||((j=a.address[0])==null?void 0:j.street))||"N/A"})]}),t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-500 dark:text-gray-400",children:"City"}),e("p",{className:"mt-1 text-sm text-gray-900 dark:text-white",children:a.address&&a.address.length>0&&(((I=a.address.find(s=>s.isDefault))==null?void 0:I.city)||((B=a.address[0])==null?void 0:B.city))||"N/A"})]})]})]}),t("div",{className:"mt-6 bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:[e("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Additional Information"}),t("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-500 dark:text-gray-400",children:"App ID"}),e("p",{className:"mt-1 text-sm text-gray-900 dark:text-white",children:a.appId||"N/A"})]}),t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-500 dark:text-gray-400",children:"Referral Code"}),e("p",{className:"mt-1 text-sm text-gray-900 dark:text-white",children:a.referralCode||"N/A"})]}),t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-500 dark:text-gray-400",children:"Role"}),e("p",{className:"mt-1 text-sm text-gray-900 dark:text-white",children:a.role||"N/A"})]}),t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-500 dark:text-gray-400",children:"Last Login"}),e("p",{className:"mt-1 text-sm text-gray-900 dark:text-white",children:a.lastLogin?new Date(a.lastLogin).toLocaleDateString():"Never"})]})]})]})]}),t("div",{className:"space-y-6",children:[t("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:[e("div",{className:"text-center",children:(()=>{const s=a.customerTier||"Bronze",r={Bronze:"from-orange-400 to-orange-600",Silver:"from-gray-400 to-gray-600",Gold:"from-yellow-400 to-yellow-600",Elite:"from-purple-400 to-purple-600"},l={Bronze:"\u{1F949}",Silver:"\u{1F948}",Gold:"\u{1F947}",Elite:"\u{1F48E}"};return t(v,{children:[e("div",{className:`inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-br ${r[s]} text-white text-3xl mb-3`,children:l[s]}),t("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[s," Member"]}),e("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:s==="Elite"?"Top tier customer!":s==="Gold"?"4 more orders for Elite":s==="Silver"?`${6-(a.totalOrders||0)} more orders for Gold`:`${3-(a.totalOrders||0)} more orders for Silver`})]})})()}),e("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:t("div",{className:"grid grid-cols-2 gap-4 text-center",children:[t("div",{children:[e("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:a.totalOrders||0}),e("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Total Orders"})]}),t("div",{children:[t("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["\u20B9",(a.totalOrderValue||0).toLocaleString("en-IN")]}),e("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Total Value"})]})]})})]}),t("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:[e("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Quick Stats"}),t("div",{className:"space-y-4",children:[t("div",{className:"flex justify-between",children:[e("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Balance"}),t("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:["\u20B9",a.balance||0]})]}),t("div",{className:"flex justify-between",children:[e("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Gold Balance"}),t("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[a.goldBalance||0," gm"]})]}),t("div",{className:"flex justify-between",children:[e("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Active Account"}),e("span",{className:`text-sm font-medium ${a.activeAccount?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:a.activeAccount?"Yes":"No"})]}),t("div",{className:"flex justify-between",children:[e("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Mobile Verified"}),e("span",{className:`text-sm font-medium ${a.mobileVerified?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:a.mobileVerified?"Yes":"No"})]}),t("div",{className:"flex justify-between",children:[e("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Pan Verified"}),e("span",{className:`text-sm font-medium ${a.panVerified?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:a.panVerified?"Yes":"No"})]})]})]})]})]}),T&&e("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex items-center justify-center",children:t("div",{className:"relative bg-white dark:bg-slate-800 rounded-lg shadow-lg p-6 w-full max-w-md",children:[t("div",{className:"flex justify-between items-center mb-4",children:[e("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Edit Customer"}),e("button",{onClick:()=>u(!1),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e(n,{icon:"ph:x",className:"text-xl"})})]}),t("form",{onSubmit:O,className:"space-y-4",children:[t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Name *"}),e("input",{type:"text",value:c.name,onChange:s=>h({...c,name:s.target.value}),required:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-white"})]}),t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Email *"}),e("input",{type:"email",value:c.email,onChange:s=>h({...c,email:s.target.value}),required:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-white"})]}),t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Phone"}),e("input",{type:"tel",value:c.phone,onChange:s=>h({...c,phone:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-white"})]}),t("div",{className:"flex justify-end space-x-2 pt-4",children:[e(i,{type:"button",onClick:()=>u(!1),className:"btn btn-outline",children:"Cancel"}),e(i,{type:"submit",disabled:y,className:"btn btn-primary",children:y?"Updating...":"Update"})]})]})]})}),U&&e("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex items-center justify-center",children:t("div",{className:"relative bg-white dark:bg-slate-800 rounded-lg shadow-lg p-6 w-full max-w-md",children:[t("div",{className:"flex justify-between items-center mb-4",children:[e("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Send WhatsApp Message"}),e("button",{onClick:()=>{b(!1),x({message:""})},className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e(n,{icon:"ph:x",className:"text-xl"})})]}),t("form",{onSubmit:z,className:"space-y-4",children:[e("div",{children:t("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["To: ",a.name," (",a.phone||"N/A",")"]})}),t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Message *"}),e("textarea",{value:N.message,onChange:s=>x({message:s.target.value}),required:!0,rows:5,placeholder:"Enter your message here...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-white"})]}),t("div",{className:"flex justify-end space-x-2 pt-4",children:[e(i,{type:"button",onClick:()=>{b(!1),x({message:""})},className:"btn btn-outline",children:"Cancel"}),e(i,{type:"submit",disabled:S||!a.phone,className:"btn btn-primary",children:S?t(v,{children:[e(n,{icon:"ph:spinner",className:"animate-spin mr-2"}),"Sending..."]}):t(v,{children:[e(n,{icon:"ph:paper-plane-tilt",className:"mr-2"}),"Send"]})})]})]})]})})]}):t("div",{className:"text-center py-8",children:[e("p",{className:"text-gray-500",children:"Customer not found"}),e(i,{onClick:()=>p("/customers"),className:"mt-4",children:"Back to Customers"})]})};export{X as default};
