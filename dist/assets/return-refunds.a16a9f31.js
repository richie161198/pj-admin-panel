import{d as ie,b as oe,r as h,j as e,L as U,c as a,B as o,I as N,F as H,Q as g}from"./index.db1e92fc.js";import{d as me,e as ue,f as pe}from"./orderApi.44bcba49.js";import{B as J}from"./Badge.ab3e07af.js";import{M as he}from"./Modal.bcd3286a.js";import{T as ge}from"./Textarea.f67ae2c1.js";import"./hidden.ed2eaee4.js";const xe=ie.injectEndpoints({endpoints:m=>({createReturnShipment:m.mutation({query:n=>({url:"/shipments/admin/return",method:"POST",body:n}),invalidatesTags:["Order","ReturnRefund"]}),trackShipmentByOrder:m.mutation({query:n=>({url:"/shipments/bvc/track/order",method:"POST",body:n})}),getShipmentByOrder:m.query({query:n=>`/shipments/order/${n}`,providesTags:["Order"]}),getAllShipments:m.query({query:(n={})=>{const c=new URLSearchParams;return Object.keys(n).forEach(s=>{n[s]!==void 0&&n[s]!==""&&c.append(s,n[s])}),`/shipments?${c.toString()}`},providesTags:["Order"]}),cancelShipment:m.mutation({query:n=>({url:"/shipments/cancel",method:"POST",body:n}),invalidatesTags:["Order"]})})}),{useCreateReturnShipmentMutation:ye,useTrackShipmentByOrderMutation:Re,useGetShipmentByOrderQuery:je,useGetAllShipmentsQuery:Se,useCancelShipmentMutation:Ce}=xe,Pe=()=>{var L,Q,$,_,z,G;oe();const[m,n]=h.exports.useState(""),[c,s]=h.exports.useState(1),[C,K]=h.exports.useState(""),[P,V]=h.exports.useState(""),[A,W]=h.exports.useState(""),[T,X]=h.exports.useState(""),[v,k]=h.exports.useState(null),[Y,w]=h.exports.useState(!1),[M,x]=h.exports.useState(""),q=10,Z={page:c,limit:q,...C&&{status:C},...P&&{requestType:P},...m&&{search:m},...A&&{startDate:A},...T&&{endDate:T}},{data:l,isLoading:ee,error:F,refetch:I}=me(Z),[te]=ue(),[ae]=pe(),[re,{isLoading:D}]=ye(),E=((L=l==null?void 0:l.data)==null?void 0:L.returnRequests)||[],i=((Q=l==null?void 0:l.data)==null?void 0:Q.pagination)||{},O=(($=l==null?void 0:l.data)==null?void 0:$.summary)||{};(_=l==null?void 0:l.data)!=null&&_.breakdown;const se=async t=>{var u,S,y,f,b;const d=typeof t=="string"?t:t._id,r=typeof t=="object"?(u=t.orderId)==null?void 0:u.orderCode:null,R=typeof t=="object"?t.requestType:null,j=typeof t=="object"?t.reason||((y=(S=t.items)==null?void 0:S[0])==null?void 0:y.reason):null;try{if(await te({requestId:d}).unwrap(),R==="return"&&r)try{await re({orderCode:r,reason:j||"Return approved by admin"}).unwrap(),g.success("Return/Refund request approved and return shipment created successfully")}catch(p){console.error("Failed to create return shipment:",p),g.warning("Return/Refund request approved, but return shipment creation failed. Please create manually.")}else g.success("Return/Refund request approved successfully");I()}catch(p){console.error("Failed to approve request:",p),g.error(((f=p==null?void 0:p.data)==null?void 0:f.error)||((b=p==null?void 0:p.data)==null?void 0:b.message)||"Failed to approve request")}},ne=t=>{k(t),x(""),w(!0)},le=async()=>{var t;if(!M.trim()){g.error("Please provide a rejection reason");return}try{await ae({requestId:v._id,rejectionMessage:M.trim()}).unwrap(),g.success("Return/Refund request rejected successfully"),w(!1),k(null),x(""),I()}catch(d){g.error(((t=d==null?void 0:d.data)==null?void 0:t.error)||"Failed to reject request")}},de=t=>{const r={requested:{color:"bg-yellow-100 text-yellow-800",label:"Requested"},approved:{color:"bg-green-100 text-green-800",label:"Approved"},rejected:{color:"bg-red-100 text-red-800",label:"Rejected"},collected:{color:"bg-blue-100 text-blue-800",label:"Collected"},completed:{color:"bg-gray-100 text-gray-800",label:"Completed"}}[t]||{color:"bg-gray-100 text-gray-800",label:t};return e(J,{className:`${r.color} border-0`,children:r.label})},ce=t=>{const r={return:{color:"bg-orange-100 text-orange-800",label:"Return"},refund:{color:"bg-purple-100 text-purple-800",label:"Refund"}}[t]||{color:"bg-gray-100 text-gray-800",label:t};return e(J,{className:`${r.color} border-0`,children:r.label})},B=t=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(t||0);return ee?e("div",{className:"flex justify-center items-center h-64",children:e(U,{})}):F?a("div",{className:"text-center py-8",children:[a("p",{className:"text-red-500",children:["Error loading return/refund requests: ",F.message]}),e(o,{onClick:()=>I(),className:"mt-4",children:"Retry"})]}):a("div",{className:"space-y-6",children:[e("div",{className:"flex justify-between items-center",children:a("div",{children:[e("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Return & Refund Requests"}),e("p",{className:"text-gray-600 dark:text-gray-400",children:"Manage customer return and refund requests"})]})}),a("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow p-6",children:a("div",{className:"flex items-center justify-between",children:[a("div",{children:[e("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Requests"}),e("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:O.totalRequests||0})]}),e("div",{className:"p-3 bg-blue-100 dark:bg-blue-900 rounded-full",children:e(N,{icon:"heroicons:document-text",className:"text-2xl text-blue-600 dark:text-blue-400"})})]})}),e("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow p-6",children:a("div",{className:"flex items-center justify-between",children:[a("div",{children:[e("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Refund Amount"}),e("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:B(O.totalRefundAmount)})]}),e("div",{className:"p-3 bg-green-100 dark:bg-green-900 rounded-full",children:e(N,{icon:"heroicons:currency-rupee",className:"text-2xl text-green-600 dark:text-green-400"})})]})}),e("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow p-6",children:a("div",{className:"flex items-center justify-between",children:[a("div",{children:[e("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Average Refund"}),e("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:B(O.averageRefundAmount)})]}),e("div",{className:"p-3 bg-purple-100 dark:bg-purple-900 rounded-full",children:e(N,{icon:"heroicons:chart-bar",className:"text-2xl text-purple-600 dark:text-purple-400"})})]})})]}),e("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow p-6",children:a("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Search"}),e("input",{type:"text",value:m,onChange:t=>{n(t.target.value),s(1)},placeholder:"Search by order code, customer...",className:"form-control"})]}),a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Status"}),a("select",{value:C,onChange:t=>{K(t.target.value),s(1)},className:"form-control",children:[e("option",{value:"",children:"All Status"}),e("option",{value:"requested",children:"Requested"}),e("option",{value:"approved",children:"Approved"}),e("option",{value:"rejected",children:"Rejected"}),e("option",{value:"collected",children:"Collected"}),e("option",{value:"completed",children:"Completed"})]})]}),a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Request Type"}),a("select",{value:P,onChange:t=>{V(t.target.value),s(1)},className:"form-control",children:[e("option",{value:"",children:"All Types"}),e("option",{value:"return",children:"Return"}),e("option",{value:"refund",children:"Refund"})]})]}),a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Start Date"}),e("input",{type:"date",value:A,onChange:t=>{W(t.target.value),s(1)},className:"form-control"})]}),a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"End Date"}),e("input",{type:"date",value:T,onChange:t=>{X(t.target.value),s(1)},className:"form-control"})]})]})}),a("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow overflow-hidden",children:[e("div",{className:"overflow-x-auto",children:a("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e("thead",{className:"bg-gray-50 dark:bg-slate-700",children:a("tr",{children:[e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Order Code"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Customer"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Type"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Products"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Refund Amount"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Created At"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e("tbody",{className:"bg-white dark:bg-slate-800 divide-y divide-gray-200 dark:divide-gray-700",children:E.length===0?e("tr",{children:e("td",{colSpan:"9",className:"px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:"No return/refund requests found"})}):E.map(t=>{var d,r,R,j;return a("tr",{className:"hover:bg-gray-50 dark:hover:bg-slate-700",children:[e("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:((d=t.orderId)==null?void 0:d.orderCode)||"N/A"}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:a("div",{children:[e("div",{className:"font-medium",children:((r=t.userId)==null?void 0:r.name)||"N/A"}),e("div",{className:"text-gray-500 dark:text-gray-400 text-xs",children:((R=t.userId)==null?void 0:R.email)||"N/A"})]})}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:ce(t.requestType)}),e("td",{className:"px-6 py-4 text-sm text-gray-900 dark:text-white",children:e("div",{className:"space-y-1",children:(j=t.items)==null?void 0:j.map((u,S)=>{var y,f,b;return a("div",{className:"flex items-center space-x-2",children:[((f=(y=u.productId)==null?void 0:y.images)==null?void 0:f[0])&&e("img",{src:u.productId.images[0],alt:u.productId.name,className:"w-8 h-8 rounded object-cover"}),a("div",{children:[e("div",{className:"text-xs font-medium",children:((b=u.productId)==null?void 0:b.name)||"Product"}),a("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Qty: ",u.qty," | Reason: ",u.reason]})]})]},S)})})}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:t.refundAmount&&t.refundAmount>0?B(t.refundAmount):"\u20B90.00"}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:de(t.status)}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:new Date(t.createdAt).toLocaleDateString()}),a("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[t.status==="requested"&&a("div",{className:"flex space-x-2",children:[e(o,{onClick:()=>se(t),disabled:D,className:"btn btn-sm btn-success",size:"sm",children:D?a(H,{children:[e(U,{}),e("span",{className:"ml-1",children:"Processing..."})]}):a(H,{children:[e(N,{icon:"heroicons:check",className:"mr-1"}),"Accept"]})}),a(o,{onClick:()=>ne(t),className:"btn btn-sm btn-danger",size:"sm",children:[e(N,{icon:"heroicons:x-mark",className:"mr-1"}),"Reject"]})]}),t.status==="rejected"&&t.rejectionMessage&&e("div",{className:"text-xs text-red-600 dark:text-red-400 max-w-xs truncate",title:t.rejectionMessage,children:t.rejectionMessage})]})]},t._id)})})]})}),i.totalPages>1&&a("div",{className:"bg-gray-50 dark:bg-slate-700 px-4 py-3 flex items-center justify-between border-t border-gray-200 dark:border-gray-600",children:[a("div",{className:"flex-1 flex justify-between sm:hidden",children:[e(o,{onClick:()=>s(t=>Math.max(1,t-1)),disabled:!i.hasPrevPage,className:"btn btn-sm",children:"Previous"}),e(o,{onClick:()=>s(t=>t+1),disabled:!i.hasNextPage,className:"btn btn-sm",children:"Next"})]}),a("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e("div",{children:a("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Showing ",e("span",{className:"font-medium",children:(c-1)*q+1})," to"," ",e("span",{className:"font-medium",children:Math.min(c*q,i.totalRequests)})," ","of ",e("span",{className:"font-medium",children:i.totalRequests})," results"]})}),e("div",{children:a("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[e(o,{onClick:()=>s(t=>Math.max(1,t-1)),disabled:!i.hasPrevPage,className:"btn btn-sm",children:"Previous"}),[...Array(i.totalPages)].map((t,d)=>{const r=d+1;return r===1||r===i.totalPages||r>=c-1&&r<=c+1?e(o,{onClick:()=>s(r),className:`btn btn-sm ${c===r?"btn-primary":""}`,children:r},r):r===c-2||r===c+2?e("span",{className:"px-4 py-2",children:"..."},r):null}),e(o,{onClick:()=>s(t=>Math.min(i.totalPages,t+1)),disabled:!i.hasNextPage,className:"btn btn-sm",children:"Next"})]})})]})]})]}),e(he,{title:"Reject Return/Refund Request",label:"reject-modal",activeModal:Y,onClose:()=>{w(!1),x(""),k(null)},children:a("div",{className:"space-y-4",children:[a("div",{children:[e("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:"Please provide a reason for rejecting this request:"}),v&&a("div",{className:"mb-4 p-3 bg-gray-50 dark:bg-slate-700 rounded",children:[a("p",{className:"text-sm font-medium",children:["Order: ",(z=v.orderId)==null?void 0:z.orderCode]}),a("p",{className:"text-sm",children:["Customer: ",(G=v.userId)==null?void 0:G.name]})]})]}),e(ge,{value:M,onChange:t=>x(t.target.value),placeholder:"Enter rejection reason...",rows:4,className:"form-control"}),a("div",{className:"flex justify-end space-x-3",children:[e(o,{onClick:()=>{w(!1),x(""),k(null)},className:"btn btn-outline-secondary",children:"Cancel"}),e(o,{onClick:le,className:"btn btn-danger",children:"Reject Request"})]})]})})]})};export{Pe as default};
