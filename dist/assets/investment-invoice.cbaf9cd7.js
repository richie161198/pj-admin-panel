import{b as ee,r as c,Q as n,c as a,j as e,B as b,I as G,L as te,F as ae}from"./index.93603967.js";import{a as S}from"./axios.9e4b1f88.js";import{B as I}from"./Badge.2391c60f.js";import{u as C,a as se}from"./xlsx.0799a57e.js";const ne=()=>{ee();const[d,U]=c.exports.useState([]),[T,A]=c.exports.useState(!0),[p,D]=c.exports.useState(""),[L,m]=c.exports.useState(1),[g,E]=c.exports.useState(""),[f,B]=c.exports.useState(""),[N,F]=c.exports.useState(""),[y,P]=c.exports.useState(""),[v,R]=c.exports.useState(""),[h,w]=c.exports.useState([]),[k,O]=c.exports.useState(!1),[_,$]=c.exports.useState(!1),j=10;c.exports.useEffect(()=>{V()},[L,g,f,N,p,y,v]);const V=async()=>{var t,r;A(!0);try{const s=new URLSearchParams({page:L,limit:j});g&&s.append("status",g),f&&s.append("transactionType",f),N&&s.append("orderType",N),p&&s.append("search",p),y&&s.append("startDate",y),v&&s.append("endDate",v);const o=await S.get(`/investment-invoices/all?${s.toString()}`);o.data.success?U(o.data.data||[]):n.error("Failed to fetch invoices")}catch(s){console.error("Error fetching invoices:",s),n.error(((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to fetch invoices")}finally{A(!1)}},M=t=>{D(t.target.value),m(1)},q=()=>{D(""),E(""),B(""),F(""),P(""),R(""),m(1)},Q=async(t,r)=>{try{n.info("Preparing invoice for download...");const s=await S.get(`/investment-invoices/download/${t}`,{responseType:"blob"}),o=new Blob([s.data],{type:"application/pdf"}),l=window.URL.createObjectURL(o),i=document.createElement("a");i.href=l,i.download=`${r}.pdf`,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(l),n.success("Invoice downloaded successfully")}catch(s){console.error("Error downloading invoice:",s),n.error("Failed to download invoice")}},W=async()=>{if(h.length===0){n.warning("Please select invoices to download");return}$(!0);let t=0,r=0;try{for(const s of h){const o=d.find(l=>l._id===s);if(!!o)try{const l=await S.get(`/investment-invoices/download/${s}`,{responseType:"blob"}),i=new Blob([l.data],{type:"application/pdf"}),x=window.URL.createObjectURL(i),u=document.createElement("a");u.href=x,u.download=`${o.invoiceNumber}.pdf`,document.body.appendChild(u),u.click(),document.body.removeChild(u),window.URL.revokeObjectURL(x),t++,await new Promise(Z=>setTimeout(Z,500))}catch(l){console.error(`Error downloading invoice ${o.invoiceNumber}:`,l),r++}}t>0&&n.success(`Successfully downloaded ${t} invoice(s)`),r>0&&n.error(`Failed to download ${r} invoice(s)`),w([]),O(!1)}catch(s){console.error("Error in bulk download:",s),n.error("Bulk download failed")}finally{$(!1)}},Y=()=>{try{const t=d.map((l,i)=>{var x;return{"S.No":i+1,"Invoice Number":l.invoiceNumber||"N/A","Order ID":l.orderId||"N/A","Customer Name":l.customerName||"N/A","Customer Email":l.customerEmail||"N/A","Customer Phone":l.customerPhone||"N/A","Order Type":((x=l.orderType)==null?void 0:x.toUpperCase())||"N/A","Transaction Type":l.transactionType||"N/A",Product:l.product||"N/A","Quantity (grams)":l.quantity||0,"Rate Per Gram":l.ratePerGram||0,Amount:l.amount||0,"GST Rate (%)":l.gstRate||0,"GST Amount":l.gstAmount||0,"Total Invoice Value":l.totalInvoiceValue||0,"Payment Method":l.paymentMethod||"N/A",Status:l.status||"N/A","Invoice Date":l.createdAt?new Date(l.createdAt).toLocaleDateString():"N/A"}}),r=C.json_to_sheet(t),s=C.book_new();C.book_append_sheet(s,r,"Investment Invoices");const o=[{wch:5},{wch:20},{wch:25},{wch:20},{wch:25},{wch:15},{wch:12},{wch:15},{wch:12},{wch:15},{wch:15},{wch:12},{wch:10},{wch:12},{wch:18},{wch:15},{wch:12},{wch:15}];r["!cols"]=o,se(s,`Investment_Invoices_${new Date().toISOString().slice(0,10)}.xlsx`),n.success("Excel file downloaded successfully")}catch(t){console.error("Error exporting to Excel:",t),n.error("Failed to export to Excel")}},z=()=>{w(k?[]:d.map(t=>t._id)),O(!k)},H=t=>{w(r=>r.includes(t)?r.filter(s=>s!==t):[...r,t])},J=t=>{const s={draft:{color:"secondary",text:"Draft"},issued:{color:"success",text:"Issued"},paid:{color:"info",text:"Paid"},cancelled:{color:"danger",text:"Cancelled"}}[t]||{color:"secondary",text:t};return e(I,{className:`badge-${s.color}`,children:s.text})},K=t=>{const s={buy:{color:"success",text:"BUY"},sell:{color:"warning",text:"SELL"}}[t]||{color:"secondary",text:t};return e(I,{className:`badge-${s.color}`,children:s.text})},X=t=>{const s={GOLD:{color:"warning",text:"GOLD",icon:"\u{1F947}"},SILVER:{color:"secondary",text:"SILVER",icon:"\u{1F948}"}}[t]||{color:"info",text:t,icon:""};return a(I,{className:`badge-${s.color}`,children:[s.icon," ",s.text]})};return Math.ceil(d.length/j),a("div",{className:"space-y-5",children:[a("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[a("div",{children:[e("h4",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Investment Invoices"}),e("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:"Manage and download investment transaction invoices"})]}),a("div",{className:"flex gap-2",children:[e(b,{icon:"heroicons-outline:download",text:"Export to Excel",className:"btn-success",onClick:Y,disabled:T||d.length===0}),h.length>0&&e(b,{icon:"heroicons-outline:download",text:`Download Selected (${h.length})`,className:"btn-primary",onClick:W,disabled:_,isLoading:_})]})]}),e("div",{className:"card",children:e("div",{className:"card-body",children:a("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 p-4",children:[a("div",{children:[e("label",{className:"form-label",children:"Search"}),a("div",{className:"relative",children:[e("input",{type:"text",className:"form-control",placeholder:"Invoice No, Order ID, Customer...",value:p,onChange:M}),e(G,{icon:"heroicons-outline:search",className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400"})]})]}),a("div",{children:[e("label",{className:"form-label",children:"Status"}),a("select",{className:"form-control",value:g,onChange:t=>{E(t.target.value),m(1)},children:[e("option",{value:"",children:"All Statuses"}),e("option",{value:"draft",children:"Draft"}),e("option",{value:"issued",children:"Issued"}),e("option",{value:"paid",children:"Paid"}),e("option",{value:"cancelled",children:"Cancelled"})]})]}),a("div",{children:[e("label",{className:"form-label",children:"Asset Type"}),a("select",{className:"form-control",value:f,onChange:t=>{B(t.target.value),m(1)},children:[e("option",{value:"",children:"All Assets"}),e("option",{value:"GOLD",children:"Gold"}),e("option",{value:"SILVER",children:"Silver"})]})]}),a("div",{children:[e("label",{className:"form-label",children:"Order Type"}),a("select",{className:"form-control",value:N,onChange:t=>{F(t.target.value),m(1)},children:[e("option",{value:"",children:"All Types"}),e("option",{value:"buy",children:"Buy"}),e("option",{value:"sell",children:"Sell"})]})]}),a("div",{children:[e("label",{className:"form-label",children:"Start Date"}),e("input",{type:"date",className:"form-control",value:y,onChange:t=>{P(t.target.value),m(1)}})]}),a("div",{children:[e("label",{className:"form-label",children:"End Date"}),e("input",{type:"date",className:"form-control",value:v,onChange:t=>{R(t.target.value),m(1)}})]}),e("div",{className:"flex items-end",children:e(b,{text:"Clear Filters",className:"btn-outline-secondary w-full",onClick:q})})]})})}),e("div",{className:"card",children:e("div",{className:"card-body px-0 pb-0",children:T?e("div",{className:"flex justify-center items-center py-20",children:e(te,{})}):d.length===0?a("div",{className:"text-center py-20",children:[e(G,{icon:"heroicons-outline:document-text",className:"mx-auto text-slate-300 dark:text-slate-600 mb-4",width:"64"}),e("p",{className:"text-slate-500 dark:text-slate-400",children:"No invoices found"})]}):a(ae,{children:[e("div",{className:"overflow-x-auto",children:a("table",{className:"min-w-full divide-y divide-slate-200 dark:divide-slate-700",children:[e("thead",{className:"bg-slate-50 dark:bg-slate-800",children:a("tr",{children:[e("th",{className:"px-6 py-3 text-left",children:e("input",{type:"checkbox",checked:k,onChange:z,className:"form-checkbox"})}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Invoice Details"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Customer"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Transaction"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Amount"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Status"}),e("th",{className:"px-6 py-3 text-center text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Actions"})]})}),e("tbody",{className:"bg-white dark:bg-slate-800 divide-y divide-slate-200 dark:divide-slate-700",children:d.map(t=>{var r,s,o;return a("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-700",children:[e("td",{className:"px-6 py-4",children:e("input",{type:"checkbox",checked:h.includes(t._id),onChange:()=>H(t._id),className:"form-checkbox"})}),e("td",{className:"px-6 py-4",children:a("div",{children:[e("div",{className:"text-sm font-semibold text-slate-900 dark:text-white",children:t.invoiceNumber}),a("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:["Order: ",t.orderId]}),e("div",{className:"text-xs text-slate-400 dark:text-slate-500",children:new Date(t.createdAt).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})}),e("td",{className:"px-6 py-4",children:a("div",{children:[e("div",{className:"text-sm font-medium text-slate-900 dark:text-white",children:t.customerName}),e("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:t.customerEmail}),e("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:t.customerPhone})]})}),e("td",{className:"px-6 py-4",children:a("div",{className:"space-y-1",children:[a("div",{className:"flex gap-2",children:[K(t.orderType),X(t.transactionType)]}),a("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:[t.quantity,"g @ \u20B9",t.ratePerGram,"/g"]}),e("div",{className:"text-xs text-slate-500 dark:text-slate-500",children:t.paymentMethod})]})}),e("td",{className:"px-6 py-4",children:a("div",{children:[a("div",{className:"text-sm font-semibold text-slate-900 dark:text-white",children:["\u20B9",(r=t.totalInvoiceValue)==null?void 0:r.toLocaleString("en-IN")]}),a("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:["Base: \u20B9",(s=t.amount)==null?void 0:s.toLocaleString("en-IN")]}),t.gstAmount>0&&a("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:["GST (",t.gstRate,"%): \u20B9",(o=t.gstAmount)==null?void 0:o.toLocaleString("en-IN")]})]})}),e("td",{className:"px-6 py-4",children:J(t.status)}),e("td",{className:"px-6 py-4",children:e("div",{className:"flex gap-2 justify-center",children:e(b,{icon:"heroicons-outline:download",className:"btn-sm btn-primary",onClick:()=>Q(t._id,t.invoiceNumber),title:"Download Invoice"})})})]},t._id)})})]})}),e("div",{className:"px-6 py-4 bg-slate-50 dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700",children:a("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a("div",{children:[e("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Total Invoices"}),e("p",{className:"text-lg font-semibold text-slate-900 dark:text-white",children:d.length})]}),a("div",{children:[e("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Total Amount"}),a("p",{className:"text-lg font-semibold text-slate-900 dark:text-white",children:["\u20B9",d.reduce((t,r)=>t+(r.totalInvoiceValue||0),0).toLocaleString("en-IN")]})]}),a("div",{children:[e("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Total GST"}),a("p",{className:"text-lg font-semibold text-slate-900 dark:text-white",children:["\u20B9",d.reduce((t,r)=>t+(r.gstAmount||0),0).toLocaleString("en-IN")]})]}),a("div",{children:[e("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Selected"}),e("p",{className:"text-lg font-semibold text-slate-900 dark:text-white",children:h.length})]})]})})]})})})]})};export{ne as default};
