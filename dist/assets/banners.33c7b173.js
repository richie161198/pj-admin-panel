import{r as c,j as e,c as s}from"./index.a3fd4963.js";import{a as b}from"./axios.8ec22adb.js";import"./productApi.0747bb22.js";const E=({children:i,className:m=""})=>e("div",{className:`border rounded bg-white ${m}`,children:i}),h=({children:i,className:m="",onClick:v,type:N="button",disabled:w})=>e("button",{type:N,disabled:w,onClick:v,className:`px-4 py-2 border rounded ${w?"opacity-60 cursor-not-allowed":""} ${m}`,children:i}),F=({className:i=""})=>e("span",{className:i,"aria-hidden":!0}),ae=i=>e("input",{...i,className:`w-full border rounded px-3 py-2 ${i.className||""}`}),I=({children:i,...m})=>e("select",{...m,className:`w-full border rounded px-3 py-2 ${m.className||""}`,children:i}),se=({checked:i,onChange:m,name:v})=>e("input",{type:"checkbox",name:v,checked:i,onChange:m}),de=()=>{const[i,m]=c.exports.useState([]),[v,N]=c.exports.useState(!0);c.exports.useState(!1);const[w,C]=c.exports.useState(!1),[B,q]=c.exports.useState(null),[k,$]=c.exports.useState(null),[M,O]=c.exports.useState(null),[T,U]=c.exports.useState(!1),[D,re]=c.exports.useState(""),[u,G]=c.exports.useState("all"),[y,_]=c.exports.useState(1),[S,W]=c.exports.useState(1),[p,H]=c.exports.useState("all"),Y=(()=>{const t=new Set;return i.forEach(a=>{a.category&&a.category.trim()&&t.add(a.category.trim())}),Array.from(t).sort()})(),[d,z]=c.exports.useState({position:0,isActive:!0,category:""}),[R,x]=c.exports.useState(""),A=async()=>{var t;try{N(!0);const a=await b.get("/banners",{params:{page:y,limit:10,search:D,isActive:u==="all"?void 0:u==="active"}});a.data.success&&(m(a.data.data.banners||[]),W(((t=a.data.data.pagination)==null?void 0:t.totalPages)||1))}catch(a){console.error("Error fetching banners:",a)}finally{N(!1)}};c.exports.useEffect(()=>{A()},[y,D,u]);const P=t=>{const{name:a,value:n,type:l,checked:o}=t.target;z(r=>({...r,[a]:l==="checkbox"?o:n}))},J=t=>{var l;const a=(l=t.target.files)==null?void 0:l[0];if(!a)return;if(!a.type.startsWith("image/")){alert("Please select a valid image file");return}if(a.size>8*1024*1024){alert("Image size should be less than 8MB");return}$(a);const n=URL.createObjectURL(a);O(n)},K=(t,a)=>!t||!a?!1:i.some(n=>n.category===t&&n.position===Number(a)&&n._id!==(B==null?void 0:B._id)),Q=async t=>{var a,n,l,o;if(t.preventDefault(),!k){alert("Please choose an image");return}if(!d.category){alert("Please select a category");return}if(K(d.category,d.position)){x(`Position ${d.position} is already set for category "${d.category}". Please change the position.`);return}x(""),U(!0);try{const r=new FormData;r.append("image",k);const g=await b.post("/images/upload",r,{headers:{"Content-Type":"multipart/form-data"}});if(!((a=g.data)!=null&&a.success))throw new Error("Image upload failed");const f=g.data.data,te={position:Number(d.position)||0,isActive:!!d.isActive,category:d.category,imageUrl:f.url,publicId:f.public_id,imageWidth:f.width,imageHeight:f.height,imageFormat:f.format,imageBytes:f.bytes};if(!((n=(await b.post("/banners",te)).data)!=null&&n.success))throw new Error("Banner save failed");j(),C(!1),await A()}catch(r){console.error("Error saving banner:",r);const g=((o=(l=r==null?void 0:r.response)==null?void 0:l.data)==null?void 0:o.message)||r.message||"Failed to save";g.includes("position")||g.includes("Position")?x(g):alert(g)}finally{U(!1)}},j=()=>{z({position:0,isActive:!0,category:""}),O(null),$(null),q(null),x("")},V=()=>{const t={};return i.forEach(a=>{const n=a.category||"Uncategorized";t[n]||(t[n]=[]),t[n].push(a)}),t},X=()=>{let t=i;return u!=="all"&&(t=t.filter(a=>u==="active"?a.isActive:!a.isActive)),p!=="all"&&(t=t.filter(a=>(a.category||"Uncategorized")===p)),t},L=()=>{j(),C(!0)},Z=async t=>{if(!!window.confirm("Are you sure you want to delete this banner?"))try{(await b.delete(`/banners/${t}`)).data.success&&A()}catch(a){console.error("Error deleting banner:",a),alert("Failed to delete banner")}},ee=async(t,a)=>{try{(await b.patch(`/banners/${t}/toggle`)).data.success&&A()}catch(n){console.error("Error toggling banner status:",n),alert("Failed to update banner status")}};return v?e("div",{className:"flex items-center justify-center h-64",children:"Loading..."}):s("div",{className:"space-y-6",children:[s("div",{className:"flex justify-between items-center",children:[s("div",{children:[e("h1",{className:"text-2xl font-bold text-gray-900",children:"Banner Management"}),e("p",{className:"text-gray-600",children:"Manage your website banners and promotional content"})]}),s(h,{onClick:L,className:"bg-blue-600 text-white hover:bg-blue-700",children:[e(F,{icon:"heroicons:plus",className:"w-5 h-5 mr-2"}),"Add New Banner"]})]}),e(E,{className:"p-6",children:s("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),s(I,{value:p,onChange:t=>H(t.target.value),children:[e("option",{value:"all",children:"All Categories"}),Y.map(t=>e("option",{value:t,children:t},t))]})]}),s("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),s(I,{value:u,onChange:t=>G(t.target.value),children:[e("option",{value:"all",children:"All Banners"}),e("option",{value:"active",children:"Active Only"}),e("option",{value:"inactive",children:"Inactive Only"})]})]})]})}),w&&s("div",{className:"p-4 border rounded space-y-3",children:[s("div",{className:"flex items-center justify-between",children:[e("h2",{className:"font-medium",children:"Create New Banner"}),e("button",{className:"text-sm",onClick:()=>C(!1),children:"Close"})]}),s("form",{onSubmit:Q,className:"space-y-3",children:[s("div",{children:[s("label",{className:"block text-sm mb-1",children:["Category ",e("span",{className:"text-red-500",children:"*"})]}),s(I,{name:"category",value:d.category,onChange:P,required:!0,children:[e("option",{value:"",children:"Select Category"}),e("option",{value:"main",children:"Main"}),e("option",{value:"offer&deals",children:"Offer & Deals"}),e("option",{value:"ecommerce",children:"Ecommerce"}),e("option",{value:"top-collections",children:"Top Collections"})]})]}),s("div",{children:[s("label",{className:"block text-sm mb-1",children:["Position ",e("span",{className:"text-red-500",children:"*"})]}),e(ae,{type:"number",name:"position",value:d.position,onChange:t=>{P(t),x("")},min:"0",required:!0}),R&&e("p",{className:"text-red-500 text-xs mt-1",children:R})]}),s("div",{className:"flex items-center gap-2",children:[e(se,{name:"isActive",checked:d.isActive,onChange:P}),e("span",{className:"text-sm",children:"Active"})]}),s("div",{children:[e("input",{type:"file",accept:"image/*",onChange:J}),M&&e("img",{src:M,alt:"preview",className:"mt-3 h-40 object-cover rounded"})]}),s("div",{className:"flex justify-end gap-2",children:[e(h,{type:"button",onClick:()=>{j(),C(!1)},children:"Cancel"}),e(h,{type:"submit",className:"bg-blue-600 text-white",disabled:T||!k,children:T?"Saving...":"Save Banner"})]})]})]}),(()=>{const t=X(),a=V(),n={};return Object.keys(a).forEach(l=>{(p==="all"||l===p)&&(n[l]=a[l].filter(o=>u==="all"?!0:u==="active"?o.isActive:!o.isActive),n[l].length===0&&delete n[l])}),t.length===0?s(E,{className:"p-8 text-center",children:[e(F,{icon:"heroicons:photo",className:"w-16 h-16 mx-auto text-gray-400 mb-4"}),e("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Banners Found"}),e("p",{className:"text-gray-600 mb-4",children:p!=="all"||u!=="all"?"No banners match your current filters.":"Get started by creating your first banner."}),p==="all"&&u==="all"&&s(h,{onClick:L,className:"bg-blue-600 hover:bg-blue-700",children:[e(F,{icon:"heroicons:plus",className:"w-5 h-5 mr-2"}),"Create Your First Banner"]})]}):e("div",{className:"space-y-8",children:Object.keys(n).map(l=>{const o=n[l];return o.length===0?null:s("div",{className:"space-y-4",children:[e("div",{className:"flex items-center justify-between border-b pb-2",children:s("h2",{className:"text-lg font-bold text-gray-900 uppercase",children:[l,s("span",{className:"ml-2 text-sm font-normal text-gray-500",children:["(",o.length," ",o.length===1?"banner":"banners",")"]})]})}),e("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:o.map(r=>s(E,{className:"overflow-hidden",children:[s("div",{className:"relative",children:[e("img",{src:r.imageUrl,alt:r.category||"Banner",className:"w-full h-48 object-cover"}),e("div",{className:"absolute top-2 right-2",children:e("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${r.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:r.isActive?"Active":"Inactive"})})]}),s("div",{className:"p-4",children:[r.description&&e("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2",children:r.description}),s("div",{className:"space-y-2 text-sm text-gray-500",children:[s("div",{className:"flex justify-between",children:[e("span",{children:"Position:"}),e("span",{children:r.position})]}),r.targetAudience&&s("div",{className:"flex justify-between",children:[e("span",{children:"Target:"}),e("span",{className:"capitalize",children:r.targetAudience})]})]}),s("div",{className:"flex gap-2 mt-4",children:[e(h,{onClick:()=>ee(r._id,r.isActive),children:r.isActive?"Set Inactive":"Set Active"}),e(h,{onClick:()=>Z(r._id),className:"text-red-600",children:"Delete"})]})]})]},r._id))})]},l)})})})(),S>1&&s("div",{className:"flex justify-center space-x-2",children:[e(h,{variant:"outline",onClick:()=>_(t=>Math.max(1,t-1)),disabled:y===1,children:"Previous"}),s("span",{className:"flex items-center px-4 py-2 text-sm text-gray-700",children:["Page ",y," of ",S]}),e(h,{variant:"outline",onClick:()=>_(t=>Math.min(S,t+1)),disabled:y===S,children:"Next"})]})]})};export{de as default};
