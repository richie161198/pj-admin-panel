import{b as te,r as U,j as e,L as se,c as s,B as d,I as b,Q as F}from"./index.a3fd4963.js";import{u as ne,a as le}from"./authApiSlice.09c3723a.js";import{u,w as ie}from"./xlsx.0799a57e.js";const oe=()=>{const k=te(),[p,O]=U.exports.useState(""),[c,m]=U.exports.useState(1),N=10;ne();const{data:y,isLoading:G,error:v,refetch:Q}=le(),o=(y==null?void 0:y.details)||[],g=(o==null?void 0:o.filter(t=>{var i,r,w;return((i=t.name)==null?void 0:i.toLowerCase().includes(p.toLowerCase()))||((r=t.email)==null?void 0:r.toLowerCase().includes(p.toLowerCase()))||((w=t.phone)==null?void 0:w.toLowerCase().includes(p.toLowerCase()))}))||[],h=Math.ceil(g.length/N),f=(c-1)*N,z=g.slice(f,f+N),A=t=>{k(`/customers/${t}`)},J=()=>{try{const t=o.map((a,q)=>{var P,L,_,S,j,I,M,V,$,E,R,B,T;const H=((P=a.panDetails)==null?void 0:P.pan)||"N/A",X=((L=a.panDetails)==null?void 0:L.type)||"N/A",Z=((_=a.panDetails)==null?void 0:_.registered_name)||"N/A",ee=(S=a.panDetails)!=null&&S.valid?"Yes":"No";let D="N/A";a.bankDetails&&a.bankDetails.length>0&&(D=a.bankDetails.map((l,ae)=>{var Y;return`Bank ${ae+1}: ${l.bank_name||"N/A"} | Account: ${l.account_number||"N/A"} | IFSC: ${((Y=l.ifsc_details)==null?void 0:Y.ifsc)||"N/A"} | Branch: ${l.branch||"N/A"}`}).join("; "));const n=a.bankDetails&&a.bankDetails.length>0?a.bankDetails[0]:null;return{"S.No":q+1,"Customer ID":a._id,Name:a.name||"N/A",Email:a.email||"N/A",Phone:a.phone||"N/A",Status:a.active?"Active":"Inactive",Blocked:a.isBlocked?"Yes":"No","Mobile Verified":a.mobileVerified?"Yes":"No","Active Account":a.activeAccount?"Yes":"No","PAN Verified":a.panVerified?"Yes":"No","KYC Verified":a.kycVerified?"Yes":"No","PAN Number":H,"PAN Type":X,"PAN Registered Name":Z,"PAN Valid":ee,"Primary Bank Name":(n==null?void 0:n.bank_name)||"N/A","Primary Account Number":(n==null?void 0:n.account_number)||"N/A","Primary IFSC":((j=n==null?void 0:n.ifsc_details)==null?void 0:j.ifsc)||"N/A","Primary Branch":(n==null?void 0:n.branch)||"N/A","Primary Account Status":(n==null?void 0:n.account_status)||"N/A","All Bank Details":D,Balance:a.balance||"0","Gold Balance":a.goldBalance||"0","App ID":a.appId||"N/A","Referral Code":a.referralCode||"N/A",Role:a.role||"N/A","Last Login":a.lastLogin?new Date(a.lastLogin).toLocaleDateString():"Never",Address:a.address&&a.address.length>0&&(((I=a.address.find(l=>l.isDefault))==null?void 0:I.street)||((M=a.address[0])==null?void 0:M.street))||"N/A",City:a.address&&a.address.length>0&&(((V=a.address.find(l=>l.isDefault))==null?void 0:V.city)||(($=a.address[0])==null?void 0:$.city))||"N/A",State:a.address&&a.address.length>0&&(((E=a.address.find(l=>l.isDefault))==null?void 0:E.state)||((R=a.address[0])==null?void 0:R.state))||"N/A",Pincode:a.address&&a.address.length>0&&(((B=a.address.find(l=>l.isDefault))==null?void 0:B.pincode)||((T=a.address[0])==null?void 0:T.pincode))||"N/A"}}),i=u.book_new(),r=u.json_to_sheet(t),w=[{wch:5},{wch:25},{wch:20},{wch:30},{wch:15},{wch:10},{wch:10},{wch:15},{wch:15},{wch:12},{wch:12},{wch:15},{wch:12},{wch:25},{wch:10},{wch:20},{wch:20},{wch:15},{wch:20},{wch:18},{wch:50},{wch:12},{wch:15},{wch:20},{wch:15},{wch:10},{wch:15},{wch:30},{wch:15},{wch:10},{wch:10}];r["!cols"]=w,u.book_append_sheet(i,r,"Customers");const K=ie(i,{bookType:"xlsx",type:"array"}),W=new Blob([K],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),C=window.URL.createObjectURL(W),x=document.createElement("a");x.href=C,x.download=`customers_export_${new Date().toISOString().split("T")[0]}.xlsx`,document.body.appendChild(x),x.click(),document.body.removeChild(x),window.URL.revokeObjectURL(C),F.success("Customer data exported successfully!")}catch(t){console.error("Export error:",t),F.error("Failed to export customer data")}};return G?e("div",{className:"flex justify-center items-center h-64",children:e(se,{})}):v?s("div",{className:"text-center py-8",children:[s("p",{className:"text-red-500",children:["Error loading customers: ",v.message]}),e(d,{onClick:()=>Q(),className:"mt-4",children:"Retry"})]}):s("div",{className:"space-y-6",children:[s("div",{className:"flex justify-between items-center",children:[s("div",{children:[e("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Customers"}),e("p",{className:"text-gray-600 dark:text-gray-400",children:"Manage your customer database"})]}),s("div",{className:"flex space-x-3",children:[s(d,{onClick:J,className:"btn btn-outline-success",disabled:!o||o.length===0,children:[e(b,{icon:"ph:download",className:"mr-2"}),"Export Excel"]}),s(d,{onClick:()=>k("/customers/new"),className:"btn btn-primary",children:[e(b,{icon:"ph:plus",className:"mr-2"}),"Add Customer"]})]})]}),e("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:e("div",{className:"flex flex-col sm:flex-row gap-4",children:e("div",{className:"flex-1",children:s("div",{className:"relative",children:[e(b,{icon:"ph:magnifying-glass",className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e("input",{type:"text",placeholder:"Search customers...",value:p,onChange:t=>O(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-700 dark:text-white"})]})})})}),s("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm overflow-hidden",children:[e("div",{className:"overflow-x-auto",children:s("table",{className:"w-full",children:[e("thead",{className:"bg-gray-50 dark:bg-slate-700",children:s("tr",{children:[e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Customer"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Email"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Phone"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Join Date"}),e("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e("tbody",{className:"bg-white dark:bg-slate-800 divide-y divide-gray-200 dark:divide-gray-700",children:z.map(t=>{var i,r;return s("tr",{onClick:()=>A(t._id),className:"hover:bg-gray-50 dark:hover:bg-slate-700",children:[e("td",{className:"px-6 py-4 whitespace-nowrap",children:s("div",{className:"flex items-center",children:[e("div",{className:"flex-shrink-0 h-10 w-10",children:t.profilePhoto?e("img",{src:t.profilePhoto,alt:t.name,className:"h-10 w-10 rounded-full object-cover"}):e("div",{className:"h-10 w-10 rounded-full bg-blue-500 flex items-center justify-center text-white font-medium",children:((r=(i=t.name)==null?void 0:i.charAt(0))==null?void 0:r.toUpperCase())||"C"})}),s("div",{className:"ml-4",children:[e("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.name||"N/A"}),s("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["ID: ",t._id]})]})]})}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:e("div",{className:"text-sm text-gray-900 dark:text-white",children:t.email||"N/A"})}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:e("div",{className:"text-sm text-gray-900 dark:text-white",children:t.phone||"N/A"})}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:s("div",{className:"flex flex-col space-y-1",children:[e("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t.active?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,children:t.active?"Active":"Inactive"}),t.isBlocked&&e("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",children:"Blocked"})]})}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:t.lastLogin?new Date(t.lastLogin).toLocaleDateString():"Never"}),e("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e("div",{className:"flex justify-end space-x-2",children:e(d,{onClick:()=>A(t._id),className:"btn btn-sm btn-outline-primary",children:e(b,{icon:"ph:eye"})})})})]},t._id)})})]})}),h>1&&s("div",{className:"bg-white dark:bg-slate-800 px-4 py-3 flex items-center justify-between border-t border-gray-200 dark:border-gray-700 sm:px-6",children:[s("div",{className:"flex-1 flex justify-between sm:hidden",children:[e(d,{onClick:()=>m(t=>Math.max(t-1,1)),disabled:c===1,className:"btn btn-sm btn-outline",children:"Previous"}),e(d,{onClick:()=>m(t=>Math.min(t+1,h)),disabled:c===h,className:"btn btn-sm btn-outline",children:"Next"})]}),s("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e("div",{children:s("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Showing ",e("span",{className:"font-medium",children:f+1})," to"," ",e("span",{className:"font-medium",children:Math.min(f+N,g.length)})," ","of ",e("span",{className:"font-medium",children:g.length})," results"]})}),e("div",{children:s("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px",children:[e(d,{onClick:()=>m(t=>Math.max(t-1,1)),disabled:c===1,className:"btn btn-sm btn-outline rounded-l-md",children:"Previous"}),Array.from({length:h},(t,i)=>i+1).map(t=>e(d,{onClick:()=>m(t),className:`btn btn-sm ${c===t?"btn-primary":"btn-outline"}`,children:t},t)),e(d,{onClick:()=>m(t=>Math.min(t+1,h)),disabled:c===h,className:"btn btn-sm btn-outline rounded-r-md",children:"Next"})]})})]})]})]})]})};export{oe as default};
