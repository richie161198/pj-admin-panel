import{d as Y,b as Z,r as o,c as a,j as e,L as A,I as n,B as g,C as v,F as N,Q as d}from"./index.db1e92fc.js";const ee=Y.injectEndpoints({endpoints:u=>({getShipmentPricing:u.query({query:()=>"/shipment-pricing",providesTags:["ShipmentPricing"]}),updateFixedPrice:u.mutation({query:c=>({url:"/shipment-pricing/fixed-price",method:"PUT",body:c}),invalidatesTags:["ShipmentPricing"]}),toggleLocationBased:u.mutation({query:c=>({url:"/shipment-pricing/toggle-location-based",method:"PUT",body:c}),invalidatesTags:["ShipmentPricing"]}),addLocationRule:u.mutation({query:c=>({url:"/shipment-pricing/location-rules",method:"POST",body:c}),invalidatesTags:["ShipmentPricing"]}),updateLocationRule:u.mutation({query:({ruleId:c,...k})=>({url:`/shipment-pricing/location-rules/${c}`,method:"PUT",body:k}),invalidatesTags:["ShipmentPricing"]}),deleteLocationRule:u.mutation({query:c=>({url:`/shipment-pricing/location-rules/${c}`,method:"DELETE"}),invalidatesTags:["ShipmentPricing"]}),calculateShippingPrice:u.mutation({query:c=>({url:"/shipment-pricing/calculate",method:"POST",body:c})})})}),{useGetShipmentPricingQuery:te,useUpdateFixedPriceMutation:ae,useToggleLocationBasedMutation:ie,useAddLocationRuleMutation:re,useUpdateLocationRuleMutation:se,useDeleteLocationRuleMutation:le,useCalculateShippingPriceMutation:de}=ee,oe=()=>{var I,q;const u=Z(),[c,k]=o.exports.useState("fixed-price"),[w,F]=o.exports.useState(!1),{data:r,isLoading:x,error:i,refetch:m}=te(void 0,{refetchOnMountOrArgChange:!0,skip:!1});o.exports.useEffect(()=>{const t=setTimeout(()=>{x&&!r&&(console.warn("Shipment pricing API taking too long, showing UI with defaults"),F(!0))},5e3);return()=>clearTimeout(t)},[x,r]);const[M,{isLoading:C}]=ae(),[D,{isLoading:O}]=ie(),[$,{isLoading:T}]=re(),[B,{isLoading:j}]=se(),[_,{isLoading:ce}]=le(),[E,S]=o.exports.useState(0),[f,P]=o.exports.useState(!1),[L,U]=o.exports.useState([]),[z,y]=o.exports.useState(!1),[R,b]=o.exports.useState(null),[s,h]=o.exports.useState({type:"city",value:"",price:"",isActive:!0});o.exports.useEffect(()=>{console.log("Shipment Pricing Data:",r),console.log("Fetch Error:",i),console.log("Is Fetching:",x),r!=null&&r.data?(S(r.data.fixedPrice||0),P(r.data.isLocationBasedEnabled||!1),U(r.data.locationRules||[])):r&&!r.data&&(console.warn("No data in pricing response, using defaults"),S(0),P(!1),U([]))},[r,i,x]);const Q=async()=>{var t;try{await M({fixedPrice:parseFloat(E)}).unwrap(),d.success("Fixed shipping price updated successfully"),m()}catch(l){d.error(((t=l==null?void 0:l.data)==null?void 0:t.message)||"Failed to update fixed price")}},G=async()=>{var t;try{await D({isLocationBasedEnabled:!f}).unwrap(),P(!f),d.success("Location-based pricing toggled successfully"),m()}catch(l){d.error(((t=l==null?void 0:l.data)==null?void 0:t.message)||"Failed to toggle location-based pricing")}},H=()=>{b(null),h({type:"city",value:"",price:"",isActive:!0}),y(!0)},V=t=>{b(t),h({type:t.type,value:t.value,price:t.price.toString(),isActive:t.isActive}),y(!0)},J=async()=>{var t;if(!s.value.trim()||!s.price){d.error("Please fill all required fields");return}try{R?(await B({ruleId:R._id,...s,price:parseFloat(s.price)}).unwrap(),d.success("Location rule updated successfully")):(await $({...s,price:parseFloat(s.price)}).unwrap(),d.success("Location rule added successfully")),y(!1),b(null),m()}catch(l){d.error(((t=l==null?void 0:l.data)==null?void 0:t.message)||"Failed to save location rule")}},K=async t=>{var l;if(!!window.confirm("Are you sure you want to delete this rule?"))try{await _(t).unwrap(),d.success("Location rule deleted successfully"),m()}catch(p){d.error(((l=p==null?void 0:p.data)==null?void 0:l.message)||"Failed to delete location rule")}},W=async t=>{var l;try{await B({ruleId:t._id,isActive:!t.isActive}).unwrap(),d.success("Rule status updated successfully"),m()}catch(p){d.error(((l=p==null?void 0:p.data)==null?void 0:l.message)||"Failed to update rule status")}},X=[{id:"fixed-price",label:"Fixed Price",icon:"ph:currency-dollar"},{id:"location-based",label:"Location Based",icon:"ph:map-pin"}];if(x&&!r&&!i&&!w)return a("div",{className:"flex justify-center items-center h-64",children:[e(A,{}),e("p",{className:"ml-3 text-gray-600 dark:text-gray-400",children:"Loading shipment settings..."})]});if(i&&!r&&!w){console.error("Shipment Pricing Fetch Error:",i);const t=((I=i==null?void 0:i.data)==null?void 0:I.message)||(i==null?void 0:i.error)||((i==null?void 0:i.status)===401?"Unauthorized - Please login as admin":i==null?void 0:i.status)||"Unable to fetch data";return a("div",{className:"flex flex-col justify-center items-center h-64",children:[e(n,{icon:"ph:warning-circle",className:"text-4xl text-red-500 mb-4"}),e("p",{className:"text-red-500 text-lg mb-2",children:"Failed to load shipment settings"}),e("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:t}),a("div",{className:"flex gap-3",children:[a(g,{onClick:()=>m(),className:"btn btn-primary",children:[e(n,{icon:"ph:arrow-clockwise",className:"mr-2"}),"Retry"]}),e(g,{onClick:()=>F(!0),className:"btn btn-outline",children:"Continue Anyway"})]})]})}return i&&r&&console.warn("Shipment Pricing: Using cached data despite error:",i),a("div",{className:"space-y-6",children:[(i||w)&&e("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4 mb-4",children:a("div",{className:"flex items-center",children:[e(n,{icon:"ph:warning",className:"text-yellow-600 dark:text-yellow-400 mr-2"}),e("p",{className:"text-yellow-800 dark:text-yellow-300 text-sm",children:i?"Unable to load settings from server. Showing default values.":"Loading is taking longer than expected. Showing default values."})]})}),a("div",{className:"flex justify-between items-center",children:[a("div",{children:[e("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Shipment Settings"}),e("p",{className:"text-gray-600 dark:text-gray-400",children:"Manage shipping pricing and location-based rules"}),((q=r==null?void 0:r.data)==null?void 0:q.updatedAt)&&a("p",{className:"text-sm text-gray-500 dark:text-gray-500 mt-1",children:["Last updated: ",new Date(r.data.updatedAt).toLocaleString()]})]}),a(g,{onClick:()=>u("/dashboard"),className:"btn btn-outline",children:[e(n,{icon:"ph:arrow-left",className:"mr-2"}),"Back to Dashboard"]})]}),a("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e("div",{className:"lg:col-span-1",children:e(v,{className:"p-0",children:e("nav",{className:"space-y-1",children:X.map(t=>a("button",{onClick:()=>k(t.id),className:`w-full flex items-center px-4 py-3 text-sm font-medium rounded-lg transition-colors ${c===t.id?"bg-blue-50 text-blue-700 dark:bg-blue-900/20 dark:text-blue-400":"text-gray-600 hover:bg-gray-50 dark:text-gray-400 dark:hover:bg-gray-800"}`,children:[e(n,{icon:t.icon,className:"mr-3 text-lg"}),t.label]},t.id))})})}),a("div",{className:"lg:col-span-3",children:[c==="fixed-price"&&e(v,{title:"Fixed Shipping Price",children:a("div",{className:"space-y-6",children:[a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Default Shipping Price (\u20B9)"}),e("input",{type:"number",min:"0",step:"0.01",value:E,onChange:t=>S(t.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-700 dark:text-white",placeholder:"Enter default shipping price"}),e("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:"This price will be applied to all orders when no location-based rule matches."})]}),e("div",{className:"flex justify-end",children:e(g,{onClick:Q,disabled:C,className:"btn btn-primary",children:C?a(N,{children:[e(A,{className:"mr-2"}),"Saving..."]}):a(N,{children:[e(n,{icon:"ph:floppy-disk",className:"mr-2"}),"Save Fixed Price"]})})})]})}),c==="location-based"&&e("div",{className:"space-y-6",children:e(v,{title:"Location-Based Pricing",children:a("div",{className:"space-y-4",children:[a("div",{className:"flex items-center justify-between",children:[a("div",{children:[e("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Location-Based Pricing"}),e("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Enable location-based pricing to override fixed price based on city, place, or pincode"})]}),a("label",{className:"relative inline-flex items-center cursor-pointer",children:[e("input",{type:"checkbox",checked:f,onChange:G,disabled:O,className:"sr-only peer"}),e("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]})]}),f&&a("div",{className:"mt-6",children:[a("div",{className:"flex justify-between items-center mb-4",children:[a("h4",{className:"text-md font-semibold text-gray-900 dark:text-white",children:["Location Rules (",L.length,")"]}),a(g,{onClick:H,className:"btn btn-primary btn-sm",children:[e(n,{icon:"ph:plus",className:"mr-2"}),"Add Rule"]})]}),L.length===0?a("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e(n,{icon:"ph:map-pin",className:"text-4xl mb-2 mx-auto"}),e("p",{children:"No location rules configured"}),e("p",{className:"text-sm mt-1",children:'Click "Add Rule" to create your first rule'})]}):e("div",{className:"overflow-x-auto",children:a("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e("thead",{className:"bg-gray-50 dark:bg-gray-800",children:a("tr",{children:[e("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Type"}),e("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Value"}),e("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Price (\u20B9)"}),e("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Status"}),e("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),e("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700",children:L.map(t=>a("tr",{className:t.isActive?"":"opacity-60",children:[e("td",{className:"px-4 py-3 whitespace-nowrap",children:e("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",children:t.type})}),e("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:t.value}),a("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:["\u20B9",t.price.toFixed(2)]}),e("td",{className:"px-4 py-3 whitespace-nowrap",children:e("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${t.isActive?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}`,children:t.isActive?"Active":"Inactive"})}),e("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm font-medium",children:a("div",{className:"flex justify-end space-x-2",children:[e("button",{onClick:()=>W(t),className:"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300",title:t.isActive?"Deactivate":"Activate",children:e(n,{icon:t.isActive?"ph:eye-slash":"ph:eye",className:"text-lg"})}),e("button",{onClick:()=>V(t),className:"text-yellow-600 hover:text-yellow-900 dark:text-yellow-400 dark:hover:text-yellow-300",title:"Edit",children:e(n,{icon:"ph:pencil",className:"text-lg"})}),e("button",{onClick:()=>K(t._id),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300",title:"Delete",children:e(n,{icon:"ph:trash",className:"text-lg"})})]})})]},t._id))})]})})]})]})})})]})]}),z&&e("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a(v,{className:"w-full max-w-md",children:[a("div",{className:"flex justify-between items-center mb-4",children:[e("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:R?"Edit Location Rule":"Add Location Rule"}),e("button",{onClick:()=>{y(!1),b(null)},className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e(n,{icon:"ph:x",className:"text-xl"})})]}),a("div",{className:"space-y-4",children:[a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Rule Type *"}),a("select",{value:s.type,onChange:t=>h({...s,type:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-700 dark:text-white",children:[e("option",{value:"city",children:"City"}),e("option",{value:"place",children:"Place Name"}),e("option",{value:"pincode",children:"Pincode"})]})]}),a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:s.type==="city"?"City Name *":s.type==="place"?"Place Name *":"Pincode *"}),e("input",{type:"text",value:s.value,onChange:t=>h({...s,value:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-700 dark:text-white",placeholder:`Enter ${s.type}`})]}),a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Shipping Price (\u20B9) *"}),e("input",{type:"number",min:"0",step:"0.01",value:s.price,onChange:t=>h({...s,price:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-700 dark:text-white",placeholder:"Enter shipping price"})]}),a("div",{className:"flex items-center",children:[e("input",{type:"checkbox",checked:s.isActive,onChange:t=>h({...s,isActive:t.target.checked}),className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"}),e("label",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Active"})]}),a("div",{className:"flex justify-end space-x-3 pt-4",children:[e(g,{onClick:()=>{y(!1),b(null)},className:"btn btn-outline",children:"Cancel"}),e(g,{onClick:J,disabled:T||j,className:"btn btn-primary",children:T||j?a(N,{children:[e(A,{className:"mr-2"}),"Saving..."]}):a(N,{children:[e(n,{icon:"ph:floppy-disk",className:"mr-2"}),"Save"]})})]})]})]})})]})};export{oe as default};
