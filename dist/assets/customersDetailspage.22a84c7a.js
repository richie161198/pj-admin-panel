import{a1 as _,b as q,r as g,R as z,j as e,L as G,c as t,B as i,I as n,F as L,Q as d}from"./index.a3fd4963.js";import{b as W,c as Y,u as J}from"./authApiSlice.09c3723a.js";const X=()=>{var S,D,M,j,E,I;const{id:o}=_(),u=q(),{data:h,isLoading:P,error:v,refetch:b}=W(o),[w,{isLoading:y}]=Y(),[U,{isLoading:F}]=J(),a=(h==null?void 0:h.details)||h,[V,m]=g.exports.useState(!1),[$,x]=g.exports.useState(!1),[c,f]=g.exports.useState({name:"",email:"",phone:""}),[N,p]=g.exports.useState({message:""}),[C,A]=g.exports.useState(!1);z.useEffect(()=>{a&&f({name:a.name||"",email:a.email||"",phone:a.phone||""})},[a]);const R=async()=>{var r;if(window.confirm("Are you sure you want to delete this customer? This action cannot be undone."))try{await U(o).unwrap(),d.success("Customer deleted successfully"),u("/customers")}catch(s){const l=((r=s==null?void 0:s.data)==null?void 0:r.message)||(s==null?void 0:s.message)||"Failed to delete customer";d.error(l),console.error("Delete customer error:",s)}},T=async()=>{var r;try{await w({id:o,active:!a.active}).unwrap(),d.success(`Customer ${a.active?"deactivated":"activated"} successfully`),b()}catch(s){const l=((r=s==null?void 0:s.data)==null?void 0:r.message)||(s==null?void 0:s.message)||"Failed to update customer status";d.error(l),console.error("Update customer status error:",s)}},O=async r=>{var s;r.preventDefault();try{await w({id:o,...c}).unwrap(),d.success("Customer updated successfully"),m(!1),b()}catch(l){const B=((s=l==null?void 0:l.data)==null?void 0:s.message)||(l==null?void 0:l.message)||"Failed to update customer";d.error(B),console.error("Update customer error:",l)}},Q=async r=>{if(r.preventDefault(),!N.message.trim()){d.error("Please enter a message");return}if(!a.phone){d.error("Customer phone number is not available");return}A(!0);try{const s={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0}.VITE_API_URL||"http://localhost:5000",l=localStorage.getItem("adminToken")||localStorage.getItem("token"),k=await(await fetch(`${s}/api/v0/users/admin/sendWhatsAppMessage`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({phoneNumber:a.phone,message:N.message})})).json();k.status||k.success?(d.success("Message sent successfully"),x(!1),p({message:""})):d.error(k.message||"Failed to send message")}catch(s){console.error("Send message error:",s),d.error("Failed to send message. Please try again.")}finally{A(!1)}};return P?e("div",{className:"flex justify-center items-center h-64",children:e(G,{})}):v?t("div",{className:"text-center py-8",children:[t("p",{className:"text-red-500",children:["Error loading customer: ",v.message]}),e(i,{onClick:()=>b(),className:"mt-4",children:"Retry"})]}):a?t("div",{className:"space-y-6",children:[t("div",{className:"flex justify-between items-center",children:[t("div",{className:"flex items-center space-x-4",children:[t(i,{onClick:()=>u("/customers"),className:"btn btn-outline",children:[e(n,{icon:"ph:arrow-left",className:"mr-2"}),"Back"]}),t("div",{children:[e("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Customer Details"}),e("p",{className:"text-gray-600 dark:text-gray-400",children:"View and manage customer information"})]})]}),t("div",{className:"flex space-x-3",children:[t(i,{onClick:()=>m(!0),className:"btn btn-outline-secondary",children:[e(n,{icon:"ph:pencil",className:"mr-2"}),"Edit"]}),t(i,{onClick:T,disabled:y,className:`btn ${a.active?"btn-outline-warning":"btn-outline-success"}`,children:[e(n,{icon:a.active?"ph:pause":"ph:play",className:"mr-2"}),a.active?"Deactivate":"Activate"]}),t(i,{onClick:R,disabled:F,className:"btn btn-outline-danger",children:[e(n,{icon:"ph:trash",className:"mr-2"}),"Delete"]})]})]}),t("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t("div",{className:"lg:col-span-2",children:[e("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:t("div",{className:"flex items-start space-x-4",children:[e("div",{className:"flex-shrink-0",children:a.profilePhoto?e("img",{src:a.profilePhoto,alt:a.name,className:"h-20 w-20 rounded-full object-cover"}):e("div",{className:"h-20 w-20 rounded-full bg-blue-500 flex items-center justify-center text-white text-2xl font-bold",children:((D=(S=a.name)==null?void 0:S.charAt(0))==null?void 0:D.toUpperCase())||"C"})}),t("div",{className:"flex-1",children:[e("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:a.name||"N/A"}),t("p",{className:"text-gray-600 dark:text-gray-400",children:["Customer ID: ",a._id]}),t("div",{className:"mt-2 flex flex-wrap gap-2",children:[e("span",{className:`inline-flex px-3 py-1 text-sm font-semibold rounded-full ${a.active?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,children:a.active?"Active":"Inactive"}),a.isBlocked&&e("span",{className:"inline-flex px-3 py-1 text-sm font-semibold rounded-full bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",children:"Blocked"}),a.mobileVerified&&e("span",{className:"inline-flex px-3 py-1 text-sm font-semibold rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",children:"Mobile Verified"})]})]})]})}),t("div",{className:"mt-6 bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:[e("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Contact Information"}),t("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-500 dark:text-gray-400",children:"Email"}),e("p",{className:"mt-1 text-sm text-gray-900 dark:text-white",children:a.email||"N/A"})]}),t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-500 dark:text-gray-400",children:"Phone"}),e("p",{className:"mt-1 text-sm text-gray-900 dark:text-white",children:a.phone||"N/A"})]}),t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-500 dark:text-gray-400",children:"Address"}),e("p",{className:"mt-1 text-sm text-gray-900 dark:text-white",children:a.address&&a.address.length>0&&(((M=a.address.find(r=>r.isDefault))==null?void 0:M.street)||((j=a.address[0])==null?void 0:j.street))||"N/A"})]}),t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-500 dark:text-gray-400",children:"City"}),e("p",{className:"mt-1 text-sm text-gray-900 dark:text-white",children:a.address&&a.address.length>0&&(((E=a.address.find(r=>r.isDefault))==null?void 0:E.city)||((I=a.address[0])==null?void 0:I.city))||"N/A"})]})]})]}),t("div",{className:"mt-6 bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:[e("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Additional Information"}),t("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-500 dark:text-gray-400",children:"App ID"}),e("p",{className:"mt-1 text-sm text-gray-900 dark:text-white",children:a.appId||"N/A"})]}),t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-500 dark:text-gray-400",children:"Referral Code"}),e("p",{className:"mt-1 text-sm text-gray-900 dark:text-white",children:a.referralCode||"N/A"})]}),t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-500 dark:text-gray-400",children:"Role"}),e("p",{className:"mt-1 text-sm text-gray-900 dark:text-white",children:a.role||"N/A"})]}),t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-500 dark:text-gray-400",children:"Last Login"}),e("p",{className:"mt-1 text-sm text-gray-900 dark:text-white",children:a.lastLogin?new Date(a.lastLogin).toLocaleDateString():"Never"})]})]})]})]}),t("div",{className:"space-y-6",children:[t("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:[e("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Quick Stats"}),t("div",{className:"space-y-4",children:[t("div",{className:"flex justify-between",children:[e("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Balance"}),t("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:["\u20B9",a.balance||0]})]}),t("div",{className:"flex justify-between",children:[e("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Gold Balance"}),t("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[a.goldBalance||0," gm"]})]}),t("div",{className:"flex justify-between",children:[e("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Active Account"}),e("span",{className:`text-sm font-medium ${a.activeAccount?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:a.activeAccount?"Yes":"No"})]}),t("div",{className:"flex justify-between",children:[e("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Mobile Verified"}),e("span",{className:`text-sm font-medium ${a.mobileVerified?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:a.mobileVerified?"Yes":"No"})]})]})]}),t("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:[e("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Quick Actions"}),t("div",{className:"space-y-3",children:[t(i,{onClick:()=>u(`/customers/${o}/orders`),className:"btn btn-outline w-full justify-start",children:[e(n,{icon:"ph:shopping-bag",className:"mr-2"}),"View Orders"]}),t(i,{onClick:()=>x(!0),className:"btn btn-outline w-full justify-start",children:[e(n,{icon:"ph:chat-circle",className:"mr-2"}),"Send Message"]}),t(i,{onClick:()=>m(!0),className:"btn btn-outline w-full justify-start",children:[e(n,{icon:"ph:pencil",className:"mr-2"}),"Edit Profile"]})]})]})]})]}),V&&e("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex items-center justify-center",children:t("div",{className:"relative bg-white dark:bg-slate-800 rounded-lg shadow-lg p-6 w-full max-w-md",children:[t("div",{className:"flex justify-between items-center mb-4",children:[e("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Edit Customer"}),e("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e(n,{icon:"ph:x",className:"text-xl"})})]}),t("form",{onSubmit:O,className:"space-y-4",children:[t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Name *"}),e("input",{type:"text",value:c.name,onChange:r=>f({...c,name:r.target.value}),required:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-white"})]}),t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Email *"}),e("input",{type:"email",value:c.email,onChange:r=>f({...c,email:r.target.value}),required:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-white"})]}),t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Phone"}),e("input",{type:"tel",value:c.phone,onChange:r=>f({...c,phone:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-white"})]}),t("div",{className:"flex justify-end space-x-2 pt-4",children:[e(i,{type:"button",onClick:()=>m(!1),className:"btn btn-outline",children:"Cancel"}),e(i,{type:"submit",disabled:y,className:"btn btn-primary",children:y?"Updating...":"Update"})]})]})]})}),$&&e("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex items-center justify-center",children:t("div",{className:"relative bg-white dark:bg-slate-800 rounded-lg shadow-lg p-6 w-full max-w-md",children:[t("div",{className:"flex justify-between items-center mb-4",children:[e("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Send WhatsApp Message"}),e("button",{onClick:()=>{x(!1),p({message:""})},className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e(n,{icon:"ph:x",className:"text-xl"})})]}),t("form",{onSubmit:Q,className:"space-y-4",children:[e("div",{children:t("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["To: ",a.name," (",a.phone||"N/A",")"]})}),t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Message *"}),e("textarea",{value:N.message,onChange:r=>p({message:r.target.value}),required:!0,rows:5,placeholder:"Enter your message here...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-white"})]}),t("div",{className:"flex justify-end space-x-2 pt-4",children:[e(i,{type:"button",onClick:()=>{x(!1),p({message:""})},className:"btn btn-outline",children:"Cancel"}),e(i,{type:"submit",disabled:C||!a.phone,className:"btn btn-primary",children:C?t(L,{children:[e(n,{icon:"ph:spinner",className:"animate-spin mr-2"}),"Sending..."]}):t(L,{children:[e(n,{icon:"ph:paper-plane-tilt",className:"mr-2"}),"Send"]})})]})]})]})})]}):t("div",{className:"text-center py-8",children:[e("p",{className:"text-gray-500",children:"Customer not found"}),e(i,{onClick:()=>u("/customers"),className:"mt-4",children:"Back to Customers"})]})};export{X as default};
