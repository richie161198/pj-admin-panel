import{b as de,r as S,j as a,L as me,c as s,B as i,I as o,Q as D}from"./index.51fda1b3.js";import{u as he,b as ge}from"./productApi.a85569aa.js";import{u as $,w as xe}from"./xlsx.0799a57e.js";const we=()=>{const C=de(),[b,W]=S.exports.useState(""),[g,N]=S.exports.useState(1),[P,z]=S.exports.useState(""),f=12,{data:l,isLoading:K,error:x,refetch:j}=he(),[q,{isLoading:H}]=ge();let r=[];l&&(Array.isArray(l)?r=l:l.details&&Array.isArray(l.details)?r=l.details:l.data&&Array.isArray(l.data)?r=l.data:l.products&&Array.isArray(l.products)&&(r=l.products)),console.log("Products Response:",l),console.log("Products:",r);const X=Array.isArray(r)?[...new Set(r.map(e=>e.categories))]:[],v=Array.isArray(r)?r.filter(e=>{var w,m,h,y;const n=((w=e.name)==null?void 0:w.toLowerCase().includes(b.toLowerCase()))||((m=e.brand)==null?void 0:m.toLowerCase().includes(b.toLowerCase()))||((h=e.skuId)==null?void 0:h.toLowerCase().includes(b.toLowerCase()))||((y=e.categories)==null?void 0:y.toLowerCase().includes(b.toLowerCase())),d=!P||e.categories===P;return n&&d}):[],u=Math.ceil(v.length/f),k=(g-1)*f,Z=v.slice(k,k+f),ee=async e=>{if(window.confirm("Are you sure you want to delete this product?"))try{await q(e).unwrap(),D.success("Product deleted successfully"),j()}catch{D.error("Failed to delete product")}},te=()=>{C("/products/add")},ae=e=>{C(`/products/${e._id}/edit`)},se=e=>{C(`/products/${e}`)},le=()=>{try{const e=r.map((t,re)=>{var T,E,M,O,R,U,F,Y,G,J,Q;let L="N/A";t.productDetails&&t.productDetails.length>0&&(L=t.productDetails.map((c,A)=>{const ne=c.attributes||{},V=Object.entries(ne).map(([ce,oe])=>`${ce}: ${oe}`).join(", ");return`${c.type}${V?` (${V})`:""}`}).join("; "));let B="N/A",_=[];t.priceDetails&&t.priceDetails.length>0&&(_=t.priceDetails.map((c,A)=>`${c.name||"Component "+(A+1)}: ${c.weight||"N/A"} - \u20B9${c.value||0}`),B=_.join("; "));const I=((T=t.priceDetails)==null?void 0:T.reduce((c,A)=>c+(parseFloat(A.value)||0),0))||0,ie=I+(parseFloat(t.gst)||0);return{"S.No":re+1,"Product ID":t._id,Name:t.name||"N/A",Brand:t.brand||"N/A",Description:t.description||"N/A","SKU ID":t.skuId||"N/A",Category:t.categories||"N/A","Product Details":L,"Price Breakdown":B,"Price Component 1":(E=t.priceDetails)!=null&&E[0]?`${t.priceDetails[0].name||"N/A"}: ${t.priceDetails[0].weight||"N/A"} - \u20B9${t.priceDetails[0].value||0}`:"N/A","Price Component 2":(M=t.priceDetails)!=null&&M[1]?`${t.priceDetails[1].name||"N/A"}: ${t.priceDetails[1].weight||"N/A"} - \u20B9${t.priceDetails[1].value||0}`:"N/A","Price Component 3":(O=t.priceDetails)!=null&&O[2]?`${t.priceDetails[2].name||"N/A"}: ${t.priceDetails[2].weight||"N/A"} - \u20B9${t.priceDetails[2].value||0}`:"N/A","Price Component 4":(R=t.priceDetails)!=null&&R[3]?`${t.priceDetails[3].name||"N/A"}: ${t.priceDetails[3].weight||"N/A"} - \u20B9${t.priceDetails[3].value||0}`:"N/A","Price Component 5":(U=t.priceDetails)!=null&&U[4]?`${t.priceDetails[4].name||"N/A"}: ${t.priceDetails[4].weight||"N/A"} - \u20B9${t.priceDetails[4].value||0}`:"N/A","Subtotal (from Price Details)":I,GST:t.gst||0,"Total (Subtotal + GST)":ie,"Selling Price":t.sellingprice||0,Weight:((F=t.subtotal)==null?void 0:F.weight)||"N/A",Discount:t.Discount||0,"Discount Available":t.isDiscountAvailable?"Yes":"No","Selected Carat":t.selectedCaret||"N/A","Caret Options":((Y=t.caretOptions)==null?void 0:Y.join(", "))||"N/A",Stock:t.stock||0,Status:t.active?"Active":"Inactive","Currently Not Available":t.CurrentlyNotAvailable?"Yes":"No",Trending:t.trending?"Yes":"No",Popular:t.popular?"Yes":"No",Rating:((G=t.rating)==null?void 0:G.value)||0,"Rating Count":((J=t.rating)==null?void 0:J.count)||0,"Images Count":((Q=t.images)==null?void 0:Q.length)||0,"Created At":t.createdAt?new Date(t.createdAt).toLocaleDateString():"N/A","Updated At":t.updatedAt?new Date(t.updatedAt).toLocaleDateString():"N/A"}}),n=$.book_new(),d=$.json_to_sheet(e),w=[{wch:5},{wch:25},{wch:30},{wch:20},{wch:40},{wch:20},{wch:15},{wch:50},{wch:60},{wch:30},{wch:30},{wch:30},{wch:30},{wch:30},{wch:20},{wch:12},{wch:18},{wch:15},{wch:10},{wch:12},{wch:18},{wch:15},{wch:20},{wch:10},{wch:10},{wch:20},{wch:10},{wch:10},{wch:10},{wch:12},{wch:12},{wch:15},{wch:15}];d["!cols"]=w,$.book_append_sheet(n,d,"Products");const m=xe(n,{bookType:"xlsx",type:"array"}),h=new Blob([m],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),y=window.URL.createObjectURL(h),p=document.createElement("a");p.href=y,p.download=`products_export_${new Date().toISOString().split("T")[0]}.xlsx`,document.body.appendChild(p),p.click(),document.body.removeChild(p),window.URL.revokeObjectURL(y),D.success("Product data exported successfully!")}catch(e){console.error("Export error:",e),D.error("Failed to export product data")}};return K?a("div",{className:"flex justify-center items-center h-64",children:a(me,{})}):x?(console.error("Products Error:",x),s("div",{className:"text-center py-8",children:[s("p",{className:"text-red-500",children:["Error loading products: ",x.message]}),s("p",{className:"text-sm text-gray-500",children:["Status: ",x.status]}),s("p",{className:"text-sm text-gray-500",children:["Data: ",JSON.stringify(x.data)]}),s("div",{className:"mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-lg text-left",children:[a("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Full Error:"}),a("pre",{className:"text-xs text-gray-500 dark:text-gray-500 mt-2 overflow-auto",children:JSON.stringify(x,null,2)})]}),a(i,{onClick:()=>j(),className:"mt-4",children:"Retry"})]})):s("div",{className:"space-y-6",children:[s("div",{className:"flex justify-between items-center",children:[s("div",{children:[a("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Products"}),a("p",{className:"text-gray-600 dark:text-gray-400",children:"Manage your product catalog"})]}),s("div",{className:"flex space-x-3",children:[s(i,{onClick:le,className:"btn btn-outline-success",disabled:!r||r.length===0,children:[a(o,{icon:"ph:download",className:"mr-2"}),"Export Excel"]}),s(i,{onClick:te,className:"btn btn-primary",children:[a(o,{icon:"ph:plus",className:"mr-2"}),"Add Product"]})]})]}),a("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:s("div",{className:"flex flex-col lg:flex-row gap-4",children:[a("div",{className:"flex-1",children:s("div",{className:"relative",children:[a(o,{icon:"ph:magnifying-glass",className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),a("input",{type:"text",placeholder:"Search products...",value:b,onChange:e=>W(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-700 dark:text-white"})]})}),a("div",{className:"lg:w-64",children:s("select",{value:P,onChange:e=>z(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-700 dark:text-white",children:[a("option",{value:"",children:"All Categories"}),X.map(e=>a("option",{value:e,children:e},e))]})})]})}),a("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:Z.map(e=>{var n,d;return s("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm overflow-hidden hover:shadow-md transition-shadow",children:[s("div",{className:"relative h-48 bg-gray-100 dark:bg-slate-700",children:[e.images&&e.images.length>0?a("img",{src:e.images[0],alt:e.name,className:"w-full h-full object-cover"}):a("div",{className:"w-full h-full flex items-center justify-center",children:a(o,{icon:"ph:image",className:"text-4xl text-gray-400"})}),s("div",{className:"absolute top-2 left-2 flex flex-col gap-1",children:[e.trending&&a("span",{className:"bg-orange-500 text-white text-xs px-2 py-1 rounded-full",children:"Trending"}),e.popular&&a("span",{className:"bg-green-500 text-white text-xs px-2 py-1 rounded-full",children:"Popular"})]}),a("div",{className:"absolute top-2 right-2",children:a("span",{className:`text-xs px-2 py-1 rounded-full ${e.stock>0?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,children:e.stock>0?`Stock: ${e.stock}`:"Out of Stock"})})]}),s("div",{className:"p-4",children:[s("div",{className:"flex justify-between items-start mb-2",children:[a("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white line-clamp-2",children:e.name}),a("span",{className:`text-xs px-2 py-1 rounded-full ${e.active?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,children:e.active?"Active":"Inactive"})]}),a("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:e.brand}),a("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-3",children:e.categories}),s("div",{className:"flex items-center mb-3",children:[a("div",{className:"flex items-center",children:[...Array(5)].map((w,m)=>{var h;return a(o,{icon:"ph:star-fill",className:`w-4 h-4 ${m<Math.floor(((h=e.rating)==null?void 0:h.value)||0)?"text-yellow-400":"text-gray-300"}`},m)})}),s("span",{className:"text-sm text-gray-600 dark:text-gray-400 ml-2",children:["(",((n=e.rating)==null?void 0:n.count)||0,")"]})]}),s("div",{className:"flex justify-between items-center mb-4",children:[s("div",{children:[s("span",{className:"text-lg font-bold text-gray-900 dark:text-white",children:["\u20B9",((d=e.sellingprice)==null?void 0:d.toLocaleString())||0]}),e.total&&e.total!==e.sellingprice&&s("span",{className:"text-sm text-gray-500 dark:text-gray-400 line-through ml-2",children:["\u20B9",e.total.toLocaleString()]})]}),a("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.selectedCaret})]}),s("div",{className:"flex space-x-2",children:[s(i,{onClick:()=>se(e._id),className:"btn btn-sm btn-outline-primary flex-1",children:[a(o,{icon:"ph:eye",className:"mr-1"}),"View"]}),a(i,{onClick:()=>ae(e),className:"btn btn-sm btn-outline-secondary",children:a(o,{icon:"ph:pencil"})}),a(i,{onClick:()=>ee(e._id),disabled:H,className:"btn btn-sm btn-outline-danger",children:a(o,{icon:"ph:trash"})})]})]})]},e._id)})}),u>1&&s("div",{className:"bg-white dark:bg-slate-800 px-4 py-3 flex items-center justify-between border-t border-gray-200 dark:border-gray-700 sm:px-6",children:[s("div",{className:"flex-1 flex justify-between sm:hidden",children:[a(i,{onClick:()=>N(e=>Math.max(e-1,1)),disabled:g===1,className:"btn btn-sm btn-outline",children:"Previous"}),a(i,{onClick:()=>N(e=>Math.min(e+1,u)),disabled:g===u,className:"btn btn-sm btn-outline",children:"Next"})]}),s("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[a("div",{children:s("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Showing ",a("span",{className:"font-medium",children:k+1})," to"," ",a("span",{className:"font-medium",children:Math.min(k+f,v.length)})," ","of ",a("span",{className:"font-medium",children:v.length})," results"]})}),a("div",{children:s("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px",children:[a(i,{onClick:()=>N(e=>Math.max(e-1,1)),disabled:g===1,className:"btn btn-sm btn-outline rounded-l-md",children:"Previous"}),Array.from({length:u},(e,n)=>n+1).map(e=>a(i,{onClick:()=>N(e),className:`btn btn-sm ${g===e?"btn-primary":"btn-outline"}`,children:e},e)),a(i,{onClick:()=>N(e=>Math.min(e+1,u)),disabled:g===u,className:"btn btn-sm btn-outline rounded-r-md",children:"Next"})]})})]})]})]})};export{we as default};
