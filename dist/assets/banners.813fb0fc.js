import{r as n,j as e,c as s}from"./index.ce738da1.js";import{a as b}from"./axios.3cf09fd2.js";import"./productApi.0617a2ca.js";const V=({children:o,className:m=""})=>e("div",{className:`border rounded bg-white ${m}`,children:o}),g=({children:o,className:m="",onClick:x,type:C="button",disabled:S})=>e("button",{type:C,disabled:S,onClick:x,className:`px-4 py-2 border rounded ${S?"opacity-60 cursor-not-allowed":""} ${m}`,children:o}),$=({className:o=""})=>e("span",{className:o,"aria-hidden":!0}),ye=o=>e("input",{...o,className:`w-full border rounded px-3 py-2 ${o.className||""}`}),D=({children:o,...m})=>e("select",{...m,className:`w-full border rounded px-3 py-2 ${m.className||""}`,children:o}),be=({checked:o,onChange:m,name:x})=>e("input",{type:"checkbox",name:x,checked:o,onChange:m}),Be=()=>{const[o,m]=n.exports.useState([]),[x,C]=n.exports.useState(!0);n.exports.useState(!1);const[S,P]=n.exports.useState(!1),[U,re]=n.exports.useState(null),[B,R]=n.exports.useState(null),[A,z]=n.exports.useState(null),[k,E]=n.exports.useState(null),[_,M]=n.exports.useState(null),[L,W]=n.exports.useState(!1),[q,xe]=n.exports.useState(""),[p,ie]=n.exports.useState("all"),[N,G]=n.exports.useState(1),[j,le]=n.exports.useState(1),[v,ne]=n.exports.useState("all"),oe=(()=>{const t=new Set;return o.forEach(a=>{a.category&&a.category.trim()&&t.add(a.category.trim())}),Array.from(t).sort()})(),[c,H]=n.exports.useState({position:0,isActive:!0,category:"",bannerType:"image"}),[Y,w]=n.exports.useState(""),F=async()=>{var t;try{C(!0);const a=await b.get("/banners",{params:{page:N,limit:10,search:q,isActive:p==="all"?void 0:p==="active"}});a.data.success&&(m(a.data.data.banners||[]),le(((t=a.data.data.pagination)==null?void 0:t.totalPages)||1))}catch(a){console.error("Error fetching banners:",a)}finally{C(!1)}};n.exports.useEffect(()=>{F()},[N,q,p]);const I=t=>{const{name:a,value:r,type:l,checked:u}=t.target;H(i=>({...i,[a]:l==="checkbox"?u:r}))},J=t=>{var l;const a=(l=t.target.files)==null?void 0:l[0];if(!a)return;if(!a.type.startsWith("image/")){alert("Please select a valid image file");return}if(a.size>8*1024*1024){alert("Image size should be less than 8MB");return}R(a);const r=URL.createObjectURL(a);z(r)},ce=t=>{var l;const a=(l=t.target.files)==null?void 0:l[0];if(!a)return;if(!a.type.startsWith("video/")){alert("Please select a valid video file");return}if(a.size>100*1024*1024){alert("Video size should be less than 100MB");return}E(a);const r=URL.createObjectURL(a);M(r)},de=(t,a)=>!t||!a?!1:o.some(r=>r.category===t&&r.position===Number(a)&&r._id!==(U==null?void 0:U._id)),ue=async t=>{var r,l,u,i,f,Q,X,Z,ee;t.preventDefault();const a=c.category==="video-banner";if(a){if(!k){alert("Please choose a video file");return}if(!B){alert("Please choose a thumbnail image for the video");return}}else if(!B){alert("Please choose an image");return}if(!c.category){alert("Please select a category");return}if(de(c.category,c.position)){w(`Position ${c.position} is already set for category "${c.category}". Please change the position.`);return}w(""),W(!0);try{const d=new FormData;d.append("image",B);const h=await b.post("/images/upload",d,{headers:{"Content-Type":"multipart/form-data"}});if(!((r=h.data)!=null&&r.success))throw new Error("Image upload failed");const y=h.data.data;let T=null;if(a&&k){const te=new FormData;te.append("video",k);const ae=await b.post("/images/upload-video",te,{headers:{"Content-Type":"multipart/form-data"},timeout:3e5,onUploadProgress:se=>{const fe=Math.round(se.loaded*100/se.total);console.log(`Video upload progress: ${fe}%`)}});if(!((l=ae.data)!=null&&l.success))throw new Error("Video upload failed");T=ae.data.data}const ve={position:Number(c.position)||0,isActive:!!c.isActive,category:c.category,bannerType:a?"video":"image",imageUrl:y.url,publicId:y.public_id,imageWidth:y.width,imageHeight:y.height,imageFormat:y.format,imageBytes:y.bytes,...T&&{videoUrl:T.url,videoPublicId:T.public_id,videoThumbnail:y.url}};if(!((u=(await b.post("/banners",ve)).data)!=null&&u.success))throw new Error("Banner save failed");O(),P(!1),await F()}catch(d){console.error("Error saving banner:",d);let h=((f=(i=d==null?void 0:d.response)==null?void 0:i.data)==null?void 0:f.message)||((X=(Q=d==null?void 0:d.response)==null?void 0:Q.data)==null?void 0:X.error)||d.message||"Failed to save";d.code==="ECONNABORTED"?h="Upload timed out. Please try with a smaller video file.":((Z=d.response)==null?void 0:Z.status)===413?h="File too large. Maximum video size is 100MB.":((ee=d.response)==null?void 0:ee.status)===500&&(h="Server error during upload. Please try again."),h.includes("position")||h.includes("Position")?w(h):alert(h)}finally{W(!1)}},O=()=>{H({position:0,isActive:!0,category:"",bannerType:"image"}),z(null),R(null),M(null),E(null),re(null),w("")},me=()=>{const t={};return o.forEach(a=>{const r=a.category||"Uncategorized";t[r]||(t[r]=[]),t[r].push(a)}),t},pe=()=>{let t=o;return p!=="all"&&(t=t.filter(a=>p==="active"?a.isActive:!a.isActive)),v!=="all"&&(t=t.filter(a=>(a.category||"Uncategorized")===v)),t},K=()=>{O(),P(!0)},he=async t=>{if(!!window.confirm("Are you sure you want to delete this banner?"))try{(await b.delete(`/banners/${t}`)).data.success&&F()}catch(a){console.error("Error deleting banner:",a),alert("Failed to delete banner")}},ge=async(t,a)=>{try{(await b.patch(`/banners/${t}/toggle`)).data.success&&F()}catch(r){console.error("Error toggling banner status:",r),alert("Failed to update banner status")}};return x?e("div",{className:"flex items-center justify-center h-64",children:"Loading..."}):s("div",{className:"space-y-6",children:[s("div",{className:"flex justify-between items-center",children:[s("div",{children:[e("h1",{className:"text-2xl font-bold text-gray-900",children:"Banner Management"}),e("p",{className:"text-gray-600",children:"Manage your website banners and promotional content"})]}),s(g,{onClick:K,className:"bg-blue-600 text-white hover:bg-blue-700",children:[e($,{icon:"heroicons:plus",className:"w-5 h-5 mr-2"}),"Add New Banner"]})]}),e(V,{className:"p-6",children:s("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),s(D,{value:v,onChange:t=>ne(t.target.value),children:[e("option",{value:"all",children:"All Categories"}),oe.map(t=>e("option",{value:t,children:t},t))]})]}),s("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),s(D,{value:p,onChange:t=>ie(t.target.value),children:[e("option",{value:"all",children:"All Banners"}),e("option",{value:"active",children:"Active Only"}),e("option",{value:"inactive",children:"Inactive Only"})]})]})]})}),S&&s("div",{className:"p-4 border rounded space-y-3",children:[s("div",{className:"flex items-center justify-between",children:[e("h2",{className:"font-medium",children:"Create New Banner"}),e("button",{className:"text-sm",onClick:()=>P(!1),children:"Close"})]}),s("form",{onSubmit:ue,className:"space-y-3",children:[s("div",{children:[s("label",{className:"block text-sm mb-1",children:["Category ",e("span",{className:"text-red-500",children:"*"})]}),s(D,{name:"category",value:c.category,onChange:t=>{I(t),t.target.value!=="video-banner"&&(E(null),M(null))},required:!0,children:[e("option",{value:"",children:"Select Category"}),e("option",{value:"main",children:"Main"}),e("option",{value:"offer&deals",children:"Offer & Deals"}),e("option",{value:"ecommerce",children:"Ecommerce"}),e("option",{value:"top-collections",children:"Top Collections"}),e("option",{value:"video-banner",children:"Video Banner"})]}),c.category==="video-banner"&&e("p",{className:"text-xs text-blue-600 mt-1",children:"Video banners will be displayed under Top Collections section in the app"})]}),s("div",{children:[s("label",{className:"block text-sm mb-1",children:["Position ",e("span",{className:"text-red-500",children:"*"})]}),e(ye,{type:"number",name:"position",value:c.position,onChange:t=>{I(t),w("")},min:"0",required:!0}),Y&&e("p",{className:"text-red-500 text-xs mt-1",children:Y})]}),s("div",{className:"flex items-center gap-2",children:[e(be,{name:"isActive",checked:c.isActive,onChange:I}),e("span",{className:"text-sm",children:"Active"})]}),c.category==="video-banner"?s("div",{className:"space-y-4",children:[s("div",{children:[s("label",{className:"block text-sm mb-1",children:["Video File ",e("span",{className:"text-red-500",children:"*"})]}),e("input",{type:"file",accept:"video/*",onChange:ce}),_&&e("video",{src:_,controls:!0,className:"mt-3 h-40 object-cover rounded w-full"})]}),s("div",{children:[s("label",{className:"block text-sm mb-1",children:["Thumbnail Image ",e("span",{className:"text-red-500",children:"*"})]}),e("input",{type:"file",accept:"image/*",onChange:J}),A&&e("img",{src:A,alt:"thumbnail preview",className:"mt-3 h-40 object-cover rounded"})]})]}):s("div",{children:[s("label",{className:"block text-sm mb-1",children:["Banner Image ",e("span",{className:"text-red-500",children:"*"})]}),e("input",{type:"file",accept:"image/*",onChange:J}),A&&e("img",{src:A,alt:"preview",className:"mt-3 h-40 object-cover rounded"})]}),s("div",{className:"flex justify-end gap-2",children:[e(g,{type:"button",onClick:()=>{O(),P(!1)},children:"Cancel"}),e(g,{type:"submit",className:"bg-blue-600 text-white",disabled:L||!B||c.category==="video-banner"&&!k,children:L?"Uploading...":"Save Banner"})]})]})]}),(()=>{const t=pe(),a=me(),r={};return Object.keys(a).forEach(l=>{(v==="all"||l===v)&&(r[l]=a[l].filter(u=>p==="all"?!0:p==="active"?u.isActive:!u.isActive),r[l].length===0&&delete r[l])}),t.length===0?s(V,{className:"p-8 text-center",children:[e($,{icon:"heroicons:photo",className:"w-16 h-16 mx-auto text-gray-400 mb-4"}),e("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Banners Found"}),e("p",{className:"text-gray-600 mb-4",children:v!=="all"||p!=="all"?"No banners match your current filters.":"Get started by creating your first banner."}),v==="all"&&p==="all"&&s(g,{onClick:K,className:"bg-blue-600 hover:bg-blue-700",children:[e($,{icon:"heroicons:plus",className:"w-5 h-5 mr-2"}),"Create Your First Banner"]})]}):e("div",{className:"space-y-8",children:Object.keys(r).map(l=>{const u=r[l];return u.length===0?null:s("div",{className:"space-y-4",children:[e("div",{className:"flex items-center justify-between border-b pb-2",children:s("h2",{className:"text-lg font-bold text-gray-900 uppercase",children:[l,s("span",{className:"ml-2 text-sm font-normal text-gray-500",children:["(",u.length," ",u.length===1?"banner":"banners",")"]})]})}),e("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:u.map(i=>s(V,{className:"overflow-hidden",children:[s("div",{className:"relative",children:[i.bannerType==="video"&&i.videoUrl?e("video",{src:i.videoUrl,poster:i.videoThumbnail||i.imageUrl,className:"w-full h-48 object-cover",muted:!0,loop:!0,onMouseOver:f=>f.target.play(),onMouseOut:f=>{f.target.pause(),f.target.currentTime=0}}):e("img",{src:i.imageUrl,alt:i.category||"Banner",className:"w-full h-48 object-cover"}),s("div",{className:"absolute top-2 right-2 flex gap-2",children:[i.bannerType==="video"&&e("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:"Video"}),e("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${i.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:i.isActive?"Active":"Inactive"})]})]}),s("div",{className:"p-4",children:[i.description&&e("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2",children:i.description}),s("div",{className:"space-y-2 text-sm text-gray-500",children:[s("div",{className:"flex justify-between",children:[e("span",{children:"Position:"}),e("span",{children:i.position})]}),i.targetAudience&&s("div",{className:"flex justify-between",children:[e("span",{children:"Target:"}),e("span",{className:"capitalize",children:i.targetAudience})]})]}),s("div",{className:"flex gap-2 mt-4",children:[e(g,{onClick:()=>ge(i._id,i.isActive),children:i.isActive?"Set Inactive":"Set Active"}),e(g,{onClick:()=>he(i._id),className:"text-red-600",children:"Delete"})]})]})]},i._id))})]},l)})})})(),j>1&&s("div",{className:"flex justify-center space-x-2",children:[e(g,{variant:"outline",onClick:()=>G(t=>Math.max(1,t-1)),disabled:N===1,children:"Previous"}),s("span",{className:"flex items-center px-4 py-2 text-sm text-gray-700",children:["Page ",N," of ",j]}),e(g,{variant:"outline",onClick:()=>G(t=>Math.min(j,t+1)),disabled:N===j,children:"Next"})]})]})};export{Be as default};
