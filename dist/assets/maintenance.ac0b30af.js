import{r as l,a8 as k,a9 as I,j as e,c as n,Q as M}from"./index.a3fd4963.js";const C=s=>{if(!s)return"";const r=new Date(s);if(Number.isNaN(r.getTime()))return"";const o=r.getTimezoneOffset();return new Date(r.getTime()-o*6e4).toISOString().slice(0,16)},j=s=>{if(!s)return null;const r=new Date(s);return Number.isNaN(r.getTime())?null:r.toISOString()},P=()=>{const[s,r]=l.exports.useState(!1),[o,m]=l.exports.useState(""),[h,b]=l.exports.useState(""),[u,x]=l.exports.useState(""),[y,N]=l.exports.useState("emergency"),[D,w]=l.exports.useState(["all"]),[O,T]=l.exports.useState(""),[A,S]=l.exports.useState(""),{data:i,isLoading:E,refetch:g}=k(),[v,{isLoading:p}]=I();l.exports.useEffect(()=>{if(i!=null&&i.data){const a=i.data;r(a.isMaintenanceMode||!1),m(a.maintenanceMessage||""),b(a.maintenanceTitle||""),x(C(a.estimatedEndTime)),N(a.maintenanceType||"emergency"),w(a.affectedServices||["all"]),T(a.allowedIPs?a.allowedIPs.join(", "):""),S(a.allowedUserIds?a.allowedUserIds.join(", "):"");try{if(a.isMaintenanceMode&&a.estimatedEndTime){const c=new Date(a.estimatedEndTime),t=new Date;if(!Number.isNaN(c.getTime())&&c.getTime()<=t.getTime()){const d={isMaintenanceMode:!1,maintenanceMessage:a.maintenanceMessage||"",maintenanceTitle:a.maintenanceTitle||"",estimatedEndTime:null,maintenanceType:a.maintenanceType||"emergency"};console.log("Auto-disabling maintenance because estimatedEndTime has passed:",{endTime:c,now:t,autoUpdateData:d}),v(d).unwrap().then(f=>{console.log("Auto-disable maintenance response:",f),r(!1),g()}).catch(f=>{console.error("Error auto-disabling maintenance:",f)})}}}catch(c){console.error("Error in auto-disable maintenance check:",c)}}},[i]);const U=async a=>{var c;a.preventDefault();try{const t={isMaintenanceMode:s,maintenanceMessage:o,maintenanceTitle:h,estimatedEndTime:u?j(u):null,maintenanceType:y};console.log("Updating maintenance with data:",t);const d=await v(t).unwrap();console.log("Maintenance update response:",d),d.status&&(M.success(d.message),g())}catch(t){console.error("Error updating maintenance:",t),console.error("Error details:",{status:t==null?void 0:t.status,data:t==null?void 0:t.data,message:t==null?void 0:t.message}),M.error(((c=t==null?void 0:t.data)==null?void 0:c.message)||(t==null?void 0:t.message)||"Failed to update maintenance status")}};return E?e("div",{className:"flex items-center justify-center h-64",children:e("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e("div",{className:"p-6",children:e("div",{className:"max-w-4xl mx-auto",children:n("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[n("div",{className:"flex items-center justify-between mb-6",children:[n("div",{children:[e("h1",{className:"text-2xl font-bold text-gray-900",children:"App Maintenance"}),e("p",{className:"text-gray-600 mt-1",children:"Control app maintenance mode and settings"})]}),e("div",{className:`px-4 py-2 rounded-full text-sm font-medium ${s?"bg-red-100 text-red-800":"bg-green-100 text-green-800"}`,children:s?"Maintenance ON":"Maintenance OFF"})]}),n("form",{onSubmit:U,className:"space-y-6",children:[e("div",{className:"bg-gray-50 p-4 rounded-lg",children:n("div",{className:"flex items-center justify-between",children:[n("div",{children:[e("h3",{className:"text-lg font-semibold text-gray-900",children:"App Maintenance Mode"}),e("p",{className:"text-sm text-gray-600",children:"Enable or disable app maintenance mode"})]}),n("label",{className:"relative inline-flex items-center cursor-pointer",children:[e("input",{type:"checkbox",className:"sr-only peer",checked:s,onChange:a=>r(a.target.checked)}),e("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]})}),s&&n("div",{className:"space-y-4",children:[n("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Maintenance Title"}),e("input",{type:"text",value:h,onChange:a=>b(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"System Maintenance"})]}),n("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Maintenance Type"}),n("select",{value:y,onChange:a=>N(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e("option",{value:"emergency",children:"Emergency"}),e("option",{value:"scheduled",children:"Scheduled"}),e("option",{value:"update",children:"Update"})]})]})]}),n("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Maintenance Message"}),e("textarea",{value:o,onChange:a=>m(a.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"We are currently performing maintenance. Please try again later."})]}),n("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Estimated End Time"}),e("input",{type:"datetime-local",value:u,onChange:a=>x(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),n("div",{className:"flex justify-end space-x-4",children:[e("button",{type:"button",onClick:()=>g(),className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"}),e("button",{type:"submit",disabled:p,className:`px-6 py-2 rounded-md font-medium transition-colors ${s?"bg-red-600 hover:bg-red-700 text-white":"bg-green-600 hover:bg-green-700 text-white"} ${p?"opacity-50 cursor-not-allowed":""}`,children:p?"Updating...":s?"Enable Maintenance":"Disable Maintenance"})]})]}),(i==null?void 0:i.data)&&n("div",{className:"mt-8 p-4 bg-gray-50 rounded-lg",children:[e("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Current Status"}),n("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[n("div",{children:[e("span",{className:"font-medium text-gray-700",children:"Status:"}),e("span",{className:`ml-2 px-2 py-1 rounded-full text-xs ${i.data.isMaintenanceMode?"bg-red-100 text-red-800":"bg-green-100 text-green-800"}`,children:i.data.isMaintenanceMode?"Maintenance ON":"Maintenance OFF"})]}),i.data.lastUpdated&&n("div",{children:[e("span",{className:"font-medium text-gray-700",children:"Last Updated:"}),e("span",{className:"ml-2 text-gray-600",children:new Date(i.data.lastUpdated).toLocaleString()})]})]})]})]})})})};export{P as default};
