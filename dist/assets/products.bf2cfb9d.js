import{b as W,r as P,j as t,L as Y,c as a,B as n,I as c,Q as v}from"./index.2de9f08c.js";import{u as z,b as K}from"./productApi.2e563199.js";import{u as S,w as q}from"./xlsx.0799a57e.js";const ee=()=>{const A=W(),[u,E]=P.exports.useState(""),[h,b]=P.exports.useState(1),[C,M]=P.exports.useState(""),w=12,{data:r,isLoading:R,error:g,refetch:L}=z(),[O,{isLoading:T}]=K();let l=[];r&&(Array.isArray(r)?l=r:r.details&&Array.isArray(r.details)?l=r.details:r.data&&Array.isArray(r.data)?l=r.data:r.products&&Array.isArray(r.products)&&(l=r.products)),console.log("Products Response:",r),console.log("Products:",l);const $=Array.isArray(l)?[...new Set(l.map(e=>e.categories))]:[],p=Array.isArray(l)?l.filter(e=>{var y,o,m,f;const i=((y=e.name)==null?void 0:y.toLowerCase().includes(u.toLowerCase()))||((o=e.brand)==null?void 0:o.toLowerCase().includes(u.toLowerCase()))||((m=e.skuId)==null?void 0:m.toLowerCase().includes(u.toLowerCase()))||((f=e.categories)==null?void 0:f.toLowerCase().includes(u.toLowerCase())),d=!C||e.categories===C;return i&&d}):[],x=Math.ceil(p.length/w),k=(h-1)*w,B=p.slice(k,k+w),U=async e=>{if(window.confirm("Are you sure you want to delete this product?"))try{await O(e).unwrap(),v.success("Product deleted successfully"),L()}catch{v.error("Failed to delete product")}},F=()=>{A("/products/add")},G=e=>{A(`/products/${e._id}/edit`)},J=e=>{A(`/products/${e}`)},Q=()=>{try{const e=l.map((s,V)=>{var j,_,D,I;return{"S.No":V+1,"Product ID":s._id,Name:s.name||"N/A",Brand:s.brand||"N/A","SKU ID":s.skuId||"N/A",Category:s.categories||"N/A","Selling Price":s.sellingprice||0,Stock:s.stock||0,Status:s.active?"Active":"Inactive",Trending:s.trending?"Yes":"No",Popular:s.popular?"Yes":"No",Rating:((j=s.rating)==null?void 0:j.value)||0,"Rating Count":((_=s.rating)==null?void 0:_.count)||0,Weight:((D=s.subtotal)==null?void 0:D.weight)||"N/A",Total:s.total||0,GST:s.gst||0,"Selected Carat":s.selectedCaret||"N/A","Caret Options":((I=s.caretOptions)==null?void 0:I.join(", "))||"N/A","Created At":s.createdAt?new Date(s.createdAt).toLocaleDateString():"N/A","Updated At":s.updatedAt?new Date(s.updatedAt).toLocaleDateString():"N/A"}}),i=S.book_new(),d=S.json_to_sheet(e),y=[{wch:5},{wch:25},{wch:30},{wch:20},{wch:20},{wch:15},{wch:15},{wch:10},{wch:10},{wch:10},{wch:10},{wch:10},{wch:12},{wch:10},{wch:12},{wch:10},{wch:15},{wch:20},{wch:15},{wch:15}];d["!cols"]=y,S.book_append_sheet(i,d,"Products");const o=q(i,{bookType:"xlsx",type:"array"}),m=new Blob([o],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),f=window.URL.createObjectURL(m),N=document.createElement("a");N.href=f,N.download=`products_export_${new Date().toISOString().split("T")[0]}.xlsx`,document.body.appendChild(N),N.click(),document.body.removeChild(N),window.URL.revokeObjectURL(f),v.success("Product data exported successfully!")}catch(e){console.error("Export error:",e),v.error("Failed to export product data")}};return R?t("div",{className:"flex justify-center items-center h-64",children:t(Y,{})}):g?(console.error("Products Error:",g),a("div",{className:"text-center py-8",children:[a("p",{className:"text-red-500",children:["Error loading products: ",g.message]}),a("p",{className:"text-sm text-gray-500",children:["Status: ",g.status]}),a("p",{className:"text-sm text-gray-500",children:["Data: ",JSON.stringify(g.data)]}),a("div",{className:"mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-lg text-left",children:[t("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Full Error:"}),t("pre",{className:"text-xs text-gray-500 dark:text-gray-500 mt-2 overflow-auto",children:JSON.stringify(g,null,2)})]}),t(n,{onClick:()=>L(),className:"mt-4",children:"Retry"})]})):a("div",{className:"space-y-6",children:[a("div",{className:"flex justify-between items-center",children:[a("div",{children:[t("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Products"}),t("p",{className:"text-gray-600 dark:text-gray-400",children:"Manage your product catalog"})]}),a("div",{className:"flex space-x-3",children:[a(n,{onClick:Q,className:"btn btn-outline-success",disabled:!l||l.length===0,children:[t(c,{icon:"ph:download",className:"mr-2"}),"Export Excel"]}),a(n,{onClick:F,className:"btn btn-primary",children:[t(c,{icon:"ph:plus",className:"mr-2"}),"Add Product"]})]})]}),t("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:a("div",{className:"flex flex-col lg:flex-row gap-4",children:[t("div",{className:"flex-1",children:a("div",{className:"relative",children:[t(c,{icon:"ph:magnifying-glass",className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),t("input",{type:"text",placeholder:"Search products...",value:u,onChange:e=>E(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-700 dark:text-white"})]})}),t("div",{className:"lg:w-64",children:a("select",{value:C,onChange:e=>M(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-700 dark:text-white",children:[t("option",{value:"",children:"All Categories"}),$.map(e=>t("option",{value:e,children:e},e))]})})]})}),t("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:B.map(e=>{var i,d;return a("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm overflow-hidden hover:shadow-md transition-shadow",children:[a("div",{className:"relative h-48 bg-gray-100 dark:bg-slate-700",children:[e.images&&e.images.length>0?t("img",{src:e.images[0],alt:e.name,className:"w-full h-full object-cover"}):t("div",{className:"w-full h-full flex items-center justify-center",children:t(c,{icon:"ph:image",className:"text-4xl text-gray-400"})}),a("div",{className:"absolute top-2 left-2 flex flex-col gap-1",children:[e.trending&&t("span",{className:"bg-orange-500 text-white text-xs px-2 py-1 rounded-full",children:"Trending"}),e.popular&&t("span",{className:"bg-green-500 text-white text-xs px-2 py-1 rounded-full",children:"Popular"})]}),t("div",{className:"absolute top-2 right-2",children:t("span",{className:`text-xs px-2 py-1 rounded-full ${e.stock>0?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,children:e.stock>0?`Stock: ${e.stock}`:"Out of Stock"})})]}),a("div",{className:"p-4",children:[a("div",{className:"flex justify-between items-start mb-2",children:[t("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white line-clamp-2",children:e.name}),t("span",{className:`text-xs px-2 py-1 rounded-full ${e.active?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,children:e.active?"Active":"Inactive"})]}),t("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:e.brand}),t("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-3",children:e.categories}),a("div",{className:"flex items-center mb-3",children:[t("div",{className:"flex items-center",children:[...Array(5)].map((y,o)=>{var m;return t(c,{icon:"ph:star-fill",className:`w-4 h-4 ${o<Math.floor(((m=e.rating)==null?void 0:m.value)||0)?"text-yellow-400":"text-gray-300"}`},o)})}),a("span",{className:"text-sm text-gray-600 dark:text-gray-400 ml-2",children:["(",((i=e.rating)==null?void 0:i.count)||0,")"]})]}),a("div",{className:"flex justify-between items-center mb-4",children:[a("div",{children:[a("span",{className:"text-lg font-bold text-gray-900 dark:text-white",children:["\u20B9",((d=e.sellingprice)==null?void 0:d.toLocaleString())||0]}),e.total&&e.total!==e.sellingprice&&a("span",{className:"text-sm text-gray-500 dark:text-gray-400 line-through ml-2",children:["\u20B9",e.total.toLocaleString()]})]}),t("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.selectedCaret})]}),a("div",{className:"flex space-x-2",children:[a(n,{onClick:()=>J(e._id),className:"btn btn-sm btn-outline-primary flex-1",children:[t(c,{icon:"ph:eye",className:"mr-1"}),"View"]}),t(n,{onClick:()=>G(e),className:"btn btn-sm btn-outline-secondary",children:t(c,{icon:"ph:pencil"})}),t(n,{onClick:()=>U(e._id),disabled:T,className:"btn btn-sm btn-outline-danger",children:t(c,{icon:"ph:trash"})})]})]})]},e._id)})}),x>1&&a("div",{className:"bg-white dark:bg-slate-800 px-4 py-3 flex items-center justify-between border-t border-gray-200 dark:border-gray-700 sm:px-6",children:[a("div",{className:"flex-1 flex justify-between sm:hidden",children:[t(n,{onClick:()=>b(e=>Math.max(e-1,1)),disabled:h===1,className:"btn btn-sm btn-outline",children:"Previous"}),t(n,{onClick:()=>b(e=>Math.min(e+1,x)),disabled:h===x,className:"btn btn-sm btn-outline",children:"Next"})]}),a("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[t("div",{children:a("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Showing ",t("span",{className:"font-medium",children:k+1})," to"," ",t("span",{className:"font-medium",children:Math.min(k+w,p.length)})," ","of ",t("span",{className:"font-medium",children:p.length})," results"]})}),t("div",{children:a("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px",children:[t(n,{onClick:()=>b(e=>Math.max(e-1,1)),disabled:h===1,className:"btn btn-sm btn-outline rounded-l-md",children:"Previous"}),Array.from({length:x},(e,i)=>i+1).map(e=>t(n,{onClick:()=>b(e),className:`btn btn-sm ${h===e?"btn-primary":"btn-outline"}`,children:e},e)),t(n,{onClick:()=>b(e=>Math.min(e+1,x)),disabled:h===x,className:"btn btn-sm btn-outline rounded-r-md",children:"Next"})]})})]})]})]})};export{ee as default};
