import{r as v,j as e,c as a,B as n,I as g,F as U,Q as b,b as Q,L as G}from"./index.93603967.js";import{f as V,d as W,a as Y,g as H}from"./productApi.9df9a97b.js";import{u as O,w as K}from"./xlsx.0799a57e.js";const X=({category:i,onClose:y,isEdit:p=!1})=>{const[r,h]=v.exports.useState({name:"",description:"",image:null,isActive:!0,parentCategory:"",sortOrder:0}),[L,{isLoading:f}]=V(),[S,{isLoading:N}]=W();v.exports.useEffect(()=>{p&&i&&h({name:i.name||"",description:i.description||"",image:i.image||null,isActive:i.isActive!==void 0?i.isActive:!0,parentCategory:i.parentCategory||"",sortOrder:i.sortOrder||0})},[p,i]);const c=l=>{const{name:o,value:m,type:j,checked:d}=l.target;h(w=>({...w,[o]:j==="checkbox"?d:m}))},s=l=>{const o=l.target.files[0];h(m=>({...m,image:o}))};return e("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:a("div",{className:"p-6",children:[a("div",{className:"flex justify-between items-center mb-6",children:[e("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:p?"Edit Category":"Add New Category"}),e(n,{onClick:y,className:"btn btn-sm btn-outline",children:e(g,{icon:"ph:x"})})]}),a("form",{onSubmit:async l=>{var o;l.preventDefault();try{const m={...r,sortOrder:parseInt(r.sortOrder)};p?(await S({id:i._id,...m}).unwrap(),b.success("Category updated successfully")):(await L(m).unwrap(),b.success("Category created successfully")),y()}catch(m){b.error(((o=m.data)==null?void 0:o.message)||"Failed to save category")}},className:"space-y-6",children:[a("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Category Name *"}),e("input",{type:"text",name:"name",value:r.name,onChange:c,required:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-700 dark:text-white"})]}),a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Sort Order"}),e("input",{type:"number",name:"sortOrder",value:r.sortOrder,onChange:c,min:"0",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-700 dark:text-white"})]})]}),a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Description *"}),e("textarea",{name:"description",value:r.description,onChange:c,required:!0,rows:4,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-700 dark:text-white"})]}),a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Category Image"}),e("input",{type:"file",accept:"image/*",onChange:s,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-700 dark:text-white"}),r.image&&e("div",{className:"mt-4",children:e("img",{src:typeof r.image=="string"?r.image:URL.createObjectURL(r.image),alt:"Category preview",className:"w-32 h-32 object-cover rounded-lg"})})]}),a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Parent Category (Optional)"}),e("input",{type:"text",name:"parentCategory",value:r.parentCategory,onChange:c,placeholder:"Enter parent category name",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-700 dark:text-white"})]}),a("div",{className:"flex items-center",children:[e("input",{type:"checkbox",name:"isActive",checked:r.isActive,onChange:c,className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e("label",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Category is active"})]}),a("div",{className:"flex justify-end space-x-4 pt-6 border-t",children:[e(n,{type:"button",onClick:y,className:"btn btn-outline",children:"Cancel"}),e(n,{type:"submit",disabled:f||N,className:"btn btn-primary",children:f||N?a(U,{children:[e(g,{icon:"ph:spinner",className:"animate-spin mr-2"}),p?"Updating...":"Creating..."]}):a(U,{children:[e(g,{icon:"ph:check",className:"mr-2"}),p?"Update Category":"Create Category"]})})]})]})]})})})},ae=()=>{const i=Q(),[y,p]=v.exports.useState(""),[r,h]=v.exports.useState(1),[L,f]=v.exports.useState(!1),[S,N]=v.exports.useState(null),c=10,{data:s,isLoading:_,error:l,refetch:o}=Y(),[m,{isLoading:j}]=H();let d=[];s&&(Array.isArray(s)?d=s:s.details&&Array.isArray(s.details)?d=s.details:s.data&&Array.isArray(s.data)?d=s.data:s.categories&&Array.isArray(s.categories)&&(d=s.categories)),console.log("Categories Response:",s),console.log("Categories:",d);const w=Array.isArray(d)?d.filter(t=>{var x,C;return((x=t.name)==null?void 0:x.toLowerCase().includes(y.toLowerCase()))||((C=t.description)==null?void 0:C.toLowerCase().includes(y.toLowerCase()))}):[],k=Math.ceil(w.length/c),D=(r-1)*c,F=w.slice(D,D+c),R=async t=>{if(window.confirm("Are you sure you want to delete this category?"))try{await m(t).unwrap(),b.success("Category deleted successfully"),o()}catch{b.error("Failed to delete category")}},M=()=>{N(null),f(!0)},E=t=>{N(t),f(!0)},P=()=>{f(!1),N(null),o()},T=t=>{i(`/categories/${t}`)},B=()=>{try{const t=d.map((u,J)=>({"S.No":J+1,"Category ID":u._id,Name:u.name||"N/A",Description:u.description||"N/A","New Tag":u.newTag?"Yes":"No","Created At":u.createdAt?new Date(u.createdAt).toLocaleDateString():"N/A","Updated At":u.updatedAt?new Date(u.updatedAt).toLocaleDateString():"N/A","Image URL":u.image||"N/A"})),x=O.book_new(),C=O.json_to_sheet(t),$=[{wch:5},{wch:25},{wch:20},{wch:30},{wch:10},{wch:15},{wch:15},{wch:50}];C["!cols"]=$,O.book_append_sheet(x,C,"Categories");const q=K(x,{bookType:"xlsx",type:"array"}),z=new Blob([q],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),I=window.URL.createObjectURL(z),A=document.createElement("a");A.href=I,A.download=`categories_export_${new Date().toISOString().split("T")[0]}.xlsx`,document.body.appendChild(A),A.click(),document.body.removeChild(A),window.URL.revokeObjectURL(I),b.success("Category data exported successfully!")}catch(t){console.error("Export error:",t),b.error("Failed to export category data")}};return _?e("div",{className:"flex justify-center items-center h-64",children:e(G,{})}):l?(console.error("Categories Error:",l),a("div",{className:"text-center py-8",children:[a("p",{className:"text-red-500",children:["Error loading categories: ",l.message]}),a("p",{className:"text-sm text-gray-500",children:["Status: ",l.status]}),a("p",{className:"text-sm text-gray-500",children:["Data: ",JSON.stringify(l.data)]}),a("div",{className:"mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-lg text-left",children:[e("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Full Error:"}),e("pre",{className:"text-xs text-gray-500 dark:text-gray-500 mt-2 overflow-auto",children:JSON.stringify(l,null,2)})]}),e(n,{onClick:()=>o(),className:"mt-4",children:"Retry"})]})):a("div",{className:"space-y-6",children:[a("div",{className:"flex justify-between items-center",children:[a("div",{children:[e("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Categories"}),e("p",{className:"text-gray-600 dark:text-gray-400",children:"Manage your product categories"})]}),a("div",{className:"flex space-x-3",children:[a(n,{onClick:B,className:"btn btn-outline-success",disabled:!d||d.length===0,children:[e(g,{icon:"ph:download",className:"mr-2"}),"Export Excel"]}),a(n,{onClick:M,className:"btn btn-primary",children:[e(g,{icon:"ph:plus",className:"mr-2"}),"Add Category"]})]})]}),e("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:e("div",{className:"flex flex-col sm:flex-row gap-4",children:e("div",{className:"flex-1",children:a("div",{className:"relative",children:[e(g,{icon:"ph:magnifying-glass",className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e("input",{type:"text",placeholder:"Search categories...",value:y,onChange:t=>p(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-700 dark:text-white"})]})})})}),a("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm overflow-hidden",children:[e("div",{className:"overflow-x-auto",children:a("table",{className:"w-full",children:[e("thead",{className:"bg-gray-50 dark:bg-slate-700",children:a("tr",{children:[e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Category"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Description"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Created"}),e("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e("tbody",{className:"bg-white dark:bg-slate-800 divide-y divide-gray-200 dark:divide-gray-700",children:F.map(t=>a("tr",{className:"hover:bg-gray-50 dark:hover:bg-slate-700",children:[e("td",{className:"px-6 py-4 whitespace-nowrap",children:a("div",{className:"flex items-center",children:[e("div",{className:"flex-shrink-0 h-12 w-12",children:t.image?e("img",{src:t.image,alt:t.name,className:"h-12 w-12 rounded-lg object-cover"}):e("div",{className:"h-12 w-12 rounded-lg bg-gray-200 dark:bg-gray-600 flex items-center justify-center",children:e(g,{icon:"ph:image",className:"text-gray-400"})})}),a("div",{className:"ml-4",children:[e("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.name||"N/A"}),a("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["ID: ",t._id]})]})]})}),e("td",{className:"px-6 py-4",children:e("div",{className:"text-sm text-gray-900 dark:text-white max-w-xs truncate",children:t.description||"No description"})}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:e("div",{className:"flex flex-col space-y-1",children:e("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t.newTag?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"}`,children:t.newTag?"New":"Regular"})})}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:t.createdAt?new Date(t.createdAt).toLocaleDateString():"N/A"}),e("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:a("div",{className:"flex justify-end space-x-2",children:[e(n,{onClick:()=>T(t._id),className:"btn btn-sm btn-outline-primary",children:e(g,{icon:"ph:eye"})}),e(n,{onClick:()=>E(t),className:"btn btn-sm btn-outline-secondary",children:e(g,{icon:"ph:pencil"})}),e(n,{onClick:()=>R(t._id),disabled:j,className:"btn btn-sm btn-outline-danger",children:e(g,{icon:"ph:trash"})})]})})]},t._id))})]})}),k>1&&a("div",{className:"bg-white dark:bg-slate-800 px-4 py-3 flex items-center justify-between border-t border-gray-200 dark:border-gray-700 sm:px-6",children:[a("div",{className:"flex-1 flex justify-between sm:hidden",children:[e(n,{onClick:()=>h(t=>Math.max(t-1,1)),disabled:r===1,className:"btn btn-sm btn-outline",children:"Previous"}),e(n,{onClick:()=>h(t=>Math.min(t+1,k)),disabled:r===k,className:"btn btn-sm btn-outline",children:"Next"})]}),a("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e("div",{children:a("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Showing ",e("span",{className:"font-medium",children:D+1})," to"," ",e("span",{className:"font-medium",children:Math.min(D+c,w.length)})," ","of ",e("span",{className:"font-medium",children:w.length})," results"]})}),e("div",{children:a("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px",children:[e(n,{onClick:()=>h(t=>Math.max(t-1,1)),disabled:r===1,className:"btn btn-sm btn-outline rounded-l-md",children:"Previous"}),Array.from({length:k},(t,x)=>x+1).map(t=>e(n,{onClick:()=>h(t),className:`btn btn-sm ${r===t?"btn-primary":"btn-outline"}`,children:t},t)),e(n,{onClick:()=>h(t=>Math.min(t+1,k)),disabled:r===k,className:"btn btn-sm btn-outline rounded-r-md",children:"Next"})]})})]})]})]}),L&&e(X,{category:S,onClose:P,isEdit:!!S})]})};export{ae as default};
