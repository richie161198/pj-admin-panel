import{b as de,r as k,j as e,L as ie,c as r,B as o,I as h,Q}from"./index.ce738da1.js";import{u as ce,a as oe}from"./authApiSlice.503d73ff.js";import{u as A,w as he}from"./xlsx.0799a57e.js";const Ne=()=>{const C=de(),[b,K]=k.exports.useState(""),[x,m]=k.exports.useState(1),[c,W]=k.exports.useState(null),[p,S]=k.exports.useState("desc"),u=10;ce();const{data:v,isLoading:q,error:D,refetch:H}=oe(),g=(v==null?void 0:v.details)||[],w=[...(g==null?void 0:g.filter(t=>{var l,d,i;return((l=t.name)==null?void 0:l.toLowerCase().includes(b.toLowerCase()))||((d=t.email)==null?void 0:d.toLowerCase().includes(b.toLowerCase()))||((i=t.phone)==null?void 0:i.toLowerCase().includes(b.toLowerCase()))}))||[]].sort((t,l)=>{if(!c)return 0;const d=t[c]||0,i=l[c]||0;return p==="asc"?d-i:i-d}),P=t=>{c===t?S(p==="asc"?"desc":"asc"):(W(t),S("desc")),m(1)},N=Math.ceil(w.length/u),y=(x-1)*u,J=w.slice(y,y+u),X=t=>{C(`/customers/${t}`)},Z=()=>{try{const t=g.map((a,te)=>{var _,j,T,$,I,B,E,M,R,Y,F,U,z;const ae=((_=a.panDetails)==null?void 0:_.pan)||"N/A",re=((j=a.panDetails)==null?void 0:j.type)||"N/A",se=((T=a.panDetails)==null?void 0:T.registered_name)||"N/A",le=($=a.panDetails)!=null&&$.valid?"Yes":"No";let V="N/A";a.bankDetails&&a.bankDetails.length>0&&(V=a.bankDetails.map((n,ne)=>{var G;return`Bank ${ne+1}: ${n.bank_name||"N/A"} | Account: ${n.account_number||"N/A"} | IFSC: ${((G=n.ifsc_details)==null?void 0:G.ifsc)||"N/A"} | Branch: ${n.branch||"N/A"}`}).join("; "));const s=a.bankDetails&&a.bankDetails.length>0?a.bankDetails[0]:null;return{"S.No":te+1,"Customer ID":a.appId,Name:a.name||"N/A",Email:a.email||"N/A",Phone:a.phone||"N/A",Status:a.active?"Active":"Inactive",Blocked:a.isBlocked?"Yes":"No","Mobile Verified":a.mobileVerified?"Yes":"No","Active Account":a.activeAccount?"Yes":"No","PAN Verified":a.panVerified?"Yes":"No","KYC Verified":a.kycVerified?"Yes":"No","PAN Number":ae,"PAN Type":re,"PAN Registered Name":se,"PAN Valid":le,"Primary Bank Name":(s==null?void 0:s.bank_name)||"N/A","Primary Account Number":(s==null?void 0:s.account_number)||"N/A","Primary IFSC":((I=s==null?void 0:s.ifsc_details)==null?void 0:I.ifsc)||"N/A","Primary Branch":(s==null?void 0:s.branch)||"N/A","Primary Account Status":(s==null?void 0:s.account_status)||"N/A","All Bank Details":V,"Total Orders":a.totalOrders||0,"Total Order Value":a.totalOrderValue||0,"Customer Tier":a.customerTier||"Bronze",Balance:a.balance||"0","Gold Balance":a.goldBalance||"0","Referral Code":a.referralCode||"N/A",Role:a.role||"N/A","Last Login":a.lastLogin?new Date(a.lastLogin).toLocaleDateString():"Never",Address:a.address&&a.address.length>0&&(((B=a.address.find(n=>n.isDefault))==null?void 0:B.street)||((E=a.address[0])==null?void 0:E.street))||"N/A",City:a.address&&a.address.length>0&&(((M=a.address.find(n=>n.isDefault))==null?void 0:M.city)||((R=a.address[0])==null?void 0:R.city))||"N/A",State:a.address&&a.address.length>0&&(((Y=a.address.find(n=>n.isDefault))==null?void 0:Y.state)||((F=a.address[0])==null?void 0:F.state))||"N/A",Pincode:a.address&&a.address.length>0&&(((U=a.address.find(n=>n.isDefault))==null?void 0:U.pincode)||((z=a.address[0])==null?void 0:z.pincode))||"N/A"}}),l=A.book_new(),d=A.json_to_sheet(t),i=[{wch:5},{wch:25},{wch:20},{wch:30},{wch:15},{wch:10},{wch:10},{wch:15},{wch:15},{wch:12},{wch:12},{wch:15},{wch:12},{wch:25},{wch:10},{wch:20},{wch:20},{wch:15},{wch:20},{wch:18},{wch:50},{wch:12},{wch:15},{wch:20},{wch:15},{wch:10},{wch:15},{wch:30},{wch:15},{wch:10},{wch:10}];d["!cols"]=i,A.book_append_sheet(l,d,"Customers");const L=he(l,{bookType:"xlsx",type:"array"}),ee=new Blob([L],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),O=window.URL.createObjectURL(ee),f=document.createElement("a");f.href=O,f.download=`customers_export_${new Date().toISOString().split("T")[0]}.xlsx`,document.body.appendChild(f),f.click(),document.body.removeChild(f),window.URL.revokeObjectURL(O),Q.success("Customer data exported successfully!")}catch(t){console.error("Export error:",t),Q.error("Failed to export customer data")}};return q?e("div",{className:"flex justify-center items-center h-64",children:e(ie,{})}):D?r("div",{className:"text-center py-8",children:[r("p",{className:"text-red-500",children:["Error loading customers: ",D.message]}),e(o,{onClick:()=>H(),className:"mt-4",children:"Retry"})]}):r("div",{className:"space-y-6",children:[r("div",{className:"flex justify-between items-center",children:[r("div",{children:[e("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Customers"}),e("p",{className:"text-gray-600 dark:text-gray-400",children:"Manage your customers"})]}),r("div",{className:"flex space-x-3",children:[r(o,{onClick:Z,className:"btn btn-outline-success",disabled:!g||g.length===0,children:[e(h,{icon:"ph:download",className:"mr-2"}),"Export Excel"]}),r(o,{onClick:()=>C("/customers/new"),className:"btn btn-primary",children:[e(h,{icon:"ph:plus",className:"mr-2"}),"Add Customer"]})]})]}),e("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:e("div",{className:"flex flex-col sm:flex-row gap-4",children:e("div",{className:"flex-1",children:r("div",{className:"relative",children:[e(h,{icon:"ph:magnifying-glass",className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e("input",{type:"text",placeholder:"Search customers...",value:b,onChange:t=>K(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-700 dark:text-white"})]})})})}),r("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm overflow-hidden",children:[e("div",{className:"overflow-x-auto",children:r("table",{className:"w-full",children:[e("thead",{className:"bg-gray-50 dark:bg-slate-700",children:r("tr",{children:[e("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Customer"}),e("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Email"}),e("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Phone"}),e("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-slate-600 select-none",onClick:()=>P("totalOrders"),children:r("div",{className:"flex items-center justify-center gap-1",children:["Orders",r("span",{className:"flex flex-col",children:[e(h,{icon:"ph:caret-up-fill",className:`w-3 h-3 -mb-1 ${c==="totalOrders"&&p==="asc"?"text-blue-500":"text-gray-400"}`}),e(h,{icon:"ph:caret-down-fill",className:`w-3 h-3 ${c==="totalOrders"&&p==="desc"?"text-blue-500":"text-gray-400"}`})]})]})}),e("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-slate-600 select-none",onClick:()=>P("totalOrderValue"),children:r("div",{className:"flex items-center center justify-center gap-1",children:["Total Value",r("span",{className:"flex flex-col",children:[e(h,{icon:"ph:caret-up-fill",className:`w-3 h-3 -mb-1 ${c==="totalOrderValue"&&p==="asc"?"text-blue-500":"text-gray-400"}`}),e(h,{icon:"ph:caret-down-fill",className:`w-3 h-3 ${c==="totalOrderValue"&&p==="desc"?"text-blue-500":"text-gray-400"}`})]})]})}),e("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Tier"}),e("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"})]})}),e("tbody",{className:"bg-white dark:bg-slate-800 divide-y divide-gray-200 dark:divide-gray-700",children:J.map(t=>{var l,d;return r("tr",{onClick:()=>X(t._id),className:"hover:bg-gray-50 dark:hover:bg-slate-700",children:[e("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:r("div",{className:"flex items-center",children:[e("div",{className:"flex-shrink-0 h-10 w-10",children:t.profilePhoto?e("img",{src:t.profilePhoto,alt:t.name,className:"h-10 w-10 rounded-full object-cover"}):e("div",{className:"h-10 w-10 rounded-full bg-blue-500 flex items-center justify-center text-white font-medium",children:((d=(l=t.name)==null?void 0:l.charAt(0))==null?void 0:d.toUpperCase())||"C"})}),r("div",{className:"ml-4",children:[e("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.name||"N/A"}),e("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.appId})]})]})}),e("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e("div",{className:"text-sm text-gray-900 dark:text-white",children:t.email||"N/A"})}),e("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e("div",{className:"text-sm text-gray-900 dark:text-white",children:t.phone||"N/A"})}),e("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.totalOrders||0})}),e("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:r("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:["\u20B9",(t.totalOrderValue||0).toLocaleString("en-IN")]})}),e("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:(()=>{const i=t.customerTier||"Bronze";return e("span",{className:`inline-flex items-center px-2.5 py-1 text-xs font-semibold rounded-full ${{Bronze:"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-300",Silver:"bg-gray-200 text-gray-800 dark:bg-gray-600 dark:text-gray-100",Gold:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300",Elite:"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300"}[i]}`,children:i})})()}),e("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:r("div",{className:"flex flex-col space-y-1",children:[e("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t.active?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,children:t.active?"Active":"Inactive"}),t.isBlocked&&e("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",children:"Blocked"})]})})]},t._id)})})]})}),N>1&&r("div",{className:"bg-white dark:bg-slate-800 px-4 py-3 flex items-center justify-between border-t border-gray-200 dark:border-gray-700 sm:px-6",children:[r("div",{className:"flex-1 flex justify-between sm:hidden",children:[e(o,{onClick:()=>m(t=>Math.max(t-1,1)),disabled:x===1,className:"btn btn-sm btn-outline",children:"Previous"}),e(o,{onClick:()=>m(t=>Math.min(t+1,N)),disabled:x===N,className:"btn btn-sm btn-outline",children:"Next"})]}),r("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e("div",{children:r("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Showing ",e("span",{className:"font-medium",children:y+1})," to"," ",e("span",{className:"font-medium",children:Math.min(y+u,w.length)})," ","of ",e("span",{className:"font-medium",children:w.length})," results"]})}),e("div",{children:r("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px",children:[e(o,{onClick:()=>m(t=>Math.max(t-1,1)),disabled:x===1,className:"btn btn-sm btn-outline rounded-l-md",children:"Previous"}),Array.from({length:N},(t,l)=>l+1).map(t=>e(o,{onClick:()=>m(t),className:`btn btn-sm ${x===t?"btn-primary":"btn-outline"}`,children:t},t)),e(o,{onClick:()=>m(t=>Math.min(t+1,N)),disabled:x===N,className:"btn btn-sm btn-outline rounded-r-md",children:"Next"})]})})]})]})]})]})};export{Ne as default};
