import{b as le,r as o,j as e,L as de,c as a,B as i,I as m,Q as f}from"./index.93603967.js";import{a as ne}from"./orderApi.c470ea6a.js";import{B as V}from"./Badge.2391c60f.js";import{u as A,w as ce}from"./xlsx.0799a57e.js";const ue=()=>{var L,_,j,B,E,I,T,F;const Q=le(),[w,q]=o.exports.useState(""),[z,g]=o.exports.useState(1),[v,G]=o.exports.useState(""),[k,W]=o.exports.useState(""),[S,H]=o.exports.useState(""),[P,J]=o.exports.useState(""),K={page:z,limit:10,...v&&{status:v},...k&&{paymentStatus:k},...w&&{search:w},...S&&{startDate:S},...P&&{endDate:P}},{data:l,isLoading:X,error:C,refetch:D}=ne(K),h=((L=l==null?void 0:l.data)==null?void 0:L.orders)||[],r=((_=l==null?void 0:l.data)==null?void 0:_.pagination)||{},u=((j=l==null?void 0:l.data)==null?void 0:j.summary)||{},O=((B=l==null?void 0:l.data)==null?void 0:B.breakdown)||{};console.log("Orders Response:",l),console.log("Orders:",h),console.log("Pagination:",r),console.log("Summary:",u);const Y=async(t,n)=>{try{f.success("Order status updated successfully"),D()}catch{f.error("Failed to update order status")}},Z=t=>{Q(`/orders/${t}`)},ee=t=>{const d={pending:{color:"bg-yellow-100 text-yellow-800",label:"Pending"},processing:{color:"bg-blue-100 text-blue-800",label:"Processing"},shipped:{color:"bg-purple-100 text-purple-800",label:"Shipped"},delivered:{color:"bg-green-100 text-green-800",label:"Delivered"},cancelled:{color:"bg-red-100 text-red-800",label:"Cancelled"},refunded:{color:"bg-gray-100 text-gray-800",label:"Refunded"}}[t]||{color:"bg-gray-100 text-gray-800",label:t};return e(V,{className:`${d.color} border-0`,children:d.label})},te=t=>{const d={pending:{color:"bg-yellow-100 text-yellow-800",label:"Pending"},paid:{color:"bg-green-100 text-green-800",label:"Paid"},failed:{color:"bg-red-100 text-red-800",label:"Failed"},refunded:{color:"bg-gray-100 text-gray-800",label:"Refunded"}}[t]||{color:"bg-gray-100 text-gray-800",label:t};return e(V,{className:`${d.color} border-0`,children:d.label})},ae=((E=O.status)==null?void 0:E.map(t=>t._id))||[],re=((I=O.paymentStatus)==null?void 0:I.map(t=>t._id))||[],se=()=>{try{const t=h.map((s,N)=>{var M,U,$,R;return{"S.No":N+1,"Order ID":s.orderCode||"N/A","Customer Name":((M=s.user)==null?void 0:M.name)||"N/A","Customer Email":((U=s.user)==null?void 0:U.email)||"N/A","Customer Phone":(($=s.user)==null?void 0:$.phone)||"N/A",Status:s.status||"N/A","Payment Status":s.paymentStatus||"N/A","Total Amount":s.totalAmount||0,"Items Count":((R=s.items)==null?void 0:R.length)||0,"Created At":s.createdAt?new Date(s.createdAt).toLocaleDateString():"N/A","Updated At":s.updatedAt?new Date(s.updatedAt).toLocaleDateString():"N/A"}}),n=A.book_new(),d=A.json_to_sheet(t),x=[{wch:5},{wch:20},{wch:25},{wch:15},{wch:15},{wch:12},{wch:12},{wch:10},{wch:12},{wch:15},{wch:10},{wch:12},{wch:15},{wch:15}];d["!cols"]=x,A.book_append_sheet(n,d,"Orders");const b=ce(n,{bookType:"xlsx",type:"array"}),y=new Blob([b],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),p=window.URL.createObjectURL(y),c=document.createElement("a");c.href=p,c.download=`orders_export_${new Date().toISOString().split("T")[0]}.xlsx`,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(p),f.success("Order data exported successfully!")}catch(t){console.error("Export error:",t),f.error("Failed to export order data")}};return X?e("div",{className:"flex justify-center items-center h-64",children:e(de,{})}):C?a("div",{className:"text-center py-8",children:[a("p",{className:"text-red-500",children:["Error loading orders: ",C.message]}),e(i,{onClick:()=>D(),className:"mt-4",children:"Retry"})]}):a("div",{className:"space-y-6",children:[a("div",{className:"flex justify-between items-center",children:[a("div",{children:[e("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Product Orders"}),e("p",{className:"text-gray-600 dark:text-gray-400",children:"Manage customer product orders"})]}),e("div",{className:"flex space-x-3",children:a(i,{onClick:se,className:"btn btn-outline-success",disabled:!h||h.length===0,children:[e(m,{icon:"ph:download",className:"mr-2"}),"Export Excel"]})})]}),u&&a("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:a("div",{className:"flex items-center",children:[e("div",{className:"p-2 bg-blue-100 rounded-lg",children:e(m,{icon:"ph:shopping-cart",className:"text-blue-600 text-xl"})}),a("div",{className:"ml-4",children:[e("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Orders"}),e("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:u.totalOrders||0})]})]})}),e("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:a("div",{className:"flex items-center",children:[e("div",{className:"p-2 bg-green-100 rounded-lg",children:e(m,{icon:"ph:currency-dollar",className:"text-green-600 text-xl"})}),a("div",{className:"ml-4",children:[e("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Revenue"}),a("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["\u20B9",((T=u.totalAmount)==null?void 0:T.toLocaleString())||0]})]})]})}),e("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:a("div",{className:"flex items-center",children:[e("div",{className:"p-2 bg-purple-100 rounded-lg",children:e(m,{icon:"ph:chart-line",className:"text-purple-600 text-xl"})}),a("div",{className:"ml-4",children:[e("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Average Order Value"}),a("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["\u20B9",((F=u.averageOrderValue)==null?void 0:F.toLocaleString())||0]})]})]})})]}),a("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:[a("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e("div",{className:"lg:col-span-2",children:a("div",{className:"relative",children:[e(m,{icon:"ph:magnifying-glass",className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e("input",{type:"text",placeholder:"Search orders, customers, or products...",value:w,onChange:t=>q(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-700 dark:text-white"})]})}),e("div",{children:a("select",{value:v,onChange:t=>G(t.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-700 dark:text-white",children:[e("option",{value:"",children:"All Statuses"}),ae.map(t=>e("option",{value:t,children:t},t))]})}),e("div",{children:a("select",{value:k,onChange:t=>W(t.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-700 dark:text-white",children:[e("option",{value:"",children:"All Payment Status"}),re.map(t=>e("option",{value:t,children:t},t))]})})]}),a("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Start Date"}),e("input",{type:"date",value:S,onChange:t=>H(t.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-700 dark:text-white"})]}),a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"End Date"}),e("input",{type:"date",value:P,onChange:t=>J(t.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-700 dark:text-white"})]})]})]}),a("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm overflow-hidden",children:[e("div",{className:"overflow-x-auto",children:a("table",{className:"w-full",children:[e("thead",{className:"bg-gray-50 dark:bg-slate-700",children:a("tr",{children:[e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Order ID"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Customer"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Products"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Payment"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Total"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Date"}),e("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e("tbody",{className:"bg-white dark:bg-slate-800 divide-y divide-gray-200 dark:divide-gray-700",children:h.map(t=>{var n,d,x,b,y,p;return a("tr",{className:"hover:bg-gray-50 dark:hover:bg-slate-700",children:[a("td",{className:"px-6 py-4 whitespace-nowrap",children:[e("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.orderCode||"N/A"}),a("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[((n=t.items)==null?void 0:n.length)||0," items"]})]}),a("td",{className:"px-6 py-4 whitespace-nowrap",children:[e("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:((d=t.user)==null?void 0:d.name)||"N/A"}),e("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:((x=t.user)==null?void 0:x.email)||"N/A"})]}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:a("div",{className:"text-sm text-gray-900 dark:text-white",children:[(b=t.items)==null?void 0:b.slice(0,2).map((c,s)=>{var N;return e("div",{className:"truncate max-w-32",children:((N=c.productDataid)==null?void 0:N.name)||"Product"},s)}),((y=t.items)==null?void 0:y.length)>2&&a("div",{className:"text-xs text-gray-500",children:["+",t.items.length-2," more"]})]})}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:ee(t.status)}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:te(t.paymentStatus)}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:a("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:["\u20B9",((p=t.totalAmount)==null?void 0:p.toLocaleString())||0]})}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:t.createdAt?new Date(t.createdAt).toLocaleDateString():"N/A"}),e("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:a("div",{className:"flex justify-end space-x-2",children:[e(i,{onClick:()=>Z(t._id),className:"btn btn-sm btn-outline-primary",children:e(m,{icon:"ph:eye"})}),a("select",{value:t.status,onChange:c=>Y(t._id,c.target.value),className:"text-xs px-2 py-1 border border-gray-300 dark:border-gray-600 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-700 dark:text-white",children:[e("option",{value:"pending",children:"Pending"}),e("option",{value:"processing",children:"Processing"}),e("option",{value:"shipped",children:"Shipped"}),e("option",{value:"delivered",children:"Delivered"}),e("option",{value:"cancelled",children:"Cancelled"}),e("option",{value:"refunded",children:"Refunded"})]})]})})]},t._id)})})]})}),r.totalPages>1&&a("div",{className:"bg-white dark:bg-slate-800 px-4 py-3 flex items-center justify-between border-t border-gray-200 dark:border-gray-700 sm:px-6",children:[a("div",{className:"flex-1 flex justify-between sm:hidden",children:[e(i,{onClick:()=>g(t=>Math.max(t-1,1)),disabled:!r.hasPrevPage,className:"btn btn-sm btn-outline",children:"Previous"}),e(i,{onClick:()=>g(t=>Math.min(t+1,r.totalPages)),disabled:!r.hasNextPage,className:"btn btn-sm btn-outline",children:"Next"})]}),a("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e("div",{children:a("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Showing ",e("span",{className:"font-medium",children:(r.currentPage-1)*r.limit+1})," to"," ",e("span",{className:"font-medium",children:Math.min(r.currentPage*r.limit,r.totalOrders)})," ","of ",e("span",{className:"font-medium",children:r.totalOrders})," results"]})}),e("div",{children:a("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px",children:[e(i,{onClick:()=>g(t=>Math.max(t-1,1)),disabled:!r.hasPrevPage,className:"btn btn-sm btn-outline rounded-l-md",children:"Previous"}),Array.from({length:r.totalPages},(t,n)=>n+1).map(t=>e(i,{onClick:()=>g(t),className:`btn btn-sm ${r.currentPage===t?"btn-primary":"btn-outline"}`,children:t},t)),e(i,{onClick:()=>g(t=>Math.min(t+1,r.totalPages)),disabled:!r.hasNextPage,className:"btn btn-sm btn-outline rounded-r-md",children:"Next"})]})})]})]})]})]})};export{ue as default};
