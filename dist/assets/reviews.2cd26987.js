import{d as X,r as g,j as e,L as Z,c as a,I as l,B as i,F as ee,Q as u}from"./index.ce738da1.js";import{B as f}from"./Badge.eb576f68.js";import{M as U}from"./Modal.cf6e484c.js";import{T as te}from"./Textarea.8439f372.js";import"./hidden.5093b39d.js";const ae=X.injectEndpoints({endpoints:n=>({getAllReviews:n.query({query:({page:d=1,limit:m=20,status:y,productId:h,rating:b}={})=>{const r=new URLSearchParams;return r.append("page",d),r.append("limit",m),y&&r.append("status",y),h&&r.append("productId",h),b&&r.append("rating",b),`/reviews/admin/all?${r.toString()}`},providesTags:["Review"]}),approveReview:n.mutation({query:d=>({url:`/reviews/admin/${d}/approve`,method:"PUT"}),invalidatesTags:["Review"]}),rejectReview:n.mutation({query:({reviewId:d,reason:m})=>({url:`/reviews/admin/${d}/reject`,method:"PUT",body:{reason:m}}),invalidatesTags:["Review"]}),deleteReview:n.mutation({query:d=>({url:`/reviews/admin/${d}`,method:"DELETE"}),invalidatesTags:["Review"]})})}),{useGetAllReviewsQuery:re,useApproveReviewMutation:se,useRejectReviewMutation:le,useDeleteReviewMutation:de}=ae,ge=()=>{const[n,d]=g.exports.useState(1),[m,y]=g.exports.useState(""),[h,b]=g.exports.useState(""),[r,o]=g.exports.useState(null),[_,N]=g.exports.useState(!1),[$,v]=g.exports.useState(!1),[A,P]=g.exports.useState(""),R=20,Q={page:n,limit:R,...m&&{status:m},...h&&{rating:h}},{data:c,isLoading:G,error:Y,refetch:j}=re(Q),[z,{isLoading:D}]=se(),[H,{isLoading:w}]=le(),[J,{isLoading:S}]=de(),M=(c==null?void 0:c.reviews)||[],p=(c==null?void 0:c.pagination)||{},k=(c==null?void 0:c.counts)||{},I=async t=>{var s;try{await z(t).unwrap(),u.success("Review approved successfully"),j()}catch(x){u.error(((s=x==null?void 0:x.data)==null?void 0:s.message)||"Failed to approve review")}},T=t=>{o(t),P(""),N(!0)},K=async()=>{var t;try{await H({reviewId:r._id,reason:A}).unwrap(),u.success("Review rejected"),N(!1),o(null),j()}catch(s){u.error(((t=s==null?void 0:s.data)==null?void 0:t.message)||"Failed to reject review")}},O=t=>{o(t),v(!0)},V=async()=>{var t;try{await J(r._id).unwrap(),u.success("Review deleted successfully"),v(!1),o(null),j()}catch(s){u.error(((t=s==null?void 0:s.data)==null?void 0:t.message)||"Failed to delete review")}},W=t=>{switch(t){case"pending":return e(f,{className:"bg-yellow-500/20 text-yellow-600 dark:text-yellow-400",children:"Pending"});case"approved":return e(f,{className:"bg-green-500/20 text-green-600 dark:text-green-400",children:"Approved"});case"rejected":return e(f,{className:"bg-red-500/20 text-red-600 dark:text-red-400",children:"Rejected"});default:return e(f,{className:"bg-gray-500/20 text-gray-600",children:t})}},C=t=>a("div",{className:"flex items-center",children:[[1,2,3,4,5].map(s=>e(l,{icon:s<=t?"ph:star-fill":"ph:star",className:`w-4 h-4 ${s<=t?"text-yellow-500":"text-gray-300"}`},s)),a("span",{className:"ml-1 text-sm text-gray-600 dark:text-gray-400",children:["(",t,")"]})]});return G?e("div",{className:"flex justify-center items-center h-64",children:e(Z,{})}):Y?e("div",{className:"text-center text-red-500 py-10",children:"Error loading reviews. Please try again."}):a("div",{className:"space-y-6",children:[e("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:a("div",{children:[e("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Reviews Management"}),e("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Approve or reject customer reviews"})]})}),a("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4",children:[e("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-4 shadow-sm border border-gray-200 dark:border-gray-700",children:a("div",{className:"flex items-center justify-between",children:[a("div",{children:[e("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total Reviews"}),e("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:k.total||0})]}),e("div",{className:"bg-blue-100 dark:bg-blue-900/30 p-3 rounded-full",children:e(l,{icon:"ph:chat-circle-text",className:"w-6 h-6 text-blue-600 dark:text-blue-400"})})]})}),e("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-4 shadow-sm border border-gray-200 dark:border-gray-700",children:a("div",{className:"flex items-center justify-between",children:[a("div",{children:[e("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Pending"}),e("p",{className:"text-2xl font-bold text-yellow-600",children:k.pending||0})]}),e("div",{className:"bg-yellow-100 dark:bg-yellow-900/30 p-3 rounded-full",children:e(l,{icon:"ph:clock",className:"w-6 h-6 text-yellow-600 dark:text-yellow-400"})})]})}),e("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-4 shadow-sm border border-gray-200 dark:border-gray-700",children:a("div",{className:"flex items-center justify-between",children:[a("div",{children:[e("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Approved"}),e("p",{className:"text-2xl font-bold text-green-600",children:k.approved||0})]}),e("div",{className:"bg-green-100 dark:bg-green-900/30 p-3 rounded-full",children:e(l,{icon:"ph:check-circle",className:"w-6 h-6 text-green-600 dark:text-green-400"})})]})}),e("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-4 shadow-sm border border-gray-200 dark:border-gray-700",children:a("div",{className:"flex items-center justify-between",children:[a("div",{children:[e("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Rejected"}),e("p",{className:"text-2xl font-bold text-red-600",children:k.rejected||0})]}),e("div",{className:"bg-red-100 dark:bg-red-900/30 p-3 rounded-full",children:e(l,{icon:"ph:x-circle",className:"w-6 h-6 text-red-600 dark:text-red-400"})})]})})]}),a("div",{className:"flex flex-wrap gap-4",children:[a("select",{value:m,onChange:t=>{y(t.target.value),d(1)},className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800 dark:text-white",children:[e("option",{value:"",children:"All Status"}),e("option",{value:"pending",children:"Pending"}),e("option",{value:"approved",children:"Approved"}),e("option",{value:"rejected",children:"Rejected"})]}),a("select",{value:h,onChange:t=>{b(t.target.value),d(1)},className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800 dark:text-white",children:[e("option",{value:"",children:"All Ratings"}),e("option",{value:"5",children:"5 Stars"}),e("option",{value:"4",children:"4 Stars"}),e("option",{value:"3",children:"3 Stars"}),e("option",{value:"2",children:"2 Stars"}),e("option",{value:"1",children:"1 Star"})]}),a(i,{onClick:()=>{y(""),b(""),d(1)},className:"btn btn-outline",children:[e(l,{icon:"ph:x",className:"mr-2"}),"Clear Filters"]})]}),a("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e("div",{className:"overflow-x-auto",children:a("table",{className:"w-full",children:[e("thead",{className:"bg-gray-50 dark:bg-slate-700",children:a("tr",{children:[e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Product"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Customer"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Rating"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider min-w-[300px]",children:"Review"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Date"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:M.length===0?e("tr",{children:a("td",{colSpan:"7",className:"px-6 py-12 text-center text-gray-500 dark:text-gray-400",children:[e(l,{icon:"ph:chat-circle-text",className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e("p",{children:"No reviews found"})]})}):M.map(t=>{var s,x,F,L,E,q,B;return a("tr",{className:"hover:bg-gray-50 dark:hover:bg-slate-700/50",children:[e("td",{className:"px-6 py-4",children:a("div",{className:"flex items-center space-x-3",children:[(x=(s=t.productId)==null?void 0:s.images)!=null&&x[0]?e("img",{src:t.productId.images[0],alt:(F=t.productId)==null?void 0:F.name,className:"w-12 h-12 object-cover rounded-lg"}):e("div",{className:"w-12 h-12 bg-gray-200 dark:bg-gray-700 rounded-lg flex items-center justify-center",children:e(l,{icon:"ph:image",className:"w-6 h-6 text-gray-400"})}),a("div",{children:[e("p",{className:"font-medium text-gray-900 dark:text-white text-sm truncate max-w-[150px]",children:((L=t.productId)==null?void 0:L.name)||"Unknown Product"}),e("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:((E=t.productId)==null?void 0:E.skuId)||"N/A"})]})]})}),e("td",{className:"px-6 py-4",children:a("div",{children:[e("p",{className:"font-medium text-gray-900 dark:text-white text-sm",children:t.userName||((q=t.userId)==null?void 0:q.name)||"Unknown"}),e("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t.userEmail||((B=t.userId)==null?void 0:B.email)||"N/A"})]})}),e("td",{className:"px-6 py-4",children:C(t.rating)}),e("td",{className:"px-6 py-4",children:a("div",{className:"max-w-[300px]",children:[t.title&&e("p",{className:"font-medium text-gray-900 dark:text-white text-sm mb-1",children:t.title}),e("p",{className:"text-sm text-gray-600 dark:text-gray-400 line-clamp-3",children:t.body}),t.status==="rejected"&&t.rejectionReason&&a("p",{className:"text-xs text-red-500 mt-2",children:[e("span",{className:"font-medium",children:"Rejection reason:"})," ",t.rejectionReason]})]})}),e("td",{className:"px-6 py-4",children:W(t.status)}),a("td",{className:"px-6 py-4",children:[e("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:new Date(t.createdAt).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"})}),e("p",{className:"text-xs text-gray-500 dark:text-gray-500",children:new Date(t.createdAt).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit"})})]}),e("td",{className:"px-6 py-4",children:a("div",{className:"flex items-center space-x-2",children:[t.status==="pending"&&a(ee,{children:[e(i,{onClick:()=>I(t._id),disabled:D,className:"btn btn-sm bg-green-500 hover:bg-green-600 text-white",title:"Approve",children:e(l,{icon:"ph:check",className:"w-4 h-4"})}),e(i,{onClick:()=>T(t),disabled:w,className:"btn btn-sm bg-red-500 hover:bg-red-600 text-white",title:"Reject",children:e(l,{icon:"ph:x",className:"w-4 h-4"})})]}),t.status==="approved"&&e(i,{onClick:()=>T(t),disabled:w,className:"btn btn-sm bg-yellow-500 hover:bg-yellow-600 text-white",title:"Revoke Approval",children:e(l,{icon:"ph:arrow-counter-clockwise",className:"w-4 h-4"})}),t.status==="rejected"&&e(i,{onClick:()=>I(t._id),disabled:D,className:"btn btn-sm bg-green-500 hover:bg-green-600 text-white",title:"Approve",children:e(l,{icon:"ph:check",className:"w-4 h-4"})}),e(i,{onClick:()=>O(t),disabled:S,className:"btn btn-sm bg-gray-500 hover:bg-gray-600 text-white",title:"Delete",children:e(l,{icon:"ph:trash",className:"w-4 h-4"})})]})})]},t._id)})})]})}),p.totalPages>1&&e("div",{className:"px-6 py-4 border-t border-gray-200 dark:border-gray-700",children:a("div",{className:"flex items-center justify-between",children:[a("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Showing ",(n-1)*R+1," to"," ",Math.min(n*R,p.totalReviews)," of"," ",p.totalReviews," reviews"]}),a("div",{className:"flex items-center space-x-2",children:[e(i,{onClick:()=>d(t=>Math.max(1,t-1)),disabled:n===1,className:"btn btn-sm btn-outline",children:e(l,{icon:"ph:caret-left"})}),a("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Page ",n," of ",p.totalPages]}),e(i,{onClick:()=>d(t=>Math.min(p.totalPages,t+1)),disabled:n===p.totalPages,className:"btn btn-sm btn-outline",children:e(l,{icon:"ph:caret-right"})})]})]})})]}),e(U,{activeModal:_,onClose:()=>{N(!1),o(null)},title:"Reject Review",children:a("div",{className:"space-y-4",children:[e("p",{className:"text-gray-600 dark:text-gray-400",children:"Are you sure you want to reject this review? You can optionally provide a reason."}),r&&a("div",{className:"bg-gray-50 dark:bg-slate-700 p-4 rounded-lg",children:[a("p",{className:"font-medium text-gray-900 dark:text-white mb-2",children:["Review by ",r.userName]}),e("div",{className:"mb-2",children:C(r.rating)}),r.title&&e("p",{className:"font-medium text-sm mb-1",children:r.title}),e("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:r.body})]}),e(te,{label:"Rejection Reason (optional)",placeholder:"Enter reason for rejection...",value:A,onChange:t=>P(t.target.value),rows:3}),a("div",{className:"flex justify-end space-x-4",children:[e(i,{onClick:()=>{N(!1),o(null)},className:"btn btn-outline",children:"Cancel"}),e(i,{onClick:K,disabled:w,className:"btn bg-red-500 hover:bg-red-600 text-white",children:w?"Rejecting...":"Reject Review"})]})]})}),e(U,{activeModal:$,onClose:()=>{v(!1),o(null)},title:"Delete Review",children:a("div",{className:"space-y-4",children:[e("p",{className:"text-gray-600 dark:text-gray-400",children:"Are you sure you want to permanently delete this review? This action cannot be undone."}),r&&a("div",{className:"bg-gray-50 dark:bg-slate-700 p-4 rounded-lg",children:[a("p",{className:"font-medium text-gray-900 dark:text-white mb-2",children:["Review by ",r.userName]}),e("div",{className:"mb-2",children:C(r.rating)}),r.title&&e("p",{className:"font-medium text-sm mb-1",children:r.title}),e("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:r.body})]}),a("div",{className:"flex justify-end space-x-4",children:[e(i,{onClick:()=>{v(!1),o(null)},className:"btn btn-outline",children:"Cancel"}),e(i,{onClick:V,disabled:S,className:"btn bg-red-500 hover:bg-red-600 text-white",children:S?"Deleting...":"Delete Review"})]})]})})]})};export{ge as default};
