import{a4 as se,b as re,r as p,a1 as T,j as e,L,c as a,B as k,C as N,I as f,Q as x,F as J}from"./index.db1e92fc.js";import{h as ie,a as le}from"./orderApi.44bcba49.js";import{B as A}from"./Badge.ab3e07af.js";import{M as de}from"./Modal.bcd3286a.js";import{T as ne}from"./Textinput.3186cc45.js";import"./hidden.ed2eaee4.js";import"./cleave-phone.us.f6d1d37d.js";const v=w=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(w),fe=()=>{var B,F,$,R,_,M,z,q,G;const{id:w}=se();re();const[d,I]=p.exports.useState(null),[c,j]=p.exports.useState(null),[y,C]=p.exports.useState(!1),[S,r]=p.exports.useState(!1),[o,n]=p.exports.useState(!1),[h,b]=p.exports.useState(null),[U,D]=p.exports.useState([]),[K,{isLoading:O}]=ie(),{data:H,isLoading:V,error:P,refetch:W}=le({page:1,limit:1e3}),t=(((B=H==null?void 0:H.data)==null?void 0:B.orders)||[]).find(s=>s._id===w);p.exports.useEffect(()=>{(t==null?void 0:t._id)&&(t==null?void 0:t.orderCode)&&(X(),Y())},[t==null?void 0:t._id,t==null?void 0:t.orderCode]);const X=async()=>{if(!!(t!=null&&t._id)){C(!0);try{const s=T(),i=await fetch("http://35.154.139.118/api/v0/invoices?limit=1000",{method:"GET",headers:{"Content-Type":"application/json",...s&&{Authorization:`Bearer ${s}`}}});if(i.ok){const l=await i.json();if(l.status&&l.data&&Array.isArray(l.data)){const m=l.data.find(u=>u.orderId&&(u.orderId._id===t._id||u.orderId===t._id||typeof u.orderId=="string"&&u.orderId===t._id.toString()));m&&I(m)}}}catch(s){console.error("Error fetching invoice:",s)}finally{C(!1)}}},Y=async()=>{if(!!(t!=null&&t.orderCode)){r(!0);try{const s=T(),i=await fetch("http://35.154.139.118/api/v0/shipments/bvc/track/order",{method:"POST",headers:{"Content-Type":"application/json",...s&&{Authorization:`Bearer ${s}`}},body:JSON.stringify({orderCode:t.orderCode})});if(i.ok){const l=await i.json();l.success&&l.data&&j(l.data)}}catch(s){console.error("Error fetching tracking data:",s)}finally{r(!1)}}};if(V)return e("div",{className:"flex justify-center items-center h-64",children:e(L,{})});if(P)return e("div",{className:"text-center py-8",children:a("p",{className:"text-red-500",children:["Error loading order details: ",P.message]})});if(!t)return a("div",{className:"text-center py-8",children:[e("p",{className:"text-gray-500",children:"Order not found"}),e(k,{onClick:()=>window.history.back(),className:"mt-4",children:"Go Back"})]});const Z=s=>{const l={pending:{color:"bg-yellow-100 text-yellow-800",label:"Pending"},processing:{color:"bg-blue-100 text-blue-800",label:"Processing"},shipped:{color:"bg-purple-100 text-purple-800",label:"Shipped"},delivered:{color:"bg-green-100 text-green-800",label:"Delivered"},cancelled:{color:"bg-red-100 text-red-800",label:"Cancelled"},refunded:{color:"bg-gray-100 text-gray-800",label:"Refunded"}}[s]||{color:"bg-gray-100 text-gray-800",label:s};return e(A,{className:`${l.color} border-0`,children:l.label})},E=s=>{const l={pending:{color:"bg-yellow-100 text-yellow-800",label:"Pending"},paid:{color:"bg-green-100 text-green-800",label:"Paid"},failed:{color:"bg-red-100 text-red-800",label:"Failed"},refunded:{color:"bg-gray-100 text-gray-800",label:"Refunded"}}[s]||{color:"bg-gray-100 text-gray-800",label:s};return e(A,{className:`${l.color} border-0`,children:l.label})},ee=async()=>{if(!(t!=null&&t.orderCode)){x.error("Order code not found");return}try{x.info("Preparing invoice for download...");const s=T(),i={"Content-Type":"application/json"};s&&(i.Authorization=`Bearer ${s}`);const l=await fetch(`http://35.154.139.118/api/v0/invoices/order/${t.orderCode}/download`,{method:"GET",headers:i});if(l.ok){const m=await l.blob(),u=window.URL.createObjectURL(m),g=document.createElement("a");g.href=u,g.download=`Invoice-${t.orderCode}.pdf`,document.body.appendChild(g),g.click(),window.URL.revokeObjectURL(u),document.body.removeChild(g),x.success("Invoice downloaded successfully")}else{const m=await l.json().catch(()=>({}));x.error(m.message||"Failed to download invoice")}}catch(s){console.error("Download error:",s),x.error("Failed to download invoice")}};return a("div",{className:"space-y-6",children:[a("div",{className:"flex justify-between items-center",children:[a("div",{children:[e("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Order Details"}),a("p",{className:"text-gray-600 dark:text-gray-400",children:["Order ID: ",t.orderCode]})]}),a("div",{className:"flex items-center gap-4",children:[Z(t.status),E(t.paymentStatus)]})]}),a("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[a("div",{className:"xl:col-span-2 space-y-6",children:[e(N,{title:"Products ordered",bodyClass:"p-0",children:e("div",{className:"divide-y",children:(F=t.items)==null?void 0:F.map((s,i)=>{var l,m,u,g,Q;return a("div",{className:"p-5 hover:bg-gray-50 dark:hover:bg-slate-800/40 transition-colors",children:[a("div",{className:"flex items-center justify-between mb-3",children:[a("div",{className:"flex items-center gap-4",children:[e("img",{src:((m=(l=s.productDataid)==null?void 0:l.images)==null?void 0:m[0])||"/placeholder-product.jpg",alt:((u=s.productDataid)==null?void 0:u.name)||"Product",className:"w-14 h-14 rounded-md object-cover ring-1 ring-gray-200"}),a("div",{children:[e("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:((g=s.productDataid)==null?void 0:g.name)||"Product"}),a("div",{className:"text-xs text-gray-500",children:["Brand: ",((Q=s.productDataid)==null?void 0:Q.brand)||"N/A"]})]})]}),a("div",{className:"text-right",children:[e("div",{className:"font-semibold text-gray-900 dark:text-gray-100",children:v(s.price||0)}),a("div",{className:"text-xs text-gray-500",children:["Qty: ",s.quantity||1]})]})]}),t.status==="CONFIRMED"&&a("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:[a("div",{className:"flex items-center justify-between mb-2",children:[e("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"HUID (Hallmark Unique ID)"}),a(k,{onClick:()=>{b(i),D(s.huids&&s.huids.length>0?[...s.huids]:Array(s.quantity||1).fill("")),n(!0)},className:"btn btn-sm btn-outline-primary",size:"sm",children:[e(f,{icon:"ph:pencil",className:"mr-1"}),s.huids&&s.huids.length>0?"Edit":"Add"," HUID"]})]}),s.huids&&s.huids.length>0?e("div",{className:"flex flex-wrap gap-2",children:s.huids.map((te,ae)=>e(A,{className:"bg-blue-100 text-blue-800 border-0",children:te},ae))}):e("div",{className:"text-xs text-gray-500 italic",children:"No HUIDs added yet"})]})]},i)})})}),a(N,{title:a("div",{className:"flex items-center gap-2",children:[e("span",{children:"Payment"}),E(t.paymentStatus)]}),bodyClass:"p-0",children:[a("div",{className:"p-5 space-y-3",children:[a("div",{className:"flex items-center justify-between text-sm",children:[e("span",{className:"text-gray-600",children:"Subtotal"}),e("span",{className:"font-medium",children:v(t.totalAmount||0)})]}),a("div",{className:"flex items-center justify-between text-sm",children:[e("span",{className:"text-gray-600",children:"Shipping"}),e("span",{className:"font-medium",children:v(t.shippingCost||0)})]}),a("div",{className:"flex items-center justify-between text-sm",children:[e("span",{className:"text-gray-600",children:"Tax"}),e("span",{className:"font-medium",children:v(t.tax||0)})]}),a("div",{className:"border-t pt-3 flex items-center justify-between",children:[e("span",{className:"font-semibold",children:"Total"}),e("span",{className:"font-semibold",children:v(t.totalAmount||0)})]})]}),a("div",{className:"px-5 py-3 bg-gray-50 dark:bg-slate-800/40 rounded-b-xl flex items-center justify-between",children:[e("span",{className:"text-sm text-gray-600",children:"Customer payment"}),e("span",{className:"font-semibold",children:v(t.totalAmount||0)})]})]})]}),a("div",{className:"space-y-6",children:[e(N,{title:"Customer",bodyClass:"p-0",children:a("div",{className:"p-5 space-y-5",children:[e("div",{className:"flex items-center gap-3",children:a("div",{children:[e("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:(($=t.user)==null?void 0:$.name)||"N/A"}),e("div",{className:"text-xs text-gray-500",children:((R=t.user)==null?void 0:R.id)||"N/A"})]})}),a("div",{className:"divide-y",children:[a("div",{className:"py-4 flex items-center gap-3",children:[e(f,{icon:"solar:inbox-line-duotone",className:"text-xl text-gray-500"}),e("span",{className:"text-sm",children:((_=t.user)==null?void 0:_.email)||"N/A"})]}),a("div",{className:"py-4 flex items-center gap-3",children:[e(f,{icon:"solar:phone-linear",className:"text-xl text-gray-500"}),e("span",{className:"text-sm",children:((M=t.user)==null?void 0:M.phone)||"N/A"})]})]}),t.shippingAddress&&a("div",{className:"pt-2",children:[e("div",{className:"text-sm font-semibold mb-2",children:"Shipping Address"}),a("div",{className:"text-sm text-gray-600 space-y-1",children:[e("div",{children:t.shippingAddress.street||""}),a("div",{children:[t.shippingAddress.city||"",", ",t.shippingAddress.state||""]}),e("div",{children:t.shippingAddress.zipCode||""}),e("div",{children:t.shippingAddress.country||""})]})]}),t.billingAddress&&a("div",{className:"pt-4 border-t",children:[e("div",{className:"text-sm font-semibold mb-2",children:"Billing Address"}),a("div",{className:"text-sm text-gray-600 space-y-1",children:[e("div",{children:t.billingAddress.street||""}),a("div",{children:[t.billingAddress.city||"",", ",t.billingAddress.state||""]}),e("div",{children:t.billingAddress.zipCode||""}),e("div",{children:t.billingAddress.country||""})]})]})]})}),e(N,{title:"Order Information",children:a("div",{className:"space-y-3",children:[a("div",{className:"flex justify-between",children:[e("span",{className:"text-sm text-gray-600",children:"Created"}),e("span",{className:"text-sm font-medium",children:t.createdAt?new Date(t.createdAt).toLocaleDateString():"N/A"})]}),a("div",{className:"flex justify-between",children:[e("span",{className:"text-sm text-gray-600",children:"Updated"}),e("span",{className:"text-sm font-medium",children:t.updatedAt?new Date(t.updatedAt).toLocaleDateString():"N/A"})]}),a("div",{className:"flex justify-between",children:[e("span",{className:"text-sm text-gray-600",children:"Items"}),e("span",{className:"text-sm font-medium",children:((z=t.items)==null?void 0:z.length)||0})]}),((q=d==null?void 0:d.customerDetails)==null?void 0:q.address)&&a("div",{className:"pt-2 border-t",children:[e("div",{className:"text-sm text-gray-600 mb-1",children:"Billing Address:"}),a("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:[d.customerDetails.address.street&&e("div",{children:d.customerDetails.address.street}),d.customerDetails.address.city&&a("div",{children:[d.customerDetails.address.city,d.customerDetails.address.state&&`, ${d.customerDetails.address.state}`,d.customerDetails.address.pincode&&` - ${d.customerDetails.address.pincode}`]}),!d.customerDetails.address.street&&!d.customerDetails.address.city&&"N/A"]})]})]})}),e(N,{title:"Actions",children:e("div",{className:"space-y-3",children:a(k,{onClick:ee,className:"btn btn-primary w-full",children:[e(f,{icon:"ph:file-text",className:"mr-2"}),"Download Invoice"]})})})]})]}),t&&e(N,{title:"Shipment Tracking",children:S?e("div",{className:"flex justify-center items-center py-8",children:e(L,{})}):(c==null?void 0:c.trackingHistory)&&c.trackingHistory.length>0?e(ce,{trackingHistory:c.trackingHistory,statusLabel:c.statusLabel||c.status,docketNo:c.docketNo,orderDate:t.createdAt}):a("div",{className:"text-center py-8 text-gray-500",children:[e(f,{icon:"solar:box-line-duotone",className:"text-4xl mx-auto mb-2 opacity-50"}),e("p",{children:"No tracking information available"})]})}),e(de,{title:"Manage HUIDs",label:"huid-modal",activeModal:o,onClose:()=>{n(!1),b(null),D([])},children:h!==null&&t.items[h]&&a("div",{className:"space-y-4",children:[a("div",{className:"bg-gray-50 dark:bg-slate-700 p-3 rounded-lg",children:[e("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:((G=t.items[h].productDataid)==null?void 0:G.name)||"Product"}),a("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:["Quantity: ",t.items[h].quantity||1]})]}),a("div",{className:"space-y-3",children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Enter HUIDs (one per quantity):"}),U.map((s,i)=>a("div",{className:"flex items-center gap-2",children:[a("span",{className:"text-sm text-gray-600 dark:text-gray-400 w-8",children:["#",i+1,":"]}),e(ne,{type:"text",value:s,onChange:l=>{const m=[...U];m[i]=l.target.value.toUpperCase().trim(),D(m)},placeholder:`HUID ${i+1}`,className:"flex-1",maxLength:16})]},i))]}),a("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[e(k,{onClick:()=>{n(!1),b(null),D([])},className:"btn btn-outline-secondary",children:"Cancel"}),e(k,{onClick:async()=>{var s;try{await K({orderId:t._id,itemIndex:h,huids:U}).unwrap(),x.success("HUIDs updated successfully"),n(!1),b(null),D([]),W()}catch(i){console.error("Failed to update HUIDs:",i),x.error(((s=i==null?void 0:i.data)==null?void 0:s.error)||"Failed to update HUIDs")}},disabled:O,className:"btn btn-primary",children:O?a(J,{children:[e(L,{}),e("span",{className:"ml-2",children:"Saving..."})]}):a(J,{children:[e(f,{icon:"ph:floppy-disk",className:"mr-2"}),"Save HUIDs"]})})]})]})})]})},ce=({trackingHistory:w,statusLabel:d,docketNo:I,orderDate:c})=>{const j=[...w].sort((r,o)=>{const n=r.timestamp?new Date(r.timestamp).getTime():0,h=o.timestamp?new Date(o.timestamp).getTime():0;return n-h}),y=[];c&&y.push({status:"Ordered",statusCode:"ORDERED",date:new Date(c).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"}),time:new Date(c).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit"}),city:"",isOrdered:!0}),j.forEach(r=>{y.push({status:r.status||"Unknown",statusCode:r.statusCode||"",date:r.date||"",time:r.time||"",city:r.city||"",timestamp:r.timestamp})});const C=r=>{if(!r)return"solar:info-circle-line-duotone";switch(r.toUpperCase()){case"AP":return"solar:box-line-duotone";case"OP":return"solar:delivery-line-duotone";case"NP":return"solar:danger-triangle-line-duotone";case"CP":return"solar:close-circle-line-duotone";case"IT":return"solar:delivery-line-duotone";case"OFD":return"solar:delivery-line-duotone";case"DL":return"solar:check-circle-line-duotone";case"ORDERED":return"solar:cart-line-duotone";default:return"solar:info-circle-line-duotone"}},S=(r,o)=>{if(!r)return"text-blue-500";const n=r.toUpperCase();if(o)switch(n){case"DL":return"text-green-500";case"CP":case"NP":return"text-red-500";case"OFD":return"text-orange-500";default:return"text-blue-500"}return"text-blue-500"};return a("div",{className:"space-y-4",children:[a("div",{className:"flex items-center justify-between",children:[a("div",{children:[e("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Track Order"}),I&&a("p",{className:"text-sm text-gray-500 mt-1",children:["Docket: ",I]})]}),e(A,{className:"bg-blue-100 text-blue-800 border-0",children:d})]}),e("div",{className:"relative",children:y.map((r,o)=>{const n=o===y.length-1,h=o<y.length-1,b=S(r.statusCode,n);return a("div",{className:"relative flex gap-4 pb-6 last:pb-0",children:[o<y.length-1&&e("div",{className:"absolute left-4 top-8 bottom-0 w-0.5 bg-gray-200 dark:bg-gray-700"}),e("div",{className:`relative z-10 flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ${h||n?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-400"}`,children:e(f,{icon:C(r.statusCode),className:`text-lg ${h||n?"text-white":b}`})}),e("div",{className:"flex-1 pt-1",children:a("div",{className:"flex items-start justify-between",children:[a("div",{children:[e("p",{className:`font-medium ${n?"text-blue-600 dark:text-blue-400":"text-gray-900 dark:text-gray-100"}`,children:r.status}),r.city&&e("p",{className:"text-sm text-gray-500 mt-0.5",children:r.city})]}),a("div",{className:"text-right text-sm text-gray-500",children:[r.date&&e("div",{children:r.date}),r.time&&e("div",{children:r.time})]})]})})]},o)})})]})};export{fe as default};
