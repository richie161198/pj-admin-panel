import{b as le,r as d,Q as u,c as s,j as e,B as p,I as M,L as re,F as $}from"./index.575d0a96.js";import{a as I}from"./axios.e36f9bf5.js";import{B as V}from"./Badge.c3078f5c.js";import{u as D,a as ne}from"./xlsx.0799a57e.js";const me=()=>{le();const[x,q]=d.exports.useState([]),[C,A]=d.exports.useState(!0),[N,L]=d.exports.useState(""),[F,m]=d.exports.useState(1),[f,P]=d.exports.useState(""),[y,B]=d.exports.useState(""),[b,G]=d.exports.useState(""),[w,E]=d.exports.useState(""),[v,U]=d.exports.useState(""),[g,k]=d.exports.useState([]),[T,j]=d.exports.useState(!1),[O,R]=d.exports.useState(!1),W=25,[n,Y]=d.exports.useState(null);d.exports.useEffect(()=>{z()},[F,f,y,b,N,w,v]);const z=async()=>{var t,r;A(!0);try{const a=new URLSearchParams({page:F,limit:W});f&&a.append("status",f),y&&a.append("transactionType",y),b&&a.append("orderType",b),N&&a.append("search",N),w&&a.append("startDate",w),v&&a.append("endDate",v);const i=await I.get(`/investment-invoices/all?${a.toString()}`);i.data.success?(q(i.data.data||[]),Y(i.data.pagination||null)):u.error("Failed to fetch invoices")}catch(a){console.error("Error fetching invoices:",a),u.error(((r=(t=a.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to fetch invoices")}finally{A(!1)}},Q=t=>{L(t.target.value),m(1)},H=()=>{L(""),P(""),B(""),G(""),E(""),U(""),m(1)},J=async(t,r)=>{try{u.info("Preparing invoice for download...");const a=await I.get(`/investment-invoices/download/${t}`,{responseType:"blob"}),i=new Blob([a.data],{type:"application/pdf"}),l=window.URL.createObjectURL(i),c=document.createElement("a");c.href=l,c.download=`${r}.pdf`,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(l),u.success("Invoice downloaded successfully")}catch(a){console.error("Error downloading invoice:",a),u.error("Failed to download invoice")}},K=async()=>{if(g.length===0){u.warning("Please select invoices to download");return}R(!0);let t=0,r=0;try{for(const a of g){const i=x.find(l=>l._id===a);if(!!i)try{const l=await I.get(`/investment-invoices/download/${a}`,{responseType:"blob"}),c=new Blob([l.data],{type:"application/pdf"}),o=window.URL.createObjectURL(c),h=document.createElement("a");h.href=o,h.download=`${i.invoiceNumber}.pdf`,document.body.appendChild(h),h.click(),document.body.removeChild(h),window.URL.revokeObjectURL(o),t++,await new Promise(S=>setTimeout(S,500))}catch(l){console.error(`Error downloading invoice ${i.invoiceNumber}:`,l),r++}}t>0&&u.success(`Successfully downloaded ${t} invoice(s)`),r>0&&u.error(`Failed to download ${r} invoice(s)`),k([]),j(!1)}catch(a){console.error("Error in bulk download:",a),u.error("Bulk download failed")}finally{R(!1)}},X=()=>{try{const t=x.map((l,c)=>{var h;const o=_(l);return{"S.No":c+1,"Invoice Number":l.invoiceNumber||"N/A","Order ID":l.orderId||"N/A","Customer Name":l.customerName||"N/A","Customer Email":l.customerEmail||"N/A","Customer Phone":l.customerPhone||"N/A","Gold Price (\u20B9/g)":l.ratePerGram||0,Grams:l.quantity||0,"Type (BUY/SELL)":((h=l.orderType)==null?void 0:h.toUpperCase())||"N/A","Transaction Type":l.transactionType||"N/A","Mode of Transaction":l.paymentMethod||"N/A",Product:l.product||"N/A",Amount:l.amount||0,"GST Rate (%)":l.gstRate||0,"GST Type":o.type,"CGST (1.5%)":o.cgst||0,"SGST (1.5%)":o.sgst||0,"IGST (3%)":o.igst||0,"Total GST Amount":l.gstAmount||0,"Total Invoice Value":l.totalInvoiceValue||0,Status:l.status||"N/A","Invoice Date":l.createdAt?new Date(l.createdAt).toLocaleDateString():"N/A"}}),r=D.json_to_sheet(t),a=D.book_new();D.book_append_sheet(a,r,"Investment Invoices");const i=[{wch:5},{wch:20},{wch:25},{wch:20},{wch:25},{wch:15},{wch:12},{wch:15},{wch:12},{wch:15},{wch:15},{wch:12},{wch:15},{wch:10},{wch:12},{wch:12},{wch:12},{wch:12},{wch:15},{wch:18},{wch:15},{wch:12},{wch:15}];r["!cols"]=i,ne(a,`Investment_Invoices_${new Date().toISOString().slice(0,10)}.xlsx`),u.success("Excel file downloaded successfully")}catch(t){console.error("Error exporting to Excel:",t),u.error("Failed to export to Excel")}},Z=()=>{k(T?[]:x.map(t=>t._id)),j(!T)},ee=t=>{k(r=>r.includes(t)?r.filter(a=>a!==t):[...r,t])},te=t=>{const a={buy:{color:"success",text:"BUY"},sell:{color:"warning",text:"SELL"}}[t]||{color:"secondary",text:t};return e(V,{className:`badge-${a.color}`,children:a.text})},ae=t=>{const a={GOLD:{color:"warning",text:"GOLD",icon:"\u{1F947}"},SILVER:{color:"secondary",text:"SILVER",icon:"\u{1F948}"}}[t]||{color:"info",text:t,icon:""};return s(V,{className:`badge-${a.color}`,children:[a.icon," ",a.text]})},se=t=>{var c,o,h,S;const r=((o=(c=t.userId)==null?void 0:c.state)==null?void 0:o.toUpperCase())||"",a=(h=t.userId)==null?void 0:h.address;let i="";Array.isArray(a)&&a.length>0?i=(((S=a[0])==null?void 0:S.state)||"").toUpperCase():typeof a=="string"&&(i=a.toUpperCase());const l=r||i;return l.includes("TAMIL NADU")||l.includes("TAMILNADU")||l.includes(" TN ")||l.endsWith(" TN")},_=t=>{const r=t.gstAmount||0;if(r===0)return{type:"N/A",rate:"0%",cgst:0,sgst:0,igst:0,isTamilNadu:!1};if(se(t)){const i=r/2,l=r/2;return{type:"CGST + SGST",rate:"1.5% + 1.5%",cgst:i,sgst:l,igst:0,isTamilNadu:!0}}else return{type:"IGST",rate:"3%",cgst:0,sgst:0,igst:r,isTamilNadu:!1}};return s("div",{className:"space-y-5",children:[s("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[s("div",{children:[e("h4",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Investment Invoices"}),e("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:"Manage and download investment transaction invoices"})]}),s("div",{className:"flex gap-2",children:[e(p,{icon:"heroicons-outline:download",text:"Export to Excel",className:"btn-success",onClick:X,disabled:C||x.length===0}),g.length>0&&e(p,{icon:"heroicons-outline:download",text:`Download Selected (${g.length})`,className:"btn-primary",onClick:K,disabled:O,isLoading:O})]})]}),e("div",{className:"card",children:e("div",{className:"card-body",children:s("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 p-4",children:[s("div",{children:[e("label",{className:"form-label",children:"Search"}),s("div",{className:"relative",children:[e("input",{type:"text",className:"form-control",placeholder:"Invoice No, Order ID, Customer...",value:N,onChange:Q}),e(M,{icon:"heroicons-outline:search",className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400"})]})]}),s("div",{children:[e("label",{className:"form-label",children:"Status"}),s("select",{className:"form-control",value:f,onChange:t=>{P(t.target.value),m(1)},children:[e("option",{value:"",children:"All Statuses"}),e("option",{value:"draft",children:"Draft"}),e("option",{value:"issued",children:"Issued"}),e("option",{value:"paid",children:"Paid"}),e("option",{value:"cancelled",children:"Cancelled"})]})]}),s("div",{children:[e("label",{className:"form-label",children:"Asset Type"}),s("select",{className:"form-control",value:y,onChange:t=>{B(t.target.value),m(1)},children:[e("option",{value:"",children:"All Assets"}),e("option",{value:"GOLD",children:"Gold"}),e("option",{value:"SILVER",children:"Silver"})]})]}),s("div",{children:[e("label",{className:"form-label",children:"Order Type"}),s("select",{className:"form-control",value:b,onChange:t=>{G(t.target.value),m(1)},children:[e("option",{value:"",children:"All Types"}),e("option",{value:"buy",children:"Buy"}),e("option",{value:"sell",children:"Sell"})]})]}),s("div",{children:[e("label",{className:"form-label",children:"Start Date"}),e("input",{type:"date",className:"form-control",value:w,onChange:t=>{E(t.target.value),m(1)}})]}),s("div",{children:[e("label",{className:"form-label",children:"End Date"}),e("input",{type:"date",className:"form-control",value:v,onChange:t=>{U(t.target.value),m(1)}})]}),e("div",{className:"flex items-end",children:e(p,{text:"Clear Filters",className:"btn-outline-secondary w-full",onClick:H})})]})})}),e("div",{className:"card",children:e("div",{className:"card-body px-0 pb-0",children:C?e("div",{className:"flex justify-center items-center py-20",children:e(re,{})}):x.length===0?s("div",{className:"text-center py-20",children:[e(M,{icon:"heroicons-outline:document-text",className:"mx-auto text-slate-300 dark:text-slate-600 mb-4",width:"64"}),e("p",{className:"text-slate-500 dark:text-slate-400",children:"No invoices found"})]}):s($,{children:[e("div",{className:"overflow-x-auto",children:s("table",{className:"min-w-full divide-y divide-slate-200 dark:divide-slate-700",children:[e("thead",{className:"bg-slate-50 dark:bg-slate-800",children:s("tr",{children:[e("th",{className:"px-6 py-3 text-left",children:e("input",{type:"checkbox",checked:T,onChange:Z,className:"form-checkbox"})}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Invoice Details"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Customer"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Gold Price"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Grams"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Type"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Mode"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"GST"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Amount"}),e("th",{className:"px-6 py-3 text-center text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:"Actions"})]})}),e("tbody",{className:"bg-white dark:bg-slate-800 divide-y divide-slate-200 dark:divide-slate-700",children:x.map(t=>{var r,a,i,l,c;return s("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-700",children:[e("td",{className:"px-6 py-4",children:e("input",{type:"checkbox",checked:g.includes(t._id),onChange:()=>ee(t._id),className:"form-checkbox"})}),e("td",{className:"px-6 py-4",children:s("div",{children:[e("div",{className:"text-sm font-semibold text-slate-900 dark:text-white",children:t.invoiceNumber}),s("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:["Order: ",t.orderId]}),e("div",{className:"text-xs text-slate-400 dark:text-slate-500",children:new Date(t.createdAt).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})}),e("td",{className:"px-6 py-4",children:s("div",{children:[e("div",{className:"text-sm font-medium text-slate-900 dark:text-white",children:t.customerName}),e("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:t.customerEmail}),e("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:t.customerPhone})]})}),e("td",{className:"px-6 py-4",children:s("div",{className:"text-sm text-slate-900 dark:text-white",children:["\u20B9",((r=t.ratePerGram)==null?void 0:r.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2}))||"0.00","/g"]})}),e("td",{className:"px-6 py-4",children:s("div",{className:"text-sm text-slate-900 dark:text-white",children:[((a=t.quantity)==null?void 0:a.toLocaleString("en-IN",{minimumFractionDigits:3,maximumFractionDigits:4}))||"0.000","g"]})}),e("td",{className:"px-6 py-4",children:e("div",{className:"space-y-1",children:s("div",{className:"flex gap-2",children:[te(t.orderType),ae(t.transactionType)]})})}),e("td",{className:"px-6 py-4",children:e("div",{className:"text-sm text-slate-900 dark:text-white",children:t.paymentMethod||"N/A"})}),e("td",{className:"px-6 py-4",children:e("div",{children:t.gstAmount>0?s($,{children:[s("div",{className:"text-sm font-medium text-slate-900 dark:text-white",children:["\u20B9",(i=t.gstAmount)==null?void 0:i.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]}),(()=>{const o=_(t);return o.isTamilNadu?s("div",{className:"text-xs text-slate-500 dark:text-slate-400 space-y-0.5",children:[s("div",{children:["CGST (1.5%): \u20B9",o.cgst.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]}),s("div",{children:["SGST (1.5%): \u20B9",o.sgst.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}):s("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:["IGST (3%): \u20B9",o.igst.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]})})()]}):e("div",{className:"text-sm text-slate-500 dark:text-slate-400",children:"\u20B90.00"})})}),e("td",{className:"px-6 py-4",children:s("div",{children:[s("div",{className:"text-sm font-semibold text-slate-900 dark:text-white",children:["\u20B9",(l=t.totalInvoiceValue)==null?void 0:l.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]}),s("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:["Base: \u20B9",(c=t.amount)==null?void 0:c.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})}),e("td",{className:"px-6 py-4",children:e("div",{className:"flex gap-2 justify-center",children:e(p,{icon:"heroicons-outline:download",className:"btn-sm btn-primary",onClick:()=>J(t._id,t.invoiceNumber),title:"Download Invoice"})})})]},t._id)})})]})}),e("div",{className:"px-6 py-4 bg-slate-50 dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700",children:s("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s("div",{children:[e("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Total Invoices"}),e("p",{className:"text-lg font-semibold text-slate-900 dark:text-white",children:(n==null?void 0:n.total)||x.length})]}),s("div",{children:[e("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Total Amount"}),s("p",{className:"text-lg font-semibold text-slate-900 dark:text-white",children:["\u20B9",x.reduce((t,r)=>t+(r.totalInvoiceValue||0),0).toLocaleString("en-IN")]})]}),s("div",{children:[e("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Total GST"}),s("p",{className:"text-lg font-semibold text-slate-900 dark:text-white",children:["\u20B9",x.reduce((t,r)=>t+(r.gstAmount||0),0).toLocaleString("en-IN")]})]}),s("div",{children:[e("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Selected"}),e("p",{className:"text-lg font-semibold text-slate-900 dark:text-white",children:g.length})]})]})}),n&&n.totalPages>1&&s("div",{className:"bg-white dark:bg-slate-800 px-4 py-3 flex items-center justify-between border-t border-slate-200 dark:border-slate-700 sm:px-6",children:[s("div",{className:"flex-1 flex justify-between sm:hidden",children:[e(p,{onClick:()=>m(t=>Math.max(t-1,1)),disabled:n.page===1,className:"btn btn-sm btn-outline",children:"Previous"}),e(p,{onClick:()=>m(t=>Math.min(t+1,n.totalPages)),disabled:n.page===n.totalPages,className:"btn btn-sm btn-outline",children:"Next"})]}),s("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e("div",{children:s("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Showing ",e("span",{className:"font-medium",children:(n.page-1)*25+1})," to"," ",e("span",{className:"font-medium",children:Math.min(n.page*25,n.total||0)})," ","of ",e("span",{className:"font-medium",children:n.total||0})," results"]})}),e("div",{children:s("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px",children:[e(p,{onClick:()=>m(t=>Math.max(t-1,1)),disabled:n.page===1,className:"btn btn-sm btn-outline rounded-l-md",children:"Previous"}),Array.from({length:Math.min(n.totalPages,10)},(t,r)=>{let a;return n.totalPages<=10||n.page<=5?a=r+1:n.page>=n.totalPages-4?a=n.totalPages-9+r:a=n.page-5+r,e(p,{onClick:()=>m(a),className:`btn btn-sm ${n.page===a?"btn-primary":"btn-outline"}`,children:a},a)}),e(p,{onClick:()=>m(t=>Math.min(t+1,n.totalPages)),disabled:n.page===n.totalPages,className:"btn btn-sm btn-outline rounded-r-md",children:"Next"})]})})]})]})]})})})]})};export{me as default};
