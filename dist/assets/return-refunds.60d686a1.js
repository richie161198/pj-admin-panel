import{b as se,r as i,j as e,L as le,c as a,B as n,I as x,Q as h}from"./index.93603967.js";import{d as de,e as ce,f as ne}from"./orderApi.c470ea6a.js";import{B as Q}from"./Badge.2391c60f.js";import{M as ie}from"./Modal.ade8a040.js";import{T as oe}from"./Textarea.bf611ae2.js";import"./hidden.de24e25a.js";const ye=()=>{var M,I,q,T,D,B;se();const[f,$]=i.exports.useState(""),[o,d]=i.exports.useState(1),[b,O]=i.exports.useState(""),[N,G]=i.exports.useState(""),[v,H]=i.exports.useState(""),[k,J]=i.exports.useState(""),[g,p]=i.exports.useState(null),[K,y]=i.exports.useState(!1),[w,u]=i.exports.useState(""),R=10,U={page:o,limit:R,...b&&{status:b},...N&&{requestType:N},...f&&{search:f},...v&&{startDate:v},...k&&{endDate:k}},{data:l,isLoading:V,error:S,refetch:j}=de(U),[W]=ce(),[X]=ne(),P=((M=l==null?void 0:l.data)==null?void 0:M.returnRequests)||[],c=((I=l==null?void 0:l.data)==null?void 0:I.pagination)||{},C=((q=l==null?void 0:l.data)==null?void 0:q.summary)||{};(T=l==null?void 0:l.data)!=null&&T.breakdown;const Y=async t=>{var s;try{await W({requestId:t}).unwrap(),h.success("Return/Refund request approved successfully"),j()}catch(r){h.error(((s=r==null?void 0:r.data)==null?void 0:s.error)||"Failed to approve request")}},Z=t=>{p(t),u(""),y(!0)},ee=async()=>{var t;if(!w.trim()){h.error("Please provide a rejection reason");return}try{await X({requestId:g._id,rejectionMessage:w.trim()}).unwrap(),h.success("Return/Refund request rejected successfully"),y(!1),p(null),u(""),j()}catch(s){h.error(((t=s==null?void 0:s.data)==null?void 0:t.error)||"Failed to reject request")}},te=t=>{const r={requested:{color:"bg-yellow-100 text-yellow-800",label:"Requested"},approved:{color:"bg-green-100 text-green-800",label:"Approved"},rejected:{color:"bg-red-100 text-red-800",label:"Rejected"},collected:{color:"bg-blue-100 text-blue-800",label:"Collected"},completed:{color:"bg-gray-100 text-gray-800",label:"Completed"}}[t]||{color:"bg-gray-100 text-gray-800",label:t};return e(Q,{className:`${r.color} border-0`,children:r.label})},ae=t=>{const r={return:{color:"bg-orange-100 text-orange-800",label:"Return"},refund:{color:"bg-purple-100 text-purple-800",label:"Refund"}}[t]||{color:"bg-gray-100 text-gray-800",label:t};return e(Q,{className:`${r.color} border-0`,children:r.label})},A=t=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(t||0);return V?e("div",{className:"flex justify-center items-center h-64",children:e(le,{})}):S?a("div",{className:"text-center py-8",children:[a("p",{className:"text-red-500",children:["Error loading return/refund requests: ",S.message]}),e(n,{onClick:()=>j(),className:"mt-4",children:"Retry"})]}):a("div",{className:"space-y-6",children:[e("div",{className:"flex justify-between items-center",children:a("div",{children:[e("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Return & Refund Requests"}),e("p",{className:"text-gray-600 dark:text-gray-400",children:"Manage customer return and refund requests"})]})}),a("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow p-6",children:a("div",{className:"flex items-center justify-between",children:[a("div",{children:[e("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Requests"}),e("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:C.totalRequests||0})]}),e("div",{className:"p-3 bg-blue-100 dark:bg-blue-900 rounded-full",children:e(x,{icon:"heroicons:document-text",className:"text-2xl text-blue-600 dark:text-blue-400"})})]})}),e("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow p-6",children:a("div",{className:"flex items-center justify-between",children:[a("div",{children:[e("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Refund Amount"}),e("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:A(C.totalRefundAmount)})]}),e("div",{className:"p-3 bg-green-100 dark:bg-green-900 rounded-full",children:e(x,{icon:"heroicons:currency-rupee",className:"text-2xl text-green-600 dark:text-green-400"})})]})}),e("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow p-6",children:a("div",{className:"flex items-center justify-between",children:[a("div",{children:[e("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Average Refund"}),e("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:A(C.averageRefundAmount)})]}),e("div",{className:"p-3 bg-purple-100 dark:bg-purple-900 rounded-full",children:e(x,{icon:"heroicons:chart-bar",className:"text-2xl text-purple-600 dark:text-purple-400"})})]})})]}),e("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow p-6",children:a("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Search"}),e("input",{type:"text",value:f,onChange:t=>{$(t.target.value),d(1)},placeholder:"Search by order code, customer...",className:"form-control"})]}),a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Status"}),a("select",{value:b,onChange:t=>{O(t.target.value),d(1)},className:"form-control",children:[e("option",{value:"",children:"All Status"}),e("option",{value:"requested",children:"Requested"}),e("option",{value:"approved",children:"Approved"}),e("option",{value:"rejected",children:"Rejected"}),e("option",{value:"collected",children:"Collected"}),e("option",{value:"completed",children:"Completed"})]})]}),a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Request Type"}),a("select",{value:N,onChange:t=>{G(t.target.value),d(1)},className:"form-control",children:[e("option",{value:"",children:"All Types"}),e("option",{value:"return",children:"Return"}),e("option",{value:"refund",children:"Refund"})]})]}),a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Start Date"}),e("input",{type:"date",value:v,onChange:t=>{H(t.target.value),d(1)},className:"form-control"})]}),a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"End Date"}),e("input",{type:"date",value:k,onChange:t=>{J(t.target.value),d(1)},className:"form-control"})]})]})}),a("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow overflow-hidden",children:[e("div",{className:"overflow-x-auto",children:a("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e("thead",{className:"bg-gray-50 dark:bg-slate-700",children:a("tr",{children:[e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Order Code"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Customer"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Type"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Products"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Refund Amount"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Created At"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e("tbody",{className:"bg-white dark:bg-slate-800 divide-y divide-gray-200 dark:divide-gray-700",children:P.length===0?e("tr",{children:e("td",{colSpan:"9",className:"px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:"No return/refund requests found"})}):P.map(t=>{var s,r,F,E;return a("tr",{className:"hover:bg-gray-50 dark:hover:bg-slate-700",children:[e("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:((s=t.orderId)==null?void 0:s.orderCode)||"N/A"}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:a("div",{children:[e("div",{className:"font-medium",children:((r=t.userId)==null?void 0:r.name)||"N/A"}),e("div",{className:"text-gray-500 dark:text-gray-400 text-xs",children:((F=t.userId)==null?void 0:F.email)||"N/A"})]})}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:ae(t.requestType)}),e("td",{className:"px-6 py-4 text-sm text-gray-900 dark:text-white",children:e("div",{className:"space-y-1",children:(E=t.items)==null?void 0:E.map((m,re)=>{var L,_,z;return a("div",{className:"flex items-center space-x-2",children:[((_=(L=m.productId)==null?void 0:L.images)==null?void 0:_[0])&&e("img",{src:m.productId.images[0],alt:m.productId.name,className:"w-8 h-8 rounded object-cover"}),a("div",{children:[e("div",{className:"text-xs font-medium",children:((z=m.productId)==null?void 0:z.name)||"Product"}),a("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Qty: ",m.qty," | Reason: ",m.reason]})]})]},re)})})}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:t.refundAmount&&t.refundAmount>0?A(t.refundAmount):"\u20B90.00"}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:te(t.status)}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:new Date(t.createdAt).toLocaleDateString()}),a("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[t.status==="requested"&&a("div",{className:"flex space-x-2",children:[a(n,{onClick:()=>Y(t._id),className:"btn btn-sm btn-success",size:"sm",children:[e(x,{icon:"heroicons:check",className:"mr-1"}),"Accept"]}),a(n,{onClick:()=>Z(t),className:"btn btn-sm btn-danger",size:"sm",children:[e(x,{icon:"heroicons:x-mark",className:"mr-1"}),"Reject"]})]}),t.status==="rejected"&&t.rejectionMessage&&e("div",{className:"text-xs text-red-600 dark:text-red-400 max-w-xs truncate",title:t.rejectionMessage,children:t.rejectionMessage})]})]},t._id)})})]})}),c.totalPages>1&&a("div",{className:"bg-gray-50 dark:bg-slate-700 px-4 py-3 flex items-center justify-between border-t border-gray-200 dark:border-gray-600",children:[a("div",{className:"flex-1 flex justify-between sm:hidden",children:[e(n,{onClick:()=>d(t=>Math.max(1,t-1)),disabled:!c.hasPrevPage,className:"btn btn-sm",children:"Previous"}),e(n,{onClick:()=>d(t=>t+1),disabled:!c.hasNextPage,className:"btn btn-sm",children:"Next"})]}),a("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e("div",{children:a("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Showing ",e("span",{className:"font-medium",children:(o-1)*R+1})," to"," ",e("span",{className:"font-medium",children:Math.min(o*R,c.totalRequests)})," ","of ",e("span",{className:"font-medium",children:c.totalRequests})," results"]})}),e("div",{children:a("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[e(n,{onClick:()=>d(t=>Math.max(1,t-1)),disabled:!c.hasPrevPage,className:"btn btn-sm",children:"Previous"}),[...Array(c.totalPages)].map((t,s)=>{const r=s+1;return r===1||r===c.totalPages||r>=o-1&&r<=o+1?e(n,{onClick:()=>d(r),className:`btn btn-sm ${o===r?"btn-primary":""}`,children:r},r):r===o-2||r===o+2?e("span",{className:"px-4 py-2",children:"..."},r):null}),e(n,{onClick:()=>d(t=>Math.min(c.totalPages,t+1)),disabled:!c.hasNextPage,className:"btn btn-sm",children:"Next"})]})})]})]})]}),e(ie,{title:"Reject Return/Refund Request",label:"reject-modal",activeModal:K,onClose:()=>{y(!1),u(""),p(null)},children:a("div",{className:"space-y-4",children:[a("div",{children:[e("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:"Please provide a reason for rejecting this request:"}),g&&a("div",{className:"mb-4 p-3 bg-gray-50 dark:bg-slate-700 rounded",children:[a("p",{className:"text-sm font-medium",children:["Order: ",(D=g.orderId)==null?void 0:D.orderCode]}),a("p",{className:"text-sm",children:["Customer: ",(B=g.userId)==null?void 0:B.name]})]})]}),e(oe,{value:w,onChange:t=>u(t.target.value),placeholder:"Enter rejection reason...",rows:4,className:"form-control"}),a("div",{className:"flex justify-end space-x-3",children:[e(n,{onClick:()=>{y(!1),u(""),p(null)},className:"btn btn-outline-secondary",children:"Cancel"}),e(n,{onClick:ee,className:"btn btn-danger",children:"Reject Request"})]})]})})]})};export{ye as default};
