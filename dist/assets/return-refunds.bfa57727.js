import{d as me,b as ue,r as p,j as e,L as H,c as a,B as u,I as x,F as J,Q as g}from"./index.575d0a96.js";import{d as he,e as pe,f as ge}from"./orderApi.45223adf.js";import{B as K}from"./Badge.c3078f5c.js";import{M as xe}from"./Modal.471ad5e3.js";import{T as ye}from"./Textarea.af653a9c.js";import"./hidden.fadc684a.js";const be=me.injectEndpoints({endpoints:h=>({createReturnShipment:h.mutation({query:d=>({url:"/shipments/admin/return",method:"POST",body:d}),invalidatesTags:["Order","ReturnRefund"]}),trackShipmentByOrder:h.mutation({query:d=>({url:"/shipments/bvc/track/order",method:"POST",body:d})}),getShipmentByOrder:h.query({query:d=>`/shipments/order/${d}`,providesTags:["Order"]}),getAllShipments:h.query({query:(d={})=>{const o=new URLSearchParams;return Object.keys(d).forEach(n=>{d[n]!==void 0&&d[n]!==""&&o.append(n,d[n])}),`/shipments?${o.toString()}`},providesTags:["Order"]}),cancelShipment:h.mutation({query:d=>({url:"/shipments/cancel",method:"POST",body:d}),invalidatesTags:["Order"]})})}),{useCreateReturnShipmentMutation:fe,useTrackShipmentByOrderMutation:Ce,useGetShipmentByOrderQuery:Se,useGetAllShipmentsQuery:Pe,useCancelShipmentMutation:Ae}=be,Te=()=>{var D,_,$,Q,z,G;ue();const[h,d]=p.exports.useState(""),[o,n]=p.exports.useState(1),[S,W]=p.exports.useState(""),[P,X]=p.exports.useState(""),[A,Y]=p.exports.useState(""),[T,Z]=p.exports.useState(""),[v,k]=p.exports.useState(null),[U,w]=p.exports.useState(!1),[M,y]=p.exports.useState(""),q=10,ee={page:o,limit:q,...S&&{status:S},...P&&{requestType:P},...h&&{search:h},...A&&{startDate:A},...T&&{endDate:T}},{data:c,isLoading:te,error:F,refetch:I}=he(ee),[ae]=pe(),[re]=ge(),[se,{isLoading:L}]=fe(),E=((D=c==null?void 0:c.data)==null?void 0:D.returnRequests)||[],m=((_=c==null?void 0:c.data)==null?void 0:_.pagination)||{},O=(($=c==null?void 0:c.data)==null?void 0:$.summary)||{};(Q=c==null?void 0:c.data)!=null&&Q.breakdown;const ne=async t=>{var l,C,b,f,N;const i=typeof t=="string"?t:t._id,r=typeof t=="object"?(l=t.orderId)==null?void 0:l.orderCode:null,R=typeof t=="object"?t.requestType:null,j=typeof t=="object"?t.reason||((b=(C=t.items)==null?void 0:C[0])==null?void 0:b.reason):null;try{if(await ae({requestId:i}).unwrap(),R==="return"&&r)try{await se({orderCode:r,reason:j||"Return approved by admin"}).unwrap(),g.success("Return/Refund request approved and return shipment created successfully")}catch(s){console.error("Failed to create return shipment:",s),g.warning("Return/Refund request approved, but return shipment creation failed. Please create manually.")}else g.success("Return/Refund request approved successfully");I()}catch(s){console.error("Failed to approve request:",s),g.error(((f=s==null?void 0:s.data)==null?void 0:f.error)||((N=s==null?void 0:s.data)==null?void 0:N.message)||"Failed to approve request")}},le=t=>{k(t),y(""),w(!0)},de=async()=>{var t;if(!M.trim()){g.error("Please provide a rejection reason");return}try{await re({requestId:v._id,rejectionMessage:M.trim()}).unwrap(),g.success("Return/Refund request rejected successfully"),w(!1),k(null),y(""),I()}catch(i){g.error(((t=i==null?void 0:i.data)==null?void 0:t.error)||"Failed to reject request")}},ce=t=>{const r={requested:{color:"bg-yellow-100 text-yellow-800",label:"Requested"},approved:{color:"bg-green-100 text-green-800",label:"Approved"},rejected:{color:"bg-red-100 text-red-800",label:"Rejected"},collected:{color:"bg-blue-100 text-blue-800",label:"Collected"},completed:{color:"bg-gray-100 text-gray-800",label:"Completed"}}[t]||{color:"bg-gray-100 text-gray-800",label:t};return e(K,{className:`${r.color} border-0`,children:r.label})},ie=t=>{const r={return:{color:"bg-orange-100 text-orange-800",label:"Return"},refund:{color:"bg-purple-100 text-purple-800",label:"Refund"}}[t]||{color:"bg-gray-100 text-gray-800",label:t};return e(K,{className:`${r.color} border-0`,children:r.label})},B=t=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(t||0);return te?e("div",{className:"flex justify-center items-center h-64",children:e(H,{})}):F?a("div",{className:"text-center py-8",children:[a("p",{className:"text-red-500",children:["Error loading return/refund requests: ",F.message]}),e(u,{onClick:()=>I(),className:"mt-4",children:"Retry"})]}):a("div",{className:"space-y-6",children:[e("div",{className:"flex justify-between items-center",children:a("div",{children:[e("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Return & Refund Requests"}),e("p",{className:"text-gray-600 dark:text-gray-400",children:"Manage customer return and refund requests"})]})}),a("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow p-6",children:a("div",{className:"flex items-center justify-between",children:[a("div",{children:[e("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Requests"}),e("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:O.totalRequests||0})]}),e("div",{className:"p-3 bg-blue-100 dark:bg-blue-900 rounded-full",children:e(x,{icon:"heroicons:document-text",className:"text-2xl text-blue-600 dark:text-blue-400"})})]})}),e("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow p-6",children:a("div",{className:"flex items-center justify-between",children:[a("div",{children:[e("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Refund Amount"}),e("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:B(O.totalRefundAmount)})]}),e("div",{className:"p-3 bg-green-100 dark:bg-green-900 rounded-full",children:e(x,{icon:"heroicons:currency-rupee",className:"text-2xl text-green-600 dark:text-green-400"})})]})}),e("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow p-6",children:a("div",{className:"flex items-center justify-between",children:[a("div",{children:[e("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Average Refund"}),e("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:B(O.averageRefundAmount)})]}),e("div",{className:"p-3 bg-purple-100 dark:bg-purple-900 rounded-full",children:e(x,{icon:"heroicons:chart-bar",className:"text-2xl text-purple-600 dark:text-purple-400"})})]})})]}),e("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow p-6",children:a("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Search"}),e("input",{type:"text",value:h,onChange:t=>{d(t.target.value),n(1)},placeholder:"Search by order code, customer...",className:"form-control"})]}),a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Status"}),a("select",{value:S,onChange:t=>{W(t.target.value),n(1)},className:"form-control",children:[e("option",{value:"",children:"All Status"}),e("option",{value:"requested",children:"Requested"}),e("option",{value:"approved",children:"Approved"}),e("option",{value:"rejected",children:"Rejected"}),e("option",{value:"collected",children:"Collected"}),e("option",{value:"completed",children:"Completed"})]})]}),a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Request Type"}),a("select",{value:P,onChange:t=>{X(t.target.value),n(1)},className:"form-control",children:[e("option",{value:"",children:"All Types"}),e("option",{value:"return",children:"Return"}),e("option",{value:"refund",children:"Refund"})]})]}),a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Start Date"}),e("input",{type:"date",value:A,onChange:t=>{Y(t.target.value),n(1)},className:"form-control"})]}),a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"End Date"}),e("input",{type:"date",value:T,onChange:t=>{Z(t.target.value),n(1)},className:"form-control"})]})]})}),a("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow overflow-hidden",children:[e("div",{className:"overflow-x-auto",children:a("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e("thead",{className:"bg-gray-50 dark:bg-slate-700",children:a("tr",{children:[e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Order Code"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Customer"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Type"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Products"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Refund Amount"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Created At"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e("tbody",{className:"bg-white dark:bg-slate-800 divide-y divide-gray-200 dark:divide-gray-700",children:E.length===0?e("tr",{children:e("td",{colSpan:"9",className:"px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:"No return/refund requests found"})}):E.map(t=>{var i,r,R,j;return a("tr",{className:"hover:bg-gray-50 dark:hover:bg-slate-700",children:[e("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:((i=t.orderId)==null?void 0:i.orderCode)||"N/A"}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:a("div",{children:[e("div",{className:"font-medium",children:((r=t.userId)==null?void 0:r.name)||"N/A"}),e("div",{className:"text-gray-500 dark:text-gray-400 text-xs",children:((R=t.userId)==null?void 0:R.email)||"N/A"})]})}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:ie(t.requestType)}),e("td",{className:"px-6 py-4 text-sm text-gray-900 dark:text-white",children:e("div",{className:"space-y-2",children:(j=t.items)==null?void 0:j.map((l,C)=>{var b,f,N;return a("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-2 last:border-b-0",children:[a("div",{className:"flex items-center space-x-2 mb-1",children:[((f=(b=l.productId)==null?void 0:b.images)==null?void 0:f[0])&&e("img",{src:l.productId.images[0],alt:l.productId.name,className:"w-8 h-8 rounded object-cover"}),a("div",{className:"flex-1",children:[e("div",{className:"text-xs font-medium",children:((N=l.productId)==null?void 0:N.name)||"Product"}),a("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Qty: ",l.qty," | Reason: ",l.reason]}),l.note&&a("div",{className:"text-xs text-gray-600 dark:text-gray-300 mt-1 italic",children:["Note: ",l.note]})]})]}),l.mediaUrls&&l.mediaUrls.length>0&&a("div",{className:"mt-2",children:[a("div",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Evidence (",l.mediaUrls.length,"):"]}),e("div",{className:"flex flex-wrap gap-2",children:l.mediaUrls.map((s,V)=>{const oe=s.toLowerCase().includes(".mp4")||s.toLowerCase().includes(".mov")||s.toLowerCase().includes(".webm")||s.toLowerCase().includes("/video/");return e("div",{className:"relative",children:oe?e("div",{className:"w-20 h-20 bg-gray-200 dark:bg-gray-700 rounded overflow-hidden flex items-center justify-center cursor-pointer",onClick:()=>window.open(s,"_blank"),children:e(x,{icon:"heroicons:play",className:"text-2xl text-gray-600 dark:text-gray-300"})}):e("img",{src:s,alt:`Evidence ${V+1}`,className:"w-20 h-20 rounded object-cover cursor-pointer hover:opacity-80",onClick:()=>window.open(s,"_blank")})},V)})})]})]},C)})})}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:t.refundAmount&&t.refundAmount>0?B(t.refundAmount):"\u20B90.00"}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:ce(t.status)}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:new Date(t.createdAt).toLocaleDateString()}),a("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[t.status==="requested"&&a("div",{className:"flex space-x-2",children:[e(u,{onClick:()=>ne(t),disabled:L,className:"btn btn-sm btn-success",size:"sm",children:L?a(J,{children:[e(H,{}),e("span",{className:"ml-1",children:"Processing..."})]}):a(J,{children:[e(x,{icon:"heroicons:check",className:"mr-1"}),"Accept"]})}),a(u,{onClick:()=>le(t),className:"btn btn-sm btn-danger",size:"sm",children:[e(x,{icon:"heroicons:x-mark",className:"mr-1"}),"Reject"]})]}),t.status==="rejected"&&t.rejectionMessage&&e("div",{className:"text-xs text-red-600 dark:text-red-400 max-w-xs truncate",title:t.rejectionMessage,children:t.rejectionMessage})]})]},t._id)})})]})}),m.totalPages>1&&a("div",{className:"bg-gray-50 dark:bg-slate-700 px-4 py-3 flex items-center justify-between border-t border-gray-200 dark:border-gray-600",children:[a("div",{className:"flex-1 flex justify-between sm:hidden",children:[e(u,{onClick:()=>n(t=>Math.max(1,t-1)),disabled:!m.hasPrevPage,className:"btn btn-sm",children:"Previous"}),e(u,{onClick:()=>n(t=>t+1),disabled:!m.hasNextPage,className:"btn btn-sm",children:"Next"})]}),a("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e("div",{children:a("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Showing ",e("span",{className:"font-medium",children:(o-1)*q+1})," to"," ",e("span",{className:"font-medium",children:Math.min(o*q,m.totalRequests)})," ","of ",e("span",{className:"font-medium",children:m.totalRequests})," results"]})}),e("div",{children:a("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[e(u,{onClick:()=>n(t=>Math.max(1,t-1)),disabled:!m.hasPrevPage,className:"btn btn-sm",children:"Previous"}),[...Array(m.totalPages)].map((t,i)=>{const r=i+1;return r===1||r===m.totalPages||r>=o-1&&r<=o+1?e(u,{onClick:()=>n(r),className:`btn btn-sm ${o===r?"btn-primary":""}`,children:r},r):r===o-2||r===o+2?e("span",{className:"px-4 py-2",children:"..."},r):null}),e(u,{onClick:()=>n(t=>Math.min(m.totalPages,t+1)),disabled:!m.hasNextPage,className:"btn btn-sm",children:"Next"})]})})]})]})]}),e(xe,{title:"Reject Return/Refund Request",label:"reject-modal",activeModal:U,onClose:()=>{w(!1),y(""),k(null)},children:a("div",{className:"space-y-4",children:[a("div",{children:[e("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:"Please provide a reason for rejecting this request:"}),v&&a("div",{className:"mb-4 p-3 bg-gray-50 dark:bg-slate-700 rounded",children:[a("p",{className:"text-sm font-medium",children:["Order: ",(z=v.orderId)==null?void 0:z.orderCode]}),a("p",{className:"text-sm",children:["Customer: ",(G=v.userId)==null?void 0:G.name]})]})]}),e(ye,{value:M,onChange:t=>y(t.target.value),placeholder:"Enter rejection reason...",rows:4,className:"form-control"}),a("div",{className:"flex justify-end space-x-3",children:[e(u,{onClick:()=>{w(!1),y(""),k(null)},className:"btn btn-outline-secondary",children:"Cancel"}),e(u,{onClick:de,className:"btn btn-danger",children:"Reject Request"})]})]})})]})};export{Te as default};
