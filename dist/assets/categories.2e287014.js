import{r as f,j as e,c as t,B as i,I as g,F as E,Q as c,b as Q,L as W}from"./index.ce738da1.js";import{f as G,g as V,a as Y,h as H}from"./productApi.0617a2ca.js";import{a as K}from"./imageApi.7faabe19.js";import{u as R,w as X}from"./xlsx.0799a57e.js";const Z=({category:o,onClose:w,isEdit:h=!1})=>{const[r,x]=f.exports.useState({name:"",image:null,newTag:!1}),[D,L]=f.exports.useState(null),[N,k]=f.exports.useState(null),[C,{isLoading:s}]=G(),[M,{isLoading:u}]=V(),[j,{isLoading:U}]=K();f.exports.useEffect(()=>{h&&o&&(x({name:o.name||"",image:o.image||null,newTag:o.newTag||!1}),o.image&&k(o.image))},[h,o]);const _=d=>{const{name:n,value:y,type:m,checked:v}=d.target;x(A=>({...A,[n]:m==="checkbox"?v:y}))},l=d=>{const n=d.target.files[0];if(!n)return;if(!n.type.startsWith("image/")){c.error("Please select a valid image file");return}L(n);const y=URL.createObjectURL(n);k(y)};return e("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:t("div",{className:"p-6",children:[t("div",{className:"flex justify-between items-center mb-6",children:[e("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:h?"Edit Category":"Add New Category"}),e(i,{onClick:w,className:"btn btn-sm btn-outline",children:e(g,{icon:"ph:x"})})]}),t("form",{onSubmit:async d=>{var n,y;if(d.preventDefault(),!r.name.trim()){c.error("Category name is required");return}if(!D&&!r.image){c.error("Category image is required");return}try{let m=r.image;if(D){const A=new FormData;A.append("image",D);try{const S=await j(A).unwrap();m=((n=S.data)==null?void 0:n.url)||S.url||S}catch{c.error("Failed to upload image");return}}if(!m){c.error("Category image is required");return}const v={name:r.name.trim(),image:m,newTag:r.newTag||!1};h?(await M({id:o._id,...v}).unwrap(),c.success("Category updated successfully")):(await C(v).unwrap(),c.success("Category created successfully")),w()}catch(m){c.error(((y=m.data)==null?void 0:y.message)||m.message||"Failed to save category")}},className:"space-y-6",children:[t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Category Name *"}),e("input",{type:"text",name:"name",value:r.name,onChange:_,required:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-700 dark:text-white",placeholder:"Enter category name"})]}),t("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Category Image *"}),e("input",{type:"file",accept:"image/*",onChange:l,required:!h||!r.image,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-700 dark:text-white"}),!N&&!r.image&&e("p",{className:"mt-1 text-sm text-red-500 dark:text-red-400",children:"Please upload a category image"}),(N||r.image)&&e("div",{className:"mt-4",children:e("img",{src:N||r.image,alt:"Category preview",className:"w-32 h-32 object-cover rounded-lg border border-gray-300 dark:border-gray-600"})})]}),t("div",{className:"flex items-center",children:[e("input",{type:"checkbox",name:"newTag",checked:r.newTag,onChange:_,className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e("label",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Mark as New Category"})]}),t("div",{className:"flex justify-end space-x-4 pt-6 border-t",children:[e(i,{type:"button",onClick:w,className:"btn btn-outline",children:"Cancel"}),e(i,{type:"submit",disabled:s||u||U,className:"btn btn-primary",children:s||u||U?t(E,{children:[e(g,{icon:"ph:spinner",className:"animate-spin mr-2"}),U?"Uploading...":h?"Updating...":"Creating..."]}):t(E,{children:[e(g,{icon:"ph:check",className:"mr-2"}),h?"Update Category":"Create Category"]})})]})]})]})})})},se=()=>{const o=Q(),[w,h]=f.exports.useState(""),[r,x]=f.exports.useState(1),[D,L]=f.exports.useState(!1),[N,k]=f.exports.useState(null),C=10,{data:s,isLoading:M,error:u,refetch:j}=Y(),[U,{isLoading:_}]=H();let l=[];s&&(Array.isArray(s)?l=s:s.details&&Array.isArray(s.details)?l=s.details:s.data&&Array.isArray(s.data)?l=s.data:s.categories&&Array.isArray(s.categories)&&(l=s.categories)),console.log("Categories Response:",s),console.log("Categories:",l);const F=Array.isArray(l)?l.filter(a=>{var b,I;return((b=a.name)==null?void 0:b.toLowerCase().includes(w.toLowerCase()))||((I=a.description)==null?void 0:I.toLowerCase().includes(w.toLowerCase()))}):[],d=Math.ceil(F.length/C),n=(r-1)*C,y=F.slice(n,n+C),m=async a=>{if(window.confirm("Are you sure you want to delete this category?"))try{await U(a).unwrap(),c.success("Category deleted successfully"),j()}catch{c.error("Failed to delete category")}},v=()=>{k(null),L(!0)},A=a=>{k(a),L(!0)},S=()=>{L(!1),k(null),j()},O=a=>{o(`/categories/${a}`)},q=()=>{try{const a=l.map((p,J)=>({"S.No":J+1,"Category ID":p._id,Name:p.name||"N/A",Description:p.description||"N/A","New Tag":p.newTag?"Yes":"No","Created At":p.createdAt?new Date(p.createdAt).toLocaleDateString():"N/A","Updated At":p.updatedAt?new Date(p.updatedAt).toLocaleDateString():"N/A","Image URL":p.image||"N/A"})),b=R.book_new(),I=R.json_to_sheet(a),B=[{wch:5},{wch:25},{wch:20},{wch:30},{wch:10},{wch:15},{wch:15},{wch:50}];I["!cols"]=B,R.book_append_sheet(b,I,"Categories");const $=X(b,{bookType:"xlsx",type:"array"}),z=new Blob([$],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),P=window.URL.createObjectURL(z),T=document.createElement("a");T.href=P,T.download=`categories_export_${new Date().toISOString().split("T")[0]}.xlsx`,document.body.appendChild(T),T.click(),document.body.removeChild(T),window.URL.revokeObjectURL(P),c.success("Category data exported successfully!")}catch(a){console.error("Export error:",a),c.error("Failed to export category data")}};return M?e("div",{className:"flex justify-center items-center h-64",children:e(W,{})}):u?(console.error("Categories Error:",u),t("div",{className:"text-center py-8",children:[t("p",{className:"text-red-500",children:["Error loading categories: ",u.message]}),t("p",{className:"text-sm text-gray-500",children:["Status: ",u.status]}),t("p",{className:"text-sm text-gray-500",children:["Data: ",JSON.stringify(u.data)]}),t("div",{className:"mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-lg text-left",children:[e("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Full Error:"}),e("pre",{className:"text-xs text-gray-500 dark:text-gray-500 mt-2 overflow-auto",children:JSON.stringify(u,null,2)})]}),e(i,{onClick:()=>j(),className:"mt-4",children:"Retry"})]})):t("div",{className:"space-y-6",children:[t("div",{className:"flex justify-between items-center",children:[t("div",{children:[e("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Categories"}),e("p",{className:"text-gray-600 dark:text-gray-400",children:"Manage your product categories"})]}),t("div",{className:"flex space-x-3",children:[t(i,{onClick:q,className:"btn btn-outline-success",disabled:!l||l.length===0,children:[e(g,{icon:"ph:download",className:"mr-2"}),"Export Excel"]}),t(i,{onClick:v,className:"btn btn-primary",children:[e(g,{icon:"ph:plus",className:"mr-2"}),"Add Category"]})]})]}),e("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:e("div",{className:"flex flex-col sm:flex-row gap-4",children:e("div",{className:"flex-1",children:t("div",{className:"relative",children:[e(g,{icon:"ph:magnifying-glass",className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e("input",{type:"text",placeholder:"Search categories...",value:w,onChange:a=>h(a.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-700 dark:text-white"})]})})})}),t("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm overflow-hidden",children:[e("div",{className:"overflow-x-auto",children:t("table",{className:"w-full",children:[e("thead",{className:"bg-gray-50 dark:bg-slate-700",children:t("tr",{children:[e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Category"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Description"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Created"}),e("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e("tbody",{className:"bg-white dark:bg-slate-800 divide-y divide-gray-200 dark:divide-gray-700",children:y.map(a=>t("tr",{className:"hover:bg-gray-50 dark:hover:bg-slate-700",children:[e("td",{className:"px-6 py-4 whitespace-nowrap",children:t("div",{className:"flex items-center",children:[e("div",{className:"flex-shrink-0 h-12 w-12",children:a.image?e("img",{src:a.image,alt:a.name,className:"h-12 w-12 rounded-lg object-cover"}):e("div",{className:"h-12 w-12 rounded-lg bg-gray-200 dark:bg-gray-600 flex items-center justify-center",children:e(g,{icon:"ph:image",className:"text-gray-400"})})}),t("div",{className:"ml-4",children:[e("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:a.name||"N/A"}),t("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["ID: ",a._id]})]})]})}),e("td",{className:"px-6 py-4",children:e("div",{className:"text-sm text-gray-900 dark:text-white max-w-xs truncate",children:a.description||"No description"})}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:e("div",{className:"flex flex-col space-y-1",children:e("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${a.newTag?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"}`,children:a.newTag?"New":"Regular"})})}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:a.createdAt?new Date(a.createdAt).toLocaleDateString():"N/A"}),e("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t("div",{className:"flex justify-end space-x-2",children:[e(i,{onClick:()=>O(a._id),className:"btn btn-sm btn-outline-primary",children:e(g,{icon:"ph:eye"})}),e(i,{onClick:()=>A(a),className:"btn btn-sm btn-outline-secondary",children:e(g,{icon:"ph:pencil"})}),e(i,{onClick:()=>m(a._id),disabled:_,className:"btn btn-sm btn-outline-danger",children:e(g,{icon:"ph:trash"})})]})})]},a._id))})]})}),d>1&&t("div",{className:"bg-white dark:bg-slate-800 px-4 py-3 flex items-center justify-between border-t border-gray-200 dark:border-gray-700 sm:px-6",children:[t("div",{className:"flex-1 flex justify-between sm:hidden",children:[e(i,{onClick:()=>x(a=>Math.max(a-1,1)),disabled:r===1,className:"btn btn-sm btn-outline",children:"Previous"}),e(i,{onClick:()=>x(a=>Math.min(a+1,d)),disabled:r===d,className:"btn btn-sm btn-outline",children:"Next"})]}),t("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e("div",{children:t("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Showing ",e("span",{className:"font-medium",children:n+1})," to"," ",e("span",{className:"font-medium",children:Math.min(n+C,F.length)})," ","of ",e("span",{className:"font-medium",children:F.length})," results"]})}),e("div",{children:t("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px",children:[e(i,{onClick:()=>x(a=>Math.max(a-1,1)),disabled:r===1,className:"btn btn-sm btn-outline rounded-l-md",children:"Previous"}),Array.from({length:d},(a,b)=>b+1).map(a=>e(i,{onClick:()=>x(a),className:`btn btn-sm ${r===a?"btn-primary":"btn-outline"}`,children:a},a)),e(i,{onClick:()=>x(a=>Math.min(a+1,d)),disabled:r===d,className:"btn btn-sm btn-outline rounded-r-md",children:"Next"})]})})]})]})]}),D&&e(Z,{category:N,onClose:S,isEdit:!!N})]})};export{se as default};
