import{a4 as q,b as J,r as N,a1 as D,j as e,L as U,c as a,B as _,I as v,Q as b}from"./index.67c6c4a2.js";import{a as K}from"./orderApi.f50feebc.js";import{C as x}from"./Card.c3fb850e.js";import{B as j}from"./Badge.c6da6b21.js";const y=f=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(f),Z=()=>{var L,T,O,P,B,E,$,R;const{id:f}=q();J();const[n,w]=N.exports.useState(null),[l,C]=N.exports.useState(null),[u,k]=N.exports.useState(!1),[A,r]=N.exports.useState(!1),{data:d,isLoading:m,error:p}=K({page:1,limit:1e3}),t=(((L=d==null?void 0:d.data)==null?void 0:L.orders)||[]).find(s=>s._id===f);N.exports.useEffect(()=>{(t==null?void 0:t._id)&&(t==null?void 0:t.orderCode)&&(z(),H())},[t==null?void 0:t._id,t==null?void 0:t.orderCode]);const z=async()=>{if(!!(t!=null&&t._id)){k(!0);try{const s=D(),c=await fetch("http://35.154.139.118/api/v0/invoices?limit=1000",{method:"GET",headers:{"Content-Type":"application/json",...s&&{Authorization:`Bearer ${s}`}}});if(c.ok){const i=await c.json();if(i.status&&i.data&&Array.isArray(i.data)){const h=i.data.find(o=>o.orderId&&(o.orderId._id===t._id||o.orderId===t._id||typeof o.orderId=="string"&&o.orderId===t._id.toString()));h&&w(h)}}}catch(s){console.error("Error fetching invoice:",s)}finally{k(!1)}}},H=async()=>{if(!!(t!=null&&t.orderCode)){r(!0);try{const s=D(),c=await fetch("http://35.154.139.118/api/v0/shipments/bvc/track/order",{method:"POST",headers:{"Content-Type":"application/json",...s&&{Authorization:`Bearer ${s}`}},body:JSON.stringify({orderCode:t.orderCode})});if(c.ok){const i=await c.json();i.success&&i.data&&C(i.data)}}catch(s){console.error("Error fetching tracking data:",s)}finally{r(!1)}}};if(m)return e("div",{className:"flex justify-center items-center h-64",children:e(U,{})});if(p)return e("div",{className:"text-center py-8",children:a("p",{className:"text-red-500",children:["Error loading order details: ",p.message]})});if(!t)return a("div",{className:"text-center py-8",children:[e("p",{className:"text-gray-500",children:"Order not found"}),e(_,{onClick:()=>window.history.back(),className:"mt-4",children:"Go Back"})]});const G=s=>{const i={pending:{color:"bg-yellow-100 text-yellow-800",label:"Pending"},processing:{color:"bg-blue-100 text-blue-800",label:"Processing"},shipped:{color:"bg-purple-100 text-purple-800",label:"Shipped"},delivered:{color:"bg-green-100 text-green-800",label:"Delivered"},cancelled:{color:"bg-red-100 text-red-800",label:"Cancelled"},refunded:{color:"bg-gray-100 text-gray-800",label:"Refunded"}}[s]||{color:"bg-gray-100 text-gray-800",label:s};return e(j,{className:`${i.color} border-0`,children:i.label})},S=s=>{const i={pending:{color:"bg-yellow-100 text-yellow-800",label:"Pending"},paid:{color:"bg-green-100 text-green-800",label:"Paid"},failed:{color:"bg-red-100 text-red-800",label:"Failed"},refunded:{color:"bg-gray-100 text-gray-800",label:"Refunded"}}[s]||{color:"bg-gray-100 text-gray-800",label:s};return e(j,{className:`${i.color} border-0`,children:i.label})},Q=async()=>{if(!(t!=null&&t.orderCode)){b.error("Order code not found");return}try{b.info("Preparing invoice for download...");const s=D(),c={"Content-Type":"application/json"};s&&(c.Authorization=`Bearer ${s}`);const i=await fetch(`http://35.154.139.118/api/v0/invoices/order/${t.orderCode}/download`,{method:"GET",headers:c});if(i.ok){const h=await i.blob(),o=window.URL.createObjectURL(h),g=document.createElement("a");g.href=o,g.download=`Invoice-${t.orderCode}.pdf`,document.body.appendChild(g),g.click(),window.URL.revokeObjectURL(o),document.body.removeChild(g),b.success("Invoice downloaded successfully")}else{const h=await i.json().catch(()=>({}));b.error(h.message||"Failed to download invoice")}}catch(s){console.error("Download error:",s),b.error("Failed to download invoice")}};return a("div",{className:"space-y-6",children:[a("div",{className:"flex justify-between items-center",children:[a("div",{children:[e("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Order Details"}),a("p",{className:"text-gray-600 dark:text-gray-400",children:["Order ID: ",t.orderCode]})]}),a("div",{className:"flex items-center gap-4",children:[G(t.status),S(t.paymentStatus)]})]}),a("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[a("div",{className:"xl:col-span-2 space-y-6",children:[e(x,{title:"Products ordered",bodyClass:"p-0",children:e("div",{className:"divide-y",children:(T=t.items)==null?void 0:T.map((s,c)=>{var i,h,o,g,F;return a("div",{className:"flex items-center justify-between p-5 hover:bg-gray-50 dark:hover:bg-slate-800/40 transition-colors",children:[a("div",{className:"flex items-center gap-4",children:[e("img",{src:((h=(i=s.productDataid)==null?void 0:i.images)==null?void 0:h[0])||"/placeholder-product.jpg",alt:((o=s.productDataid)==null?void 0:o.name)||"Product",className:"w-14 h-14 rounded-md object-cover ring-1 ring-gray-200"}),a("div",{children:[e("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:((g=s.productDataid)==null?void 0:g.name)||"Product"}),a("div",{className:"text-xs text-gray-500",children:["Brand: ",((F=s.productDataid)==null?void 0:F.brand)||"N/A"]})]})]}),a("div",{className:"text-right",children:[e("div",{className:"font-semibold text-gray-900 dark:text-gray-100",children:y(s.price||0)}),a("div",{className:"text-xs text-gray-500",children:["Qty: ",s.quantity||1]})]})]},c)})})}),a(x,{title:a("div",{className:"flex items-center gap-2",children:[e("span",{children:"Payment"}),S(t.paymentStatus)]}),bodyClass:"p-0",children:[a("div",{className:"p-5 space-y-3",children:[a("div",{className:"flex items-center justify-between text-sm",children:[e("span",{className:"text-gray-600",children:"Subtotal"}),e("span",{className:"font-medium",children:y(t.totalAmount||0)})]}),a("div",{className:"flex items-center justify-between text-sm",children:[e("span",{className:"text-gray-600",children:"Shipping"}),e("span",{className:"font-medium",children:y(t.shippingCost||0)})]}),a("div",{className:"flex items-center justify-between text-sm",children:[e("span",{className:"text-gray-600",children:"Tax"}),e("span",{className:"font-medium",children:y(t.tax||0)})]}),a("div",{className:"border-t pt-3 flex items-center justify-between",children:[e("span",{className:"font-semibold",children:"Total"}),e("span",{className:"font-semibold",children:y(t.totalAmount||0)})]})]}),a("div",{className:"px-5 py-3 bg-gray-50 dark:bg-slate-800/40 rounded-b-xl flex items-center justify-between",children:[e("span",{className:"text-sm text-gray-600",children:"Customer payment"}),e("span",{className:"font-semibold",children:y(t.totalAmount||0)})]})]})]}),a("div",{className:"space-y-6",children:[e(x,{title:"Customer",bodyClass:"p-0",children:a("div",{className:"p-5 space-y-5",children:[e("div",{className:"flex items-center gap-3",children:a("div",{children:[e("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:((O=t.user)==null?void 0:O.name)||"N/A"}),e("div",{className:"text-xs text-gray-500",children:((P=t.user)==null?void 0:P.id)||"N/A"})]})}),a("div",{className:"divide-y",children:[a("div",{className:"py-4 flex items-center gap-3",children:[e(v,{icon:"solar:inbox-line-duotone",className:"text-xl text-gray-500"}),e("span",{className:"text-sm",children:((B=t.user)==null?void 0:B.email)||"N/A"})]}),a("div",{className:"py-4 flex items-center gap-3",children:[e(v,{icon:"solar:phone-linear",className:"text-xl text-gray-500"}),e("span",{className:"text-sm",children:((E=t.user)==null?void 0:E.phone)||"N/A"})]})]}),t.shippingAddress&&a("div",{className:"pt-2",children:[e("div",{className:"text-sm font-semibold mb-2",children:"Shipping Address"}),a("div",{className:"text-sm text-gray-600 space-y-1",children:[e("div",{children:t.shippingAddress.street||""}),a("div",{children:[t.shippingAddress.city||"",", ",t.shippingAddress.state||""]}),e("div",{children:t.shippingAddress.zipCode||""}),e("div",{children:t.shippingAddress.country||""})]})]}),t.billingAddress&&a("div",{className:"pt-4 border-t",children:[e("div",{className:"text-sm font-semibold mb-2",children:"Billing Address"}),a("div",{className:"text-sm text-gray-600 space-y-1",children:[e("div",{children:t.billingAddress.street||""}),a("div",{children:[t.billingAddress.city||"",", ",t.billingAddress.state||""]}),e("div",{children:t.billingAddress.zipCode||""}),e("div",{children:t.billingAddress.country||""})]})]})]})}),e(x,{title:"Order Information",children:a("div",{className:"space-y-3",children:[a("div",{className:"flex justify-between",children:[e("span",{className:"text-sm text-gray-600",children:"Invoice No."}),e("span",{className:"text-sm font-medium",children:u?"Loading...":(n==null?void 0:n.invoiceNumber)||"N/A"})]}),a("div",{className:"flex justify-between",children:[e("span",{className:"text-sm text-gray-600",children:"Created"}),e("span",{className:"text-sm font-medium",children:t.createdAt?new Date(t.createdAt).toLocaleDateString():"N/A"})]}),a("div",{className:"flex justify-between",children:[e("span",{className:"text-sm text-gray-600",children:"Updated"}),e("span",{className:"text-sm font-medium",children:t.updatedAt?new Date(t.updatedAt).toLocaleDateString():"N/A"})]}),a("div",{className:"flex justify-between",children:[e("span",{className:"text-sm text-gray-600",children:"Items"}),e("span",{className:"text-sm font-medium",children:(($=t.items)==null?void 0:$.length)||0})]}),((R=n==null?void 0:n.customerDetails)==null?void 0:R.address)&&a("div",{className:"pt-2 border-t",children:[e("div",{className:"text-sm text-gray-600 mb-1",children:"Billing Address:"}),a("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:[n.customerDetails.address.street&&e("div",{children:n.customerDetails.address.street}),n.customerDetails.address.city&&a("div",{children:[n.customerDetails.address.city,n.customerDetails.address.state&&`, ${n.customerDetails.address.state}`,n.customerDetails.address.pincode&&` - ${n.customerDetails.address.pincode}`]}),!n.customerDetails.address.street&&!n.customerDetails.address.city&&"N/A"]})]})]})}),e(x,{title:"Actions",children:e("div",{className:"space-y-3",children:a(_,{onClick:Q,className:"btn btn-primary w-full",children:[e(v,{icon:"ph:file-text",className:"mr-2"}),"Download Invoice"]})})})]})]}),t&&e(x,{title:"Shipment Tracking",children:A?e("div",{className:"flex justify-center items-center py-8",children:e(U,{})}):(l==null?void 0:l.trackingHistory)&&l.trackingHistory.length>0?e(M,{trackingHistory:l.trackingHistory,statusLabel:l.statusLabel||l.status,docketNo:l.docketNo,orderDate:t.createdAt}):a("div",{className:"text-center py-8 text-gray-500",children:[e(v,{icon:"solar:box-line-duotone",className:"text-4xl mx-auto mb-2 opacity-50"}),e("p",{children:"No tracking information available"})]})})]})},M=({trackingHistory:f,statusLabel:n,docketNo:w,orderDate:l})=>{const C=[...f].sort((r,d)=>{const m=r.timestamp?new Date(r.timestamp).getTime():0,p=d.timestamp?new Date(d.timestamp).getTime():0;return m-p}),u=[];l&&u.push({status:"Ordered",statusCode:"ORDERED",date:new Date(l).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"}),time:new Date(l).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit"}),city:"",isOrdered:!0}),C.forEach(r=>{u.push({status:r.status||"Unknown",statusCode:r.statusCode||"",date:r.date||"",time:r.time||"",city:r.city||"",timestamp:r.timestamp})});const k=r=>{if(!r)return"solar:info-circle-line-duotone";switch(r.toUpperCase()){case"AP":return"solar:box-line-duotone";case"OP":return"solar:delivery-line-duotone";case"NP":return"solar:danger-triangle-line-duotone";case"CP":return"solar:close-circle-line-duotone";case"IT":return"solar:delivery-line-duotone";case"OFD":return"solar:delivery-line-duotone";case"DL":return"solar:check-circle-line-duotone";case"ORDERED":return"solar:cart-line-duotone";default:return"solar:info-circle-line-duotone"}},A=(r,d)=>{if(!r)return"text-blue-500";const m=r.toUpperCase();if(d)switch(m){case"DL":return"text-green-500";case"CP":case"NP":return"text-red-500";case"OFD":return"text-orange-500";default:return"text-blue-500"}return"text-blue-500"};return a("div",{className:"space-y-4",children:[a("div",{className:"flex items-center justify-between",children:[a("div",{children:[e("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Track Order"}),w&&a("p",{className:"text-sm text-gray-500 mt-1",children:["Docket: ",w]})]}),e(j,{className:"bg-blue-100 text-blue-800 border-0",children:n})]}),e("div",{className:"relative",children:u.map((r,d)=>{const m=d===u.length-1,p=d<u.length-1,I=A(r.statusCode,m);return a("div",{className:"relative flex gap-4 pb-6 last:pb-0",children:[d<u.length-1&&e("div",{className:"absolute left-4 top-8 bottom-0 w-0.5 bg-gray-200 dark:bg-gray-700"}),e("div",{className:`relative z-10 flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ${p||m?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-400"}`,children:e(v,{icon:k(r.statusCode),className:`text-lg ${p||m?"text-white":I}`})}),e("div",{className:"flex-1 pt-1",children:a("div",{className:"flex items-start justify-between",children:[a("div",{children:[e("p",{className:`font-medium ${m?"text-blue-600 dark:text-blue-400":"text-gray-900 dark:text-gray-100"}`,children:r.status}),r.city&&e("p",{className:"text-sm text-gray-500 mt-0.5",children:r.city})]}),a("div",{className:"text-right text-sm text-gray-500",children:[r.date&&e("div",{children:r.date}),r.time&&e("div",{children:r.time})]})]})})]},d)})})]})};export{Z as default};
