import{b as z,r as M,j as e,L as J,c as s,B as d,I as h,Q as b}from"./index.2de9f08c.js";import{u as W,a as q}from"./authApiSlice.402bede1.js";import{u as k,w as H}from"./xlsx.0799a57e.js";const ee=()=>{const y=z(),[p,E]=M.exports.useState(""),[i,m]=M.exports.useState(1),g=10,[R,{isLoading:U}]=W(),{data:u,isLoading:$,error:v,refetch:C}=q(),c=(u==null?void 0:u.details)||[],f=(c==null?void 0:c.filter(t=>{var r,l,N;return((r=t.name)==null?void 0:r.toLowerCase().includes(p.toLowerCase()))||((l=t.email)==null?void 0:l.toLowerCase().includes(p.toLowerCase()))||((N=t.phone)==null?void 0:N.toLowerCase().includes(p.toLowerCase()))}))||[],o=Math.ceil(f.length/g),w=(i-1)*g,T=f.slice(w,w+g),O=async t=>{if(window.confirm("Are you sure you want to delete this customer?"))try{await R(t).unwrap(),b.success("Customer deleted successfully"),C()}catch{b.error("Failed to delete customer")}},V=t=>{y(`/customers/${t}`)},Y=()=>{try{const t=c.map((a,Q)=>{var L,D,j,S,_,P,B,I;return{"S.No":Q+1,"Customer ID":a._id,Name:a.name||"N/A",Email:a.email||"N/A",Phone:a.phone||"N/A",Status:a.active?"Active":"Inactive",Blocked:a.isBlocked?"Yes":"No","Mobile Verified":a.mobileVerified?"Yes":"No","Active Account":a.activeAccount?"Yes":"No",Balance:a.balance||"0","Gold Balance":a.goldBalance||"0","App ID":a.appId||"N/A","Referral Code":a.referralCode||"N/A",Role:a.role||"N/A","Last Login":a.lastLogin?new Date(a.lastLogin).toLocaleDateString():"Never",Address:a.address&&a.address.length>0&&(((L=a.address.find(n=>n.isDefault))==null?void 0:L.street)||((D=a.address[0])==null?void 0:D.street))||"N/A",City:a.address&&a.address.length>0&&(((j=a.address.find(n=>n.isDefault))==null?void 0:j.city)||((S=a.address[0])==null?void 0:S.city))||"N/A",State:a.address&&a.address.length>0&&(((_=a.address.find(n=>n.isDefault))==null?void 0:_.state)||((P=a.address[0])==null?void 0:P.state))||"N/A",Pincode:a.address&&a.address.length>0&&(((B=a.address.find(n=>n.isDefault))==null?void 0:B.pincode)||((I=a.address[0])==null?void 0:I.pincode))||"N/A"}}),r=k.book_new(),l=k.json_to_sheet(t),N=[{wch:5},{wch:25},{wch:20},{wch:30},{wch:15},{wch:10},{wch:10},{wch:15},{wch:15},{wch:12},{wch:15},{wch:20},{wch:15},{wch:10},{wch:15},{wch:30},{wch:15},{wch:10},{wch:10}];l["!cols"]=N,k.book_append_sheet(r,l,"Customers");const F=H(r,{bookType:"xlsx",type:"array"}),G=new Blob([F],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),A=window.URL.createObjectURL(G),x=document.createElement("a");x.href=A,x.download=`customers_export_${new Date().toISOString().split("T")[0]}.xlsx`,document.body.appendChild(x),x.click(),document.body.removeChild(x),window.URL.revokeObjectURL(A),b.success("Customer data exported successfully!")}catch(t){console.error("Export error:",t),b.error("Failed to export customer data")}};return $?e("div",{className:"flex justify-center items-center h-64",children:e(J,{})}):v?s("div",{className:"text-center py-8",children:[s("p",{className:"text-red-500",children:["Error loading customers: ",v.message]}),e(d,{onClick:()=>C(),className:"mt-4",children:"Retry"})]}):s("div",{className:"space-y-6",children:[s("div",{className:"flex justify-between items-center",children:[s("div",{children:[e("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Customers"}),e("p",{className:"text-gray-600 dark:text-gray-400",children:"Manage your customer database"})]}),s("div",{className:"flex space-x-3",children:[s(d,{onClick:Y,className:"btn btn-outline-success",disabled:!c||c.length===0,children:[e(h,{icon:"ph:download",className:"mr-2"}),"Export Excel"]}),s(d,{onClick:()=>y("/customers/new"),className:"btn btn-primary",children:[e(h,{icon:"ph:plus",className:"mr-2"}),"Add Customer"]})]})]}),e("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:e("div",{className:"flex flex-col sm:flex-row gap-4",children:e("div",{className:"flex-1",children:s("div",{className:"relative",children:[e(h,{icon:"ph:magnifying-glass",className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e("input",{type:"text",placeholder:"Search customers...",value:p,onChange:t=>E(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-700 dark:text-white"})]})})})}),s("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm overflow-hidden",children:[e("div",{className:"overflow-x-auto",children:s("table",{className:"w-full",children:[e("thead",{className:"bg-gray-50 dark:bg-slate-700",children:s("tr",{children:[e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Customer"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Email"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Phone"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Join Date"}),e("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e("tbody",{className:"bg-white dark:bg-slate-800 divide-y divide-gray-200 dark:divide-gray-700",children:T.map(t=>{var r,l;return s("tr",{className:"hover:bg-gray-50 dark:hover:bg-slate-700",children:[e("td",{className:"px-6 py-4 whitespace-nowrap",children:s("div",{className:"flex items-center",children:[e("div",{className:"flex-shrink-0 h-10 w-10",children:t.profilePhoto?e("img",{src:t.profilePhoto,alt:t.name,className:"h-10 w-10 rounded-full object-cover"}):e("div",{className:"h-10 w-10 rounded-full bg-blue-500 flex items-center justify-center text-white font-medium",children:((l=(r=t.name)==null?void 0:r.charAt(0))==null?void 0:l.toUpperCase())||"C"})}),s("div",{className:"ml-4",children:[e("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.name||"N/A"}),s("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["ID: ",t._id]})]})]})}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:e("div",{className:"text-sm text-gray-900 dark:text-white",children:t.email||"N/A"})}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:e("div",{className:"text-sm text-gray-900 dark:text-white",children:t.phone||"N/A"})}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:s("div",{className:"flex flex-col space-y-1",children:[e("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t.active?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,children:t.active?"Active":"Inactive"}),t.isBlocked&&e("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",children:"Blocked"})]})}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:t.lastLogin?new Date(t.lastLogin).toLocaleDateString():"Never"}),e("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:s("div",{className:"flex justify-end space-x-2",children:[e(d,{onClick:()=>V(t._id),className:"btn btn-sm btn-outline-primary",children:e(h,{icon:"ph:eye"})}),e(d,{onClick:()=>y(`/customers/${t._id}/edit`),className:"btn btn-sm btn-outline-secondary",children:e(h,{icon:"ph:pencil"})}),e(d,{onClick:()=>O(t._id),disabled:U,className:"btn btn-sm btn-outline-danger",children:e(h,{icon:"ph:trash"})})]})})]},t._id)})})]})}),o>1&&s("div",{className:"bg-white dark:bg-slate-800 px-4 py-3 flex items-center justify-between border-t border-gray-200 dark:border-gray-700 sm:px-6",children:[s("div",{className:"flex-1 flex justify-between sm:hidden",children:[e(d,{onClick:()=>m(t=>Math.max(t-1,1)),disabled:i===1,className:"btn btn-sm btn-outline",children:"Previous"}),e(d,{onClick:()=>m(t=>Math.min(t+1,o)),disabled:i===o,className:"btn btn-sm btn-outline",children:"Next"})]}),s("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e("div",{children:s("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Showing ",e("span",{className:"font-medium",children:w+1})," to"," ",e("span",{className:"font-medium",children:Math.min(w+g,f.length)})," ","of ",e("span",{className:"font-medium",children:f.length})," results"]})}),e("div",{children:s("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px",children:[e(d,{onClick:()=>m(t=>Math.max(t-1,1)),disabled:i===1,className:"btn btn-sm btn-outline rounded-l-md",children:"Previous"}),Array.from({length:o},(t,r)=>r+1).map(t=>e(d,{onClick:()=>m(t),className:`btn btn-sm ${i===t?"btn-primary":"btn-outline"}`,children:t},t)),e(d,{onClick:()=>m(t=>Math.min(t+1,o)),disabled:i===o,className:"btn btn-sm btn-outline rounded-r-md",children:"Next"})]})})]})]})]})]})};export{ee as default};
