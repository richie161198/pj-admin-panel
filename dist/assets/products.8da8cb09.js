import{b as me,r as C,j as a,L as he,c as s,B as i,I as d,Q as P}from"./index.575d0a96.js";import{u as ge,a as xe,b as ue}from"./productApi.181a9215.js";import{u as j,w as be}from"./xlsx.0799a57e.js";const fe=()=>{const S=me(),[N,z]=C.exports.useState(""),[x,y]=C.exports.useState(1),[$,K]=C.exports.useState(""),v=12,{data:r,isLoading:q,error:u,refetch:L}=ge(),{data:l}=xe(),[H,{isLoading:X}]=ue();let n=[];r&&(Array.isArray(r)?n=r:r.details&&Array.isArray(r.details)?n=r.details:r.data&&Array.isArray(r.data)?n=r.data:r.products&&Array.isArray(r.products)&&(n=r.products)),console.log("Products Response:",r),console.log("Products:",n);const Z=C.exports.useMemo(()=>{if(!l)return[];if(l.data){if(Array.isArray(l.data.categories))return l.data.categories.map(e=>e.name||e);if(Array.isArray(l.data))return l.data.map(e=>e.name||e)}return Array.isArray(l.categories)?l.categories.map(e=>e.name||e):Array.isArray(l)?l.map(e=>e.name||e):[]},[l]),A=Array.isArray(n)?n.filter(e=>{var w,h,g,f;const c=((w=e.name)==null?void 0:w.toLowerCase().includes(N.toLowerCase()))||((h=e.brand)==null?void 0:h.toLowerCase().includes(N.toLowerCase()))||((g=e.skuId)==null?void 0:g.toLowerCase().includes(N.toLowerCase()))||((f=e.categories)==null?void 0:f.toLowerCase().includes(N.toLowerCase())),m=!$||e.categories===$;return c&&m}):[],b=Math.ceil(A.length/v),k=(x-1)*v,ee=A.slice(k,k+v),te=async e=>{if(window.confirm("Are you sure you want to delete this product?"))try{await H(e).unwrap(),P.success("Product deleted successfully"),L()}catch{P.error("Failed to delete product")}},ae=()=>{S("/products/add")},se=e=>{S(`/products/${e._id}/edit`)},re=e=>{S(`/products/${e}`)},le=()=>{try{const e=n.map((t,ie)=>{var M,R,E,O,U,F,G,Y,Q,J,V;let B="N/A";t.productDetails&&t.productDetails.length>0&&(B=t.productDetails.map((o,D)=>{const ce=o.attributes||{},W=Object.entries(ce).map(([oe,de])=>`${oe}: ${de}`).join(", ");return`${o.type}${W?` (${W})`:""}`}).join("; "));let _="N/A",I=[];t.priceDetails&&t.priceDetails.length>0&&(I=t.priceDetails.map((o,D)=>`${o.name||"Component "+(D+1)}: ${o.weight||"N/A"} - \u20B9${o.value||0}`),_=I.join("; "));const T=((M=t.priceDetails)==null?void 0:M.reduce((o,D)=>o+(parseFloat(D.value)||0),0))||0,ne=T+(parseFloat(t.gst)||0);return{"S.No":ie+1,"Product ID":t._id,Name:t.name||"N/A",Brand:t.brand||"N/A",Description:t.description||"N/A","SKU ID":t.skuId||"N/A",Category:t.categories||"N/A","Product Details":B,"Price Breakdown":_,"Price Component 1":(R=t.priceDetails)!=null&&R[0]?`${t.priceDetails[0].name||"N/A"}: ${t.priceDetails[0].weight||"N/A"} - \u20B9${t.priceDetails[0].value||0}`:"N/A","Price Component 2":(E=t.priceDetails)!=null&&E[1]?`${t.priceDetails[1].name||"N/A"}: ${t.priceDetails[1].weight||"N/A"} - \u20B9${t.priceDetails[1].value||0}`:"N/A","Price Component 3":(O=t.priceDetails)!=null&&O[2]?`${t.priceDetails[2].name||"N/A"}: ${t.priceDetails[2].weight||"N/A"} - \u20B9${t.priceDetails[2].value||0}`:"N/A","Price Component 4":(U=t.priceDetails)!=null&&U[3]?`${t.priceDetails[3].name||"N/A"}: ${t.priceDetails[3].weight||"N/A"} - \u20B9${t.priceDetails[3].value||0}`:"N/A","Price Component 5":(F=t.priceDetails)!=null&&F[4]?`${t.priceDetails[4].name||"N/A"}: ${t.priceDetails[4].weight||"N/A"} - \u20B9${t.priceDetails[4].value||0}`:"N/A","Subtotal (from Price Details)":T,GST:t.gst||0,"Total (Subtotal + GST)":ne,"Selling Price":t.sellingprice||0,Weight:((G=t.subtotal)==null?void 0:G.weight)||"N/A",Discount:t.Discount||0,"Discount Available":t.isDiscountAvailable?"Yes":"No","Selected Carat":t.selectedCaret||"N/A","Caret Options":((Y=t.caretOptions)==null?void 0:Y.join(", "))||"N/A",Stock:t.stock||0,Status:t.active?"Active":"Inactive","Currently Not Available":t.CurrentlyNotAvailable?"Yes":"No",Trending:t.trending?"Yes":"No",Popular:t.popular?"Yes":"No",Rating:((Q=t.rating)==null?void 0:Q.value)||0,"Rating Count":((J=t.rating)==null?void 0:J.count)||0,"Images Count":((V=t.images)==null?void 0:V.length)||0,"Created At":t.createdAt?new Date(t.createdAt).toLocaleDateString():"N/A","Updated At":t.updatedAt?new Date(t.updatedAt).toLocaleDateString():"N/A"}}),c=j.book_new(),m=j.json_to_sheet(e),w=[{wch:5},{wch:25},{wch:30},{wch:20},{wch:40},{wch:20},{wch:15},{wch:50},{wch:60},{wch:30},{wch:30},{wch:30},{wch:30},{wch:30},{wch:20},{wch:12},{wch:18},{wch:15},{wch:10},{wch:12},{wch:18},{wch:15},{wch:20},{wch:10},{wch:10},{wch:20},{wch:10},{wch:10},{wch:10},{wch:12},{wch:12},{wch:15},{wch:15}];m["!cols"]=w,j.book_append_sheet(c,m,"Products");const h=be(c,{bookType:"xlsx",type:"array"}),g=new Blob([h],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),f=window.URL.createObjectURL(g),p=document.createElement("a");p.href=f,p.download=`products_export_${new Date().toISOString().split("T")[0]}.xlsx`,document.body.appendChild(p),p.click(),document.body.removeChild(p),window.URL.revokeObjectURL(f),P.success("Product data exported successfully!")}catch(e){console.error("Export error:",e),P.error("Failed to export product data")}};return q?a("div",{className:"flex justify-center items-center h-64",children:a(he,{})}):u?(console.error("Products Error:",u),s("div",{className:"text-center py-8",children:[s("p",{className:"text-red-500",children:["Error loading products: ",u.message]}),s("p",{className:"text-sm text-gray-500",children:["Status: ",u.status]}),s("p",{className:"text-sm text-gray-500",children:["Data: ",JSON.stringify(u.data)]}),s("div",{className:"mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-lg text-left",children:[a("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Full Error:"}),a("pre",{className:"text-xs text-gray-500 dark:text-gray-500 mt-2 overflow-auto",children:JSON.stringify(u,null,2)})]}),a(i,{onClick:()=>L(),className:"mt-4",children:"Retry"})]})):s("div",{className:"space-y-6",children:[s("div",{className:"flex justify-between items-center",children:[s("div",{children:[a("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Products"}),a("p",{className:"text-gray-600 dark:text-gray-400",children:"Manage your product catalog"})]}),s("div",{className:"flex space-x-3",children:[s(i,{onClick:le,className:"btn btn-outline-success",disabled:!n||n.length===0,children:[a(d,{icon:"ph:download",className:"mr-2"}),"Export Excel"]}),s(i,{onClick:ae,className:"btn btn-primary",children:[a(d,{icon:"ph:plus",className:"mr-2"}),"Add Product"]})]})]}),a("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:s("div",{className:"flex flex-col lg:flex-row gap-4",children:[a("div",{className:"flex-1",children:s("div",{className:"relative",children:[a(d,{icon:"ph:magnifying-glass",className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),a("input",{type:"text",placeholder:"Search products...",value:N,onChange:e=>z(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-700 dark:text-white"})]})}),a("div",{className:"lg:w-64",children:s("select",{value:$,onChange:e=>K(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-700 dark:text-white",children:[a("option",{value:"",children:"All Categories"}),Z.map(e=>a("option",{value:e,children:e},e))]})})]})}),a("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:ee.map(e=>{var c,m;return s("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm overflow-hidden hover:shadow-md transition-shadow",children:[s("div",{className:"relative h-48 bg-gray-100 dark:bg-slate-700",children:[e.images&&e.images.length>0?a("img",{src:e.images[0],alt:e.name,className:"w-full h-full object-cover"}):a("div",{className:"w-full h-full flex items-center justify-center",children:a(d,{icon:"ph:image",className:"text-4xl text-gray-400"})}),s("div",{className:"absolute top-2 left-2 flex flex-col gap-1",children:[e.trending&&a("span",{className:"bg-orange-500 text-white text-xs px-2 py-1 rounded-full",children:"Trending"}),e.popular&&a("span",{className:"bg-green-500 text-white text-xs px-2 py-1 rounded-full",children:"Popular"})]}),a("div",{className:"absolute top-2 right-2",children:a("span",{className:`text-xs px-2 py-1 rounded-full ${e.stock>0?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,children:e.stock>0?`Stock: ${e.stock}`:"Out of Stock"})})]}),s("div",{className:"p-4",children:[s("div",{className:"flex justify-between items-start mb-2",children:[a("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white line-clamp-2",children:e.name}),a("span",{className:`text-xs px-2 py-1 rounded-full ${e.active?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,children:e.active?"Active":"Inactive"})]}),a("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:e.brand}),a("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-3",children:e.categories}),s("div",{className:"flex items-center mb-3",children:[a("div",{className:"flex items-center",children:[...Array(5)].map((w,h)=>{var g;return a(d,{icon:"ph:star-fill",className:`w-4 h-4 ${h<Math.floor(((g=e.rating)==null?void 0:g.value)||0)?"text-yellow-400":"text-gray-300"}`},h)})}),s("span",{className:"text-sm text-gray-600 dark:text-gray-400 ml-2",children:["(",((c=e.rating)==null?void 0:c.count)||0,")"]})]}),s("div",{className:"flex justify-between items-center mb-4",children:[s("div",{children:[s("span",{className:"text-lg font-bold text-gray-900 dark:text-white",children:["\u20B9",((m=e.sellingprice)==null?void 0:m.toLocaleString())||0]}),e.total&&e.total!==e.sellingprice&&s("span",{className:"text-sm text-gray-500 dark:text-gray-400 line-through ml-2",children:["\u20B9",e.total.toLocaleString()]})]}),a("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.selectedCaret})]}),s("div",{className:"flex space-x-2",children:[s(i,{onClick:()=>re(e._id),className:"btn btn-sm btn-outline-primary flex-1",children:[a(d,{icon:"ph:eye",className:"mr-1"}),"View"]}),a(i,{onClick:()=>se(e),className:"btn btn-sm btn-outline-secondary",children:a(d,{icon:"ph:pencil"})}),a(i,{onClick:()=>te(e._id),disabled:X,className:"btn btn-sm btn-outline-danger",children:a(d,{icon:"ph:trash"})})]})]})]},e._id)})}),b>1&&s("div",{className:"bg-white dark:bg-slate-800 px-4 py-3 flex items-center justify-between border-t border-gray-200 dark:border-gray-700 sm:px-6",children:[s("div",{className:"flex-1 flex justify-between sm:hidden",children:[a(i,{onClick:()=>y(e=>Math.max(e-1,1)),disabled:x===1,className:"btn btn-sm btn-outline",children:"Previous"}),a(i,{onClick:()=>y(e=>Math.min(e+1,b)),disabled:x===b,className:"btn btn-sm btn-outline",children:"Next"})]}),s("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[a("div",{children:s("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Showing ",a("span",{className:"font-medium",children:k+1})," to"," ",a("span",{className:"font-medium",children:Math.min(k+v,A.length)})," ","of ",a("span",{className:"font-medium",children:A.length})," results"]})}),a("div",{children:s("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px",children:[a(i,{onClick:()=>y(e=>Math.max(e-1,1)),disabled:x===1,className:"btn btn-sm btn-outline rounded-l-md",children:"Previous"}),Array.from({length:b},(e,c)=>c+1).map(e=>a(i,{onClick:()=>y(e),className:`btn btn-sm ${x===e?"btn-primary":"btn-outline"}`,children:e},e)),a(i,{onClick:()=>y(e=>Math.min(e+1,b)),disabled:x===b,className:"btn btn-sm btn-outline rounded-r-md",children:"Next"})]})})]})]})]})};export{fe as default};
