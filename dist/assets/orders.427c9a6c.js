import{b as ne,r as m,j as e,L as ce,c as a,B as o,I as N,Q as z}from"./index.cccf3715.js";import{a as de}from"./orderApi.5c45f8c6.js";import{B as oe}from"./Badge.5f9dcbff.js";import{u as O,w as me}from"./xlsx.0799a57e.js";const ye=()=>{var B,_,j,F,I,E,M,U;const R=ne(),[v,W]=m.exports.useState(""),[H,g]=m.exports.useState(1),[A,J]=m.exports.useState(""),[S,K]=m.exports.useState(""),[P,X]=m.exports.useState(""),[C,Y]=m.exports.useState(""),Z={page:H,limit:10,...A&&{status:A},...S&&{paymentStatus:S},...v&&{search:v},...P&&{startDate:P},...C&&{endDate:C}},{data:l,isLoading:ee,error:L,refetch:te}=de(Z),h=((B=l==null?void 0:l.data)==null?void 0:B.orders)||[],s=((_=l==null?void 0:l.data)==null?void 0:_.pagination)||{},p=((j=l==null?void 0:l.data)==null?void 0:j.summary)||{},T=((F=l==null?void 0:l.data)==null?void 0:F.breakdown)||{};console.log("Orders Response:",l),console.log("Orders:",h),console.log("Pagination:",s),console.log("Summary:",p);const ae=t=>{R(`/orders/${t}`)},re=t=>{const d={pending:{color:"bg-yellow-100 text-yellow-800",label:"Pending"},processing:{color:"bg-blue-100 text-blue-800",label:"Processing"},shipped:{color:"bg-purple-100 text-purple-800",label:"Shipped"},delivered:{color:"bg-green-100 text-green-800",label:"Delivered"},cancelled:{color:"bg-red-100 text-red-800",label:"Cancelled"},refunded:{color:"bg-gray-100 text-gray-800",label:"Refunded"}}[t]||{color:"bg-gray-100 text-gray-800",label:t};return e(oe,{className:`${d.color} border-0`,children:d.label})},se=((I=T.status)==null?void 0:I.map(t=>t._id))||[],le=((E=T.paymentStatus)==null?void 0:E.map(t=>t._id))||[],ie=()=>{try{const t=h.map((r,n)=>{var D,x,y,b,$,V,G,Q,q;return{"S.No":n+1,"Order ID":r.orderCode||"N/A","Customer Name":((D=r.user)==null?void 0:D.name)||"N/A","Customer Email":((x=r.user)==null?void 0:x.email)||"N/A","Customer Phone":((y=r.user)==null?void 0:y.phone)||"N/A",Status:r.status||"N/A","Payment Status":r.paymentStatus||"N/A","Total Amount":r.totalAmount||0,"Shipping Charges":((b=r.shippingDetails)==null?void 0:b.shippingPrice)||(($=r.shippingDetails)==null?void 0:$.shippingAmount)||0,"Total Amount (Grand Total + Shipping)":Math.ceil((((V=r.pricing)==null?void 0:V.grandTotal)||r.totalAmount||0)+(((G=r.shippingDetails)==null?void 0:G.shippingPrice)||((Q=r.shippingDetails)==null?void 0:Q.shippingAmount)||0)),"Items Count":((q=r.items)==null?void 0:q.length)||0,"Created At":r.createdAt?new Date(r.createdAt).toLocaleDateString():"N/A","Updated At":r.updatedAt?new Date(r.updatedAt).toLocaleDateString():"N/A"}}),c=O.book_new(),d=O.json_to_sheet(t),w=[{wch:5},{wch:20},{wch:25},{wch:15},{wch:15},{wch:12},{wch:12},{wch:10},{wch:12},{wch:15},{wch:10},{wch:12},{wch:15},{wch:15}];d["!cols"]=w,O.book_append_sheet(c,d,"Orders");const f=me(c,{bookType:"xlsx",type:"array"}),k=new Blob([f],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),u=window.URL.createObjectURL(k),i=document.createElement("a");i.href=u,i.download=`orders_export_${new Date().toISOString().split("T")[0]}.xlsx`,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(u),z.success("Order data exported successfully!")}catch(t){console.error("Export error:",t),z.error("Failed to export order data")}};return ee?e("div",{className:"flex justify-center items-center h-64",children:e(ce,{})}):L?a("div",{className:"text-center py-8",children:[a("p",{className:"text-red-500",children:["Error loading orders: ",L.message]}),e(o,{onClick:()=>te(),className:"mt-4",children:"Retry"})]}):a("div",{className:"space-y-6",children:[a("div",{className:"flex justify-between items-center",children:[a("div",{children:[e("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Product Orders"}),e("p",{className:"text-gray-600 dark:text-gray-400",children:"Manage customer product orders"})]}),e("div",{className:"flex space-x-3",children:a(o,{onClick:ie,className:"btn btn-outline-success",disabled:!h||h.length===0,children:[e(N,{icon:"ph:download",className:"mr-2"}),"Export Excel"]})})]}),p&&a("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:a("div",{className:"flex items-center",children:[e("div",{className:"p-2 bg-blue-100 rounded-lg",children:e(N,{icon:"ph:shopping-cart",className:"text-blue-600 text-xl"})}),a("div",{className:"ml-4",children:[e("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Orders"}),e("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:p.totalOrders||0})]})]})}),e("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:a("div",{className:"flex items-center",children:[e("div",{className:"p-2 bg-green-100 rounded-lg",children:e(N,{icon:"ph:currency-dollar",className:"text-green-600 text-xl"})}),a("div",{className:"ml-4",children:[e("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Revenue"}),a("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["\u20B9 ",((M=p.totalAmount)==null?void 0:M.toLocaleString())||0]})]})]})}),e("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:a("div",{className:"flex items-center",children:[e("div",{className:"p-2 bg-purple-100 rounded-lg",children:e(N,{icon:"ph:chart-line",className:"text-purple-600 text-xl"})}),a("div",{className:"ml-4",children:[e("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Average Order Value"}),a("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["\u20B9 ",((U=p.averageOrderValue)==null?void 0:U.toLocaleString())||0]})]})]})})]}),a("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:[a("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e("div",{className:"lg:col-span-2",children:a("div",{className:"relative",children:[e(N,{icon:"ph:magnifying-glass",className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e("input",{type:"text",placeholder:"Search orders, customers, or products...",value:v,onChange:t=>W(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-700 dark:text-white"})]})}),e("div",{children:a("select",{value:A,onChange:t=>J(t.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-700 dark:text-white",children:[e("option",{value:"",children:"All Statuses"}),se.map(t=>e("option",{value:t,children:t},t))]})}),e("div",{children:a("select",{value:S,onChange:t=>K(t.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-700 dark:text-white",children:[e("option",{value:"",children:"All Payment Status"}),le.map(t=>e("option",{value:t,children:t},t))]})})]}),a("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Start Date"}),e("input",{type:"date",value:P,onChange:t=>X(t.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-700 dark:text-white"})]}),a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"End Date"}),e("input",{type:"date",value:C,onChange:t=>Y(t.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-slate-700 dark:text-white"})]})]})]}),a("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm overflow-hidden",children:[e("div",{className:"overflow-x-auto",children:a("table",{className:"w-full",children:[e("thead",{className:"bg-gray-50 dark:bg-slate-700",children:a("tr",{children:[e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Order ID"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Customer"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Products"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Total"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Shipping Charges"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Total Amount"}),e("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Date"})]})}),e("tbody",{className:"bg-white dark:bg-slate-800 divide-y divide-gray-200 dark:divide-gray-700",children:h.map(t=>{var c,d,w,f,k,u;return a("tr",{onClick:()=>ae(t._id),className:"hover:bg-gray-50 dark:hover:bg-slate-700",children:[a("td",{className:"px-6 py-4 whitespace-nowrap",children:[e("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.orderCode||"N/A"}),a("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[((c=t.items)==null?void 0:c.length)||0," items"]})]}),a("td",{className:"px-6 py-4 whitespace-nowrap",children:[e("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:((d=t.user)==null?void 0:d.name)||"N/A"}),e("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:((w=t.user)==null?void 0:w.email)||"N/A"})]}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:a("div",{className:"text-sm text-gray-900 dark:text-white",children:[(f=t.items)==null?void 0:f.slice(0,2).map((i,r)=>{var n;return e("div",{className:"truncate max-w-32",children:((n=i.productDataid)==null?void 0:n.name)||"Product"},r)}),((k=t.items)==null?void 0:k.length)>2&&a("div",{className:"text-xs text-gray-500",children:["+",t.items.length-2," more"]})]})}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:re(t.status)}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:a("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:["\u20B9",((u=t.totalAmount)==null?void 0:u.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2}))||0]})}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:a("div",{className:"text-sm text-gray-600 dark:text-slate-400",children:["\u20B9",(()=>{var r,n;return(((r=t.shippingDetails)==null?void 0:r.shippingPrice)||((n=t.shippingDetails)==null?void 0:n.shippingAmount)||0).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})})()]})}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:e("div",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:(()=>{var x,y,b;const i=((x=t.pricing)==null?void 0:x.grandTotal)||t.totalAmount||0,r=((y=t.shippingDetails)==null?void 0:y.shippingPrice)||((b=t.shippingDetails)==null?void 0:b.shippingAmount)||0,n=i+r;return`\u20B9${Math.ceil(n).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})}`})()})}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:t.createdAt?new Date(t.createdAt).toLocaleDateString():"N/A"})]},t._id)})})]})}),s.totalPages>1&&a("div",{className:"bg-white dark:bg-slate-800 px-4 py-3 flex items-center justify-between border-t border-gray-200 dark:border-gray-700 sm:px-6",children:[a("div",{className:"flex-1 flex justify-between sm:hidden",children:[e(o,{onClick:()=>g(t=>Math.max(t-1,1)),disabled:!s.hasPrevPage,className:"btn btn-sm btn-outline",children:"Previous"}),e(o,{onClick:()=>g(t=>Math.min(t+1,s.totalPages)),disabled:!s.hasNextPage,className:"btn btn-sm btn-outline",children:"Next"})]}),a("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e("div",{children:a("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Showing ",e("span",{className:"font-medium",children:(s.currentPage-1)*s.limit+1})," to"," ",e("span",{className:"font-medium",children:Math.min(s.currentPage*s.limit,s.totalOrders)})," ","of ",e("span",{className:"font-medium",children:s.totalOrders})," results"]})}),e("div",{children:a("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px",children:[e(o,{onClick:()=>g(t=>Math.max(t-1,1)),disabled:!s.hasPrevPage,className:"btn btn-sm btn-outline rounded-l-md",children:"Previous"}),Array.from({length:s.totalPages},(t,c)=>c+1).map(t=>e(o,{onClick:()=>g(t),className:`btn btn-sm ${s.currentPage===t?"btn-primary":"btn-outline"}`,children:t},t)),e(o,{onClick:()=>g(t=>Math.min(t+1,s.totalPages)),disabled:!s.hasNextPage,className:"btn btn-sm btn-outline rounded-r-md",children:"Next"})]})})]})]})]})]})};export{ye as default};
